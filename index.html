<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>universalezra</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/dashboard/apple-touch-icon1.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/dashboard/favicon-32x321.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/dashboard/favicon-16x161.png"
    />
    <link rel="manifest" href="/dashboard/site.webmanifest" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
      :root {
        --primary: #8e44ad;
        --accent: #00a8ff;
        --success: #2ecc71;
        --danger: #e74c3c;
        --light: #ecf0f1;
        --dark: #1a1a2e;
        --bg-main: #16213e;
        --bg-panel: rgba(26, 26, 46, 0.9);
        --text-primary: #e0fbfc;
        --text-secondary: #98ded9;
        --border-color: rgba(0, 168, 255, 0.3);
      }
      * {
        box-sizing: border-box;
      }
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: 'Courier New', Courier, monospace;
        background-color: var(--bg-main);
        color: #00ff00;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      body::before {
        content: "Ezra A";
        position: fixed;
        bottom: 10px;
        left: 10px;
        font-size: 1.5rem;
        color: rgba(255, 255, 255, 0.1);
        z-index: 999;
        pointer-events: none;
        opacity: 0.8;
      }
      #main-viewport {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }
      #grid-container {
        width: 500vw;
        height: 500vh;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr 1fr 1fr;
        transform: translate3d(-200vw, -200vh, 0);
        transition: transform 0.7s cubic-bezier(0.86, 0, 0.07, 1);
      }
      .grid-block {
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 20px;
      }
      .grid-block-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        filter: blur(3px);
        -webkit-filter: blur(3px);
        z-index: 1;
      }
      .grid-block-content {
        position: relative;
        z-index: 2;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        padding: 20px;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .panel {
        position: fixed;
        background: rgba(26, 26, 46, 0.7);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        z-index: 1010;
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.6);
        transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        display: flex;
        flex-direction: column;
        color: #00ff00;
      }
      .panel.active {
        transform: translate(0, 0) !important;
      }
      #editor-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateX(-100%);
      }
      #music-panel {
        bottom: 0;
        left: 0;
        width: 100%;
        height: auto;
        max-height: 50vh;
        border-top: 1px solid var(--border-color);
        transform: translateY(100%);
        padding: 15px;
      }
      #contribution-panel {
        top: 0;
        right: 0;
        width: 400px;
        max-width: 90vw;
        height: 100%;
        transform: translateX(100%);
        padding: 20px;
      }
      #live-visitors-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateY(100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #moment-vault-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateY(100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #dashboard-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateX(-100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #visualizer-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99;
        display: none;
        background-color: transparent;
      }
      .visualizer-active #visualizer-canvas {
        display: block;
        pointer-events: none;
      }
      .panel-close-btn {
        position: static; /* HAPUS 'absolute' */
        background: none;
        border: none;
        color: #00ff00;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px; /* Beri area klik yang lebih baik */
      }
      .fab-container {
        position: fixed;
        z-index: 1000;
        display: flex; /* Tambahkan ini agar perataan berfungsi */
      }
      .fab, .fab-container a {
        background: rgba(142, 68, 173, 0.7);
        color: #00ff00;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.4rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        text-decoration: none;
      }
      .fab:hover, .fab-container a:hover {
        background: var(--accent);
        transform: scale(1.1);
      }
      #fab-editor {
        top: 20px;
        left: 20px;
      }
      #fab-music {
        top: 50%;
        left: 20px;
        transform: translateY(-50%);
      }
      #fab-alkitab {
        top: 20px;
        right: 20px;
      }
      #fab-contribution {
        top: calc(50% + 70px);
        left: 20px;
        transform: translateY(-50%);
      }
      #fab-visualizer {
        bottom: 20px;
        left: 50%;
        transform: translateX(-120%);
      }
      #fab-moment-vault {
        bottom: 20px;
        left: 50%;
        transform: translateX(0%);
      }
      #fab-live-visitors {
        bottom: 90px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
      }
      #fab-keyboard-toggle {
        bottom: 20px;
        right: 20px;
      }
      #fab-dashboard-toggle {
        bottom: 20px;
        left: 20px;
      }
      #live-visitors-panel .live-visitors-content,
      #moment-vault-panel .moment-vault-content,
      #dashboard-panel .dashboard-content-wrapper {
          width: 100%;
          height: 100%;
          max-width: 1200px;
          background: var(--bg-panel);
          border-radius: 15px;
          box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
          overflow: hidden;
          display: flex;
          flex-direction: column;
          padding: 20px;
      }
      #visitor-list ul {
          list-style: none;
          padding: 0;
          margin: 0;
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 15px;
      }
      #visitor-history {
        flex-grow: 1;
        overflow-y: auto;
        padding: 0 10px;
      }
      #visitor-history table {
          width: 100%;
          border-collapse: collapse;
          font-size: 0.85em;
      }
      #visitor-history th, #visitor-history td {
          border: 1px solid var(--border-color);
          padding: 8px;
          text-align: left;
      }
      #visitor-history th {
          background-color: rgba(0, 168, 255, 0.2);
          position: sticky;
          top: 0;
      }
      #moment-vault-gallery-container {
        flex-grow: 1; 
        overflow-y: auto; 
        padding-right: 10px;
      }
      #moment-vault-gallery {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
          gap: 15px;
      }
      #moment-upload-form input, #moment-upload-form textarea, #moment-upload-form button {
        margin-top: 10px;
      }
      .gallery-item {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 8px;
        position: relative;
      }
      .gallery-media {
        width: 100%;
        height: 120px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        border-radius: 5px;
        background-color: #333;
      }
      .gallery-media img, .gallery-media video, .gallery-media audio {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .gallery-media .file-icon {
        font-size: 3em;
        color: var(--text-secondary);
      }
      #video-player-widget {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999;
        width: 150px;
        height: 150px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        border: 2px solid var(--border-color);
        display: flex; /* Tambahkan ini agar tidak hilang saat disembunyikan */
      }
      #video-player-widget video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .social-links {
        position: fixed;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 15px;
        z-index: 999;
      }
      /* HAPUS CSS UNTUK #website-age-display KARENA SUDAH DI-HANDLE DENGAN INLINE STYLE */
      
      /* CSS BARU UNTUK HEADER PANEL EDITOR */
      .panel-header {
        display: flex;
        justify-content: space-between; /* Mendorong item ke ujung */
        align-items: center;
        padding: 10px 15px;
        background: rgba(0,0,0,0.3); /* Warna latar agar serasi */
        flex-shrink: 0; /* Mencegah header menyusut */
      }
      
      .panel-title {
        font-weight: bold;
        font-size: 1.1em;
        margin-right: auto; /* Mendorong toolbar & tombol ke kanan */
      }
      
      .editor-toolbar {
        padding: 0; /* Hapus padding lama */
        margin: 0 15px; /* Beri jarak */
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .editor-toolbar button {
        background: var(--accent);
        color: var(--text-primary);
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .editor-toolbar button:hover {
        background: var(--primary);
      }
      .editor-main {
        display: flex;
        flex-grow: 1;
        gap: 10px;
        padding: 10px;
      }
      .editor-code-area, .editor-preview-area {
        flex: 1;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        overflow: hidden;
      }
      #unified-code-editor {
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.3);
        color: var(--text-primary);
        border: none;
        padding: 10px;
        resize: none;
        outline: none;
      }
      #editor-preview {
        width: 100%;
        height: 100%;
        border: none;
        background: var(--light);
      }
      #video-player-widget .video-controls {
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          display: flex;
          justify-content: space-evenly;
          align-items: center;
          padding: 5px 0;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(5px);
          -webkit-backdrop-filter: blur(5px);
          transition: opacity 0.3s ease;
          opacity: 0;
      }
      #video-player-widget:hover .video-controls {
          opacity: 1;
      }
      #video-player-widget .video-controls button {
          background: none;
          border: none;
          color: white;
          font-size: 1rem;
          cursor: pointer;
          padding: 5px;
      }
      #moment-vault-panel h3 {
        padding: 10px 20px;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }
      #moment-upload-form {
        width: 100%;
        max-width: 600px;
      }
      #moment-upload-form input, #moment-upload-form textarea {
        display: block;
        width: 100%;
        margin-top: 15px;
        padding: 12px;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        border-radius: 8px;
      }
      #moment-upload-form button {
        width: 100%;
        padding: 12px;
        background: var(--accent);
        border: none;
        color: white;
        font-size: 1em;
        cursor: pointer;
        border-radius: 8px;
        transition: background 0.3s ease;
      }
      #moment-upload-form button:hover {
        background: var(--primary);
      }
      .grid-block-background video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
      }
      #block-4-3 .grid-block-background {
        -webkit-filter: none;
        -moz-filter: none;
        -ms-filter: none;
        filter: none;
      }
      #block-3-4 .grid-block-background {
        -webkit-filter: none;
        filter: none;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }
      #center-video-container {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          z-index: 1100;
          width: 80vw;
          height: 80vh;
          max-width: 1200px;
          max-height: 800px;
          background: rgba(0,0,0,0.9);
          border: 2px solid var(--accent);
          border-radius: 10px;
          display: flex;
          justify-content: center;
          align-items: center;
          flex-direction: column;
          box-shadow: 0 0 50px rgba(0,0,0,0.8);
          display: none;
      }
      #center-video-container.active {
          display: flex;
      }
      #center-video-container video {
          width: 95%;
          height: 95%;
          object-fit: contain;
      }
      #center-video-close {
          position: absolute;
          top: 10px;
          right: 10px;
          font-size: 2rem;
          color: white;
          cursor: pointer;
          background: none;
          border: none;
          z-index: 10;
      }
      #bible-widget-container {
        width: 100%;
        max-width: 500px;
        height: auto;
        min-height: 300px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
        overflow: hidden;
      }
      #dashboard-content {
        height: 100%;
        width: 100%;
        padding: 20px;
        text-align: left;
        color: var(--text-primary);
        overflow-y: auto;
      }
      .dashboard-card {
        background: rgba(0, 0, 0, 0.4);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        border: 1px solid var(--border-color);
      }
      .dashboard-card h4 {
        margin-top: 0;
        color: var(--accent);
      }
      .dashboard-card p {
        margin-bottom: 0;
        font-size: 0.9em;
      }
      .screenshot-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 10px;
        font-size: 1.2em;
        z-index: 9999;
        display: none;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
      }
      #new-user-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 500px;
        background: var(--bg-panel);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        z-index: 10000;
        padding: 25px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        display: none;
        text-align: center;
      }
      #new-user-popup h3 {
        margin-top: 0;
        color: var(--accent);
      }
      #new-user-popup p {
        margin-bottom: 15px;
      }
      #new-user-popup a {
        color: var(--accent);
      }
      #popup-close-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        transition: background 0.2s;
      }
      #popup-close-btn:hover {
        background: var(--accent);
      }
      .progress-bar-container {
          width: 100%;
          background-color: rgba(0, 0, 0, 0.4);
          border-radius: 5px;
          margin-top: 10px;
          overflow: hidden;
          border: 1px solid var(--border-color);
      }
      .progress-bar {
          background-color: var(--accent);
          padding: 4px 8px;
          text-align: right;
          color: white;
          font-size: 0.8em;
          font-weight: bold;
          white-space: nowrap;
          transition: width 0.8s ease-in-out;
      }
    </style>
  </head>
  <body>
    <div id="new-user-popup">
      <h3>Selamat Datang</h3>
      <p>Untuk pengalaman terbaik, kami merekomendasikan:</p>
      <ul>
        <li style="text-align: left; margin-bottom: 10px;">
          Gunakan aplikasi kami untuk fitur penuh: 
          <a href="https://drive.google.com/file/d/11fQBWB9C1PjUQvb8b-IqHdNLS7YkFSFD/view?usp=drivesdk" target="_blank">Download di sini</a>
        </li>
        <li style="text-align: left; margin-bottom: 10px;">
          Putar layar Anda ke mode lanskap (landscape).
        </li>
      </ul>
      <p>
        Dengan melanjutkan, Anda setuju dengan 
        <a href="#privacy" onclick="alert('Kebijakan Privasi: Kami mengumpulkan data anonim seperti ID browser dan alamat IP untuk analisis statistik pengunjung. Data ini tidak akan dibagikan dengan pihak ketiga.');">Kebijakan Privasi</a> kami.
      </p>
      <button id="popup-close-btn">Mengerti</button>
    </div>

    <div class="screenshot-popup" id="screenshot-popup">
        Screenshot tidak diizinkan!
    </div>
    <canvas id="visualizer-canvas"></canvas>
    <audio id="matrix-sound" src="/dashboard/matrix-code.mp3" preload="auto"></audio>
    <div id="main-viewport">
      <div id="grid-container">
        <div class="grid-block" id="block-1-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=1');"></div>
          <div class="grid-block-content"><h1>Block (1,1)</h1></div>
        </div>
        <div class="grid-block" id="block-1-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=2');"></div>
          <div class="grid-block-content"><h1>Block (1,2)</h1></div>
        </div>
        <div class="grid-block" id="block-1-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=3');"></div>
          <div class="grid-block-content"><!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informasi Cuaca & Angin</title>
    <style>
        body {
        font-family: 'Courier New', Courier, monospace;
            background-color: #000000;
            color: #333;
            margin: 0;
            padding: 0px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            width: 100%;
            max-width: 1200px;
        }
        .widget {
            background-color: #ffffff;
            border-radius: 0px;
            box-shadow: 0 0px 0px rgba(0,0,0,0.1);
            padding: 0px;
            text-align: center;
            min-width: 320px;
        }
        .widget h2 {
            margin-top: 0;
            color: #3498db;
            border-bottom: 0px solid #ecf0f1;
            padding-bottom: 0px;
            margin-bottom: 0px;
        }
        .footer {
            margin-top: 40px;
            font-size: 0.9em;
            color: #7f8c8d;
      }
    </style>
</head>
<body>

    <div class="header">
        <h1>Dashboard Cuaca Saat Ini</h1>
        <p>Informasi cuaca dan peta arah angin real-time.</p>
    </div>

    <div class="container">
        <div class="widget">
            <h2>Cuaca Lokal (Jakarta)</h2>
            <a class="weatherwidget-io" href="https://forecast7.com/en/n6d21106d82/jakarta/" data-label_1="JAKARTA" data-label_2="CUACA" data-theme="original" >JAKARTA WEATHER</a>
            <script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');
            </script>
        </div>

        <div class="widget">
            <h2>Peta Arah Angin</h2>
            <iframe
                width="600"
                height="450"
                src="https://embed.windy.com/embed2.html?lat=-2.495&lon=118.213&detailLat=-6.215&detailLon=106.827&width=600&height=450&zoom=5&level=surface&overlay=wind&product=ecmwf&menu=&message=true&marker=true&calendar=now&pressure=&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1"
                frameborder="0">
            </iframe>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2024 Website Cuaca Anda</p>
    </div>

</body>
</html></div>
        </div>
        <div class="grid-block" id="block-1-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=4');"></div>
          <div class="grid-block-content"><h1>Block (1,4)</h1></div>
        </div>
        <div class="grid-block" id="block-1-5">
            <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=5');"></div>
            <div class="grid-block-content"><h1>Block (1,5)</h1></div>
        </div>

        <div class="grid-block" id="block-2-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=6');"></div>
          <div class="grid-block-content"><h1>Block (2,1)</h1></div>
        </div>
        <div class="grid-block" id="block-2-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=7');"></div>
          <div class="grid-block-content"><h1>Block (2,2)</h1></div>
        </div>
        <div class="grid-block" id="block-2-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=8');"></div>
          <div class="grid-block-content"><h1>Block (2,3)</h1></div>
        </div>
        <div class="grid-block" id="block-2-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=9');"></div>
          <div class="grid-block-content"><h1>Block (2,4)</h1></div>
        </div>
        <div class="grid-block" id="block-2-5">
            <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=10');"></div>
            <div class="grid-block-content"><h1>Block (2,5)</h1></div>
        </div>

        <div class="grid-block" id="block-3-1">
          <div class="grid-block-content">
              <h3 style="margin-bottom: 20px;">Peta Bintang</h3>
              <iframe src="https://stellarium-web.org/" width="90%" height="80%" frameborder="0" style="border-radius: 10px; border:none;"></iframe>
          </div>
        </div>
        <div class="grid-block" id="block-3-2">
          <div class="grid-block-content">
            <h3>Ayat Hari Ini (YouVersion)</h3>
            <div id="bible-widget-container">
                <iframe src="https://www.bible.com/verse-of-the-day/TB" width="100%" height="100%" style="border: none;"></iframe>
            </div>
          </div>
        </div>
        <div class="grid-block" id="block-center">
          <div class="grid-block-background" id="interactive-bg" style="background-image: url('/dashboard/wallpaper.png');"></div>
          <div class="grid-block-content">
              <div class="central-message">
                  <p>By <a href="/dashboard/secret.html" class="ezra-link">Ezra</a></p>
              </div>
              <div class="panel" id="contribution-panel-desktop" style="display: none"></div>
          </div>
        </div>
        <div class="grid-block" id="block-3-4">
          <div class="grid-block-background" style="background-image: url('https://universalezra.netlify.app/moments/1751293320517-December 13, 2024 at 4.29 AM (1).jpg');"></div>
        </div>
        <div class="grid-block" id="block-3-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=15');"></div>
          <div class="grid-block-content"><h1>Block (3,5)</h1></div>
        </div>

        <div class="grid-block" id="block-4-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=16');"></div>
          <div class="grid-block-content"><h1>Block (4,1)</h1></div>
        </div>
        <div class="grid-block" id="block-4-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=17');"></div>
          <div class="grid-block-content"><h1>Block (4,2)</h1></div>
        </div>
        <div class="grid-block" id="block-4-3">
          <div class="grid-block-background">
              <video autoplay loop muted playsinline>
                  <source src="/dashboard/bg.mp4" type="video/mp4">
              </video>
          </div>
          <div class="grid-block-content"></div>
        </div>
        <div class="grid-block" id="block-4-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=19');"></div>
          <div class="grid-block-content"><h1>Block (4,4)</h1></div>
        </div>
        <div class="grid-block" id="block-4-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=20');"></div>
          <div class="grid-block-content"><h1>Block (4,5)</h1></div>
        </div>

        <div class="grid-block" id="block-5-1">
            <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=21');"></div>
            <div class="grid-block-content"><h1>Block (5,1)</h1></div>
        </div>
        <div class="grid-block" id="block-5-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=22');"></div>
          <div class="grid-block-content"><h1>Block (5,2)</h1></div>
        </div>
        <div class="grid-block" id="block-5-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=23');"></div>
          <div class="grid-block-content"><h1>Block (5,3)</h1></div>
        </div>
        <div class="grid-block" id="block-5-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=24');"></div>
          <div class="grid-block-content"><h1>Block (5,4)</h1></div>
        </div>
        <div class="grid-block" id="block-5-5">
          <div class="grid-block-content">
            <h3>Spaceship 3D Model</h3>
            <iframe title="Executor-Class Star Dreadnought" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="https://sketchfab.com/models/442c548d94744641ba279ae94b5f45ec/embed" style="width: 90%; height: 90%; border:none; border-radius:12px;"></iframe>
          </div>
        </div>
      </div>
    </div>
    <div class="fab-container" id="fab-editor">
        <button class="fab" data-panel="editor-panel" title="Code Editor">
            <i class="fas fa-code"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-music">
        <button class="fab" data-panel="music-panel" title="Music Player">
            <i class="fas fa-music"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-contribution">
        <button class="fab" data-panel="contribution-panel" title="Leave a Message">
            <i class="fas fa-feather-alt"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-alkitab">
        <a
            class="fab"
            href="https://alkitab.me/in-tb/Matius/5/13"
            target="_blank"
            title="Alkitab"
            ><i class="fas fa-book"></i
        ></a>
    </div>
    <div class="fab-container" id="fab-visualizer">
        <button class="fab" data-panel="visualizer" title="Visualizer">
            <i class="fas fa-expand"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-moment-vault">
        <button class="fab" data-panel="moment-vault-panel" title="Moment Vault">
            <i class="fas fa-archive"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-live-visitors">
        <button class="fab" data-panel="live-visitors-panel" title="Live Visitors">
            <i class="fas fa-eye"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-keyboard-toggle">
        <button class="fab" title="Enter Password">
            <i class="fas fa-keyboard"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-dashboard-toggle">
        <button class="fab" data-panel="dashboard-panel" title="Target Dashboard">
            <i class="fas fa-bullseye"></i>
        </button>
    </div>
    <div id="video-player-widget">
        <video id="widget-video" loop src="video.mp4"></video>
        <div class="video-controls">
            <button id="video-play-pause"><i class="fas fa-play"></i></button>
            <button id="video-mute"><i class="fas fa-volume-up"></i></button>
        </div>
    </div>
    <div class="social-links">
        <a href="https://wa.me/6283844959380" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="https://www.instagram.com/elvizill/?utm_source=ig_web_button_share_sheet" target="_blank" title=" My Instagram Girl"><i class="fab fa-instagram"></i></a>
    </div>

    <div class="panel" id="editor-panel">
        <div class="panel-header">
            <span class="panel-title">Code Editor</span>
            <div class="editor-toolbar">
                <button id="editor-run"><i class="fas fa-play"></i> Run</button>
                <button id="editor-save"><i class="fas fa-save"></i> Save</button>
                <button id="editor-load"><i class="fas fa-folder-open"></i> Load</button>
                <button id="editor-new"><i class="fas fa-file"></i> New</button>
                <button id="editor-undo"><i class="fas fa-undo"></i> Undo</button>
                <button id="editor-redo"><span><i class="fas fa-redo"></i> Redo</span></button>
            </div>
            <button class="panel-close-btn" data-panel="editor-panel"><i class="fas fa-times"></i></button>
        </div>
        <div class="editor-main">
            <div class="editor-code-area">
                <textarea id="unified-code-editor" spellcheck="false"></textarea>
            </div>
            <div class="editor-preview-area">
                <iframe id="editor-preview"></iframe>
            </div>
        </div>
    </div>
    <div class="panel" id="music-panel">
        <button class="panel-close-btn" data-panel="music-panel"><i class="fas fa-times"></i></button>
        <h4>Now Playing</h4>
        <div id="music-player-content">
            <h5 id="song-title">Select a song</h5>
            <audio id="audio-player" controls loop style="width: 100%"></audio>
            <div id="playlist" style="max-height: 20vh; overflow-y: auto; margin-top: 10px"></div>
        </div>
    </div>
    <div class="panel" id="contribution-panel">
        <button class="panel-close-btn" data-panel="contribution-panel"><i class="fas fa-times"></i></button>
        <div id="contribution-content" style="display: flex; flex-direction: column; height: 100%">
            <h3 style="margin-top: 20px">Leave a Message</h3>
            <div id="contribution-display" style="flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-bottom: 15px">
                <p>Loading</p>
            </div>
            <form id="contribution-form">
                <textarea id="contribution-text" placeholder="Your message" required style="width: 100%; min-height: 80px; background: rgba(0, 0, 0, 0.2); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 5px; padding: 10px;"></textarea>
                <div style="display: flex; justify-content: flex-end; align-items: center; margin-top: 10px;">
                    <button type="submit" class="fab" style="position: static; width: 45px; height: 45px; font-size: 1.1rem">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <p id="contribution-status" style="font-size: 0.9em; text-align: center; margin-top: 10px"></p>
            </form>
        </div>
    </div>
    <div class="panel" id="live-visitors-panel">
      <button class="panel-close-btn" data-panel="live-visitors-panel"><i class="fas fa-times"></i></button>
      <div class="live-visitors-content">
          <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Live Visitors</h3>
          <div id="mv-live-visitors-list-container" style="flex-grow: 1; overflow-y: auto; padding-right: 10px">
              <p style="text-align: center; color: var(--text-secondary)">visitor</p>
              <ul id="visitor-list" style="list-style: none; padding: 0; margin: 0"></ul>
          </div>
          <h4 style="margin-top: 20px; color: var(--primary); text-align: center;">Visitor History</h4>
          <div id="visitor-history">
              <p style="text-align: center; color: var(--text-secondary);">Loading history</p>
          </div>
          <div style="margin-top: 15px; text-align: center; font-size: 0.85em; color: var(--text-secondary)">
              updated: <span id="last-updated-time">N/A</span>
          </div>
      </div>
    </div>
    <div class="panel" id="moment-vault-panel">
        <button class="panel-close-btn" data-panel="moment-vault-panel"><i class="fas fa-times"></i></button>
        <div class="moment-vault-content" style="display: flex; flex-direction: column; height: 100%;">
            <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Share your moment here</h3>
            <div id="moment-vault-gallery-container" style="flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-bottom: 15px;">
                <p style="text-align: center; color: var(--text-secondary)">Memories</p>
                <div id="moment-vault-gallery"></div>
            </div>
            <form id="moment-upload-form">
                <input type="text" id="moment-title" placeholder="Title" required />
                <textarea id="moment-description" placeholder="Describe" rows="3"></textarea>
                <input type="file" id="moment-file" accept="*/*" required/>
                <button type="submit">Upload</button>
                <p id="moment-upload-status" style="font-size: 0.9em; text-align: center; margin-top: 10px"></p>
            </form>
        </div>
    </div>
    <div class="panel" id="dashboard-panel">
      <button class="panel-close-btn" data-panel="dashboard-panel"><i class="fas fa-times"></i></button>
      <div class="dashboard-content-wrapper">
        <div id="dashboard-content">
          <div id="website-age-display" style="text-align: center; font-size: 1.2em; margin-bottom: 20px; color: var(--text-primary);"></div>
          
          <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Dashboard</h3>
          <p style="text-align: center; color: var(--text-secondary)">Ini adalah tampilan statis dari target-target masa depan (Ezra team's).</p>
          <div class="dashboard-card">
            <h4>Proyek 1</h4>
            <p>Membeli pertapakan di kota Subulussalam plus bangunannya di sekitar kantor Dinas sosial</p>
            <div class="progress-bar-container">
              <div class="progress-bar" style="width: 25%;">25%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4>Proyek 2</h4>
            <p>Membeli kebun sawit di dekat jalan setelah unit usahaku mencapai 3</p>
            <div class="progress-bar-container">
              <div class="progress-bar" style="width: 45%;">45%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4>Proyek 3</h4>
            <p>Menjadi pelayan Tuhan Yesus yang sejati</p>
            <div class="progress-bar-container">
              <div class="progress-bar" style="width: 15%;">15%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4P>proyek 4</h4>
            <p>Mecapai dan mendapatkan semua yang sudah di skenario kan oleh Tuhan dengan kehendaknya</p>
            <div class="progress-bar-container">
              <div class="progress-bar" style="width: 70%;">70%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4>Proyek Tambahan 5? : VF</h4>
            <div class="progress-bar-container">
              <div class="progress-bar" style="width: 90%;">90%</div>
            </div>
          </div>
          <div class="dashboard-card">
             <div class="progress-bar-container">
              <div class="progress-bar" style="width: 5%;">5%</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="center-video-container">
        <button id="center-video-close"><i class="fas fa-times"></i></button>
        <video id="center-video-player" loop muted playsinline></video>
    </div>
    <script>
      const CONTRIBUTIONS_WORKER_URL =
        'https://contributions-workerjs.ezvvel.workers.dev/';
      const MOMENT_VAULT_WORKER_URL =
        'https://moment-vault-worker-url.universalezra.workers.dev';
      const GITHUB_REPO_OWNER = 'universalezra';
      const GITHUB_REPO_NAME = 'universalezra';
      const GITHUB_TOKEN_WORKER_URL =
        'https://github-token-worker-url.universalezra.workers.dev';
      let liveVisitorRefreshInterval;
      let isEzraLoggedIn = false;
      const LIVE_VISITORS_WORKER_URL =
        'https://live-visitors.ezvvel.workers.dev/';
      
      const VISITOR_HISTORY_WORKER_URL =
        'https://visitor-history.universalezra.workers.dev/';

      const VISITOR_HISTORY_EXPIRY_DAYS = 7;
      const REFRESH_INTERVAL_MS = 5000;
      const LIVE_VISITORS_PASSWORD = 'ðŸ’”';
      const MOMENT_VAULT_PASSWORD = 'vmoments';
      const CENTER_VIDEO_PASSWORD = 'elvy';
      let isVisualizerActive = false;
      
      // -- START PERUBAHAN UNTUK FITUR 'elvi' --
      let isElviModeActive = false; 

      function hideUIElements() {
          document.querySelectorAll('.fab-container, #video-player-widget, .social-links').forEach(el => {
              el.style.display = 'none';
          });
      }

      function showUIElements() {
          document.querySelectorAll('.fab-container, #video-player-widget, .social-links').forEach(el => {
              if (el.id !== 'fab-live-visitors' || (el.id === 'fab-live-visitors' && el.style.display !== 'none' && el.getAttribute('data-unlocked') === 'true')) {
                // Gunakan 'flex' karena container-nya menggunakan flexbox
                el.style.display = 'flex';
              }
          });
      }

      function updateUIVisibility() {
        if (!isElviModeActive) return;

        // Grid 5x5, blok (2,3) berarti baris ke-2, kolom ke-3
        // Dalam indeks array (0-based), ini adalah y=1 dan x=2
        if (currentY === 1 && currentX === 2) {
            hideUIElements(); // Sembunyikan jika di blok (2,3)
        } else {
            showUIElements(); // Tampilkan jika di blok lain
        }
      }
      // -- END PERUBAHAN UNTUK FITUR 'elvi' --

      let visualizerCanvas, audioContext, analyser, source;
      let frequencyData, bufferLength;
      let scene, camera, renderer, icosahedron, particles3D, frequencyBarsGroup;
      let lastBassLevel = 0;
      const BASS_BEAT_THRESHOLD = 1.4;
      const PARTICLE_COUNT = 500;
      const FREQ_RANGE_START_HZ = 20;
      const FREQ_RANGE_END_HZ = 1024;


      let gridContainer, currentX = 2, currentY = 2;
      let isDragging = false;
      let startX = 0, startY = 0;
      const SWIPE_THRESHOLD = 50;
      
      document.addEventListener('DOMContentLoaded', () => {
        gridContainer = document.getElementById('grid-container');
        initPanelControls();
        initVideoPlayer();
        initEditor();
        initMusicPlayer();
        initWebsiteAgeDisplay();
        trackVisitor();
        initVisualizer();
        initSwipeGestures();
        initPasswordFeature();
        initSecurityFeatures();
        checkFirstVisit();
      });

      function initSwipeGestures() {
        const matrixSound = document.getElementById('matrix-sound');
        const moveGrid = (x, y) => {
            const oldX = currentX;
            const oldY = currentY;
            currentX = Math.min(4, Math.max(0, currentX + x));
            currentY = Math.min(4, Math.max(0, currentY + y));

            if (oldX !== currentX || oldY !== currentY) {
              gridContainer.style.transform = `translate3d(-${currentX * 100}vw, -${currentY * 100}vh, 0)`;
              console.log(`Grid moved to block (${currentX + 1}, ${currentY + 1}). Playing sound.`);
              matrixSound.currentTime = 0;
              matrixSound.play().catch(e => console.error("Audio play failed:", e));
            }
            // PANGGIL FUNGSI UPDATE VISIBILITY SETIAP KALI GRID BERGERAK
            updateUIVisibility();
        };
        const handleStart = (e) => {
            isDragging = true;
            startX = e.clientX || e.touches[0].clientX;
            startY = e.clientY || e.touches[0].clientY;
        };
        const handleEnd = (e) => {
            if (!isDragging) return;
            const endX = e.clientX || e.changedTouches[0].clientX;
            const endY = e.clientY || e.changedTouches[0].clientY;
            const dx = endX - startX;
            const dy = endY - startY;
            isDragging = false;
            if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > SWIPE_THRESHOLD) {
                moveGrid(dx > 0 ? -1 : 1, 0);
            } else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > SWIPE_THRESHOLD) {
                moveGrid(0, dy > 0 ? -1 : 1);
            }
        };
        document.addEventListener('mousedown', handleStart);
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchstart', handleStart);
        document.addEventListener('touchend', handleEnd);
      }
      
      // ... (Sisa fungsi-fungsi JS tidak diubah, untuk keringkasan) ...
      function initPanelControls() {
        document.querySelectorAll('[data-panel]').forEach((button) => {
          button.addEventListener('click', (event) => {
            const panelId = button.getAttribute('data-panel');
            
            if (panelId === 'visualizer') {
              toggleVisualizerOverlay();
              return;
            }

            const panel = document.getElementById(panelId);
            if (panelId === 'live-visitors-panel') {
              const password = prompt('Please enter the password to unlock this feature:');
              if (password === LIVE_VISITORS_PASSWORD) {
                isEzraLoggedIn = true;
                panel.classList.toggle('active');
                if (panel.classList.contains('active')) {
                  fetchLiveVisitors();
                  fetchVisitorHistory();
                  liveVisitorRefreshInterval = setInterval(fetchLiveVisitors, REFRESH_INTERVAL_MS);
                } else {
                  clearInterval(liveVisitorRefreshInterval);
                  document.getElementById('visitor-list').innerHTML = '';
                  document.getElementById('visitor-history').innerHTML = '';
                }
              } else {
                alert('Incorrect or blank password!');
                isEzraLoggedIn = false;
                return;
              }
            } else {
              panel.classList.toggle('active');
              if (panelId === 'contribution-panel' && panel.classList.contains('active')) {
                fetchContributions();
              } else if (panelId === 'moment-vault-panel') {
                if (panel.classList.contains('active')) {
                  fetchMomentVaultGallery();
                } else {
                  document.getElementById('moment-vault-gallery').innerHTML = '';
                }
              }
              document.querySelectorAll('.panel').forEach((otherPanel) => {
                if (otherPanel.id !== panelId) {
                  otherPanel.classList.remove('active');
                  if (otherPanel.id === 'live-visitors-panel') {
                    clearInterval(liveVisitorRefreshInterval);
                    document.getElementById('visitor-list').innerHTML = '';
                    document.getElementById('visitor-history').innerHTML = '';
                    isEzraLoggedIn = false;
                  }
                  if (otherPanel.id === 'moment-vault-panel') {
                    document.getElementById('moment-vault-gallery').innerHTML = '';
                  }
                }
              });
            }
          });
        });
        document.querySelectorAll('.panel-close-btn').forEach((button) => {
          button.addEventListener('click', () => {
            const panelId = button.getAttribute('data-panel');
            const panel = document.getElementById(panelId);
            panel.classList.remove('active');
            if (panelId === 'live-visitors-panel') {
              clearInterval(liveVisitorRefreshInterval);
              document.getElementById('visitor-list').innerHTML = '';
              document.getElementById('visitor-history').innerHTML = '';
              isEzraLoggedIn = false;
            }
            if (panelId === 'moment-vault-panel') {
              document.getElementById('moment-vault-gallery').innerHTML = '';
            }
          });
        });
      }
      function initVideoPlayer() {
        const video = document.getElementById('widget-video');
        const playBtn = document.getElementById('video-play-pause');
        const muteBtn = document.getElementById('video-mute');
        playBtn.addEventListener('click', () => {
          if (video.paused) {
            video.play();
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
          } else {
            video.pause();
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
          }
        });
        muteBtn.addEventListener('click', () => {
          video.muted = !video.muted;
          muteBtn.innerHTML = video.muted
            ? '<i class="fas fa-volume-mute"></i>'
            : '<i class="fas fa-volume-up"></i>';
        });
      }
      function initMusicPlayer() {
        const player = document.getElementById('audio-player');
        const playlistEl = document.getElementById('playlist');
        const songTitleEl = document.getElementById('song-title');
        const songs = [
          { name: 'On And On', url: '/dashboard/On-And-On.mp3' },
          { name: 'Where We Are', url: '/dashboard/Where-We-Are.mp3' },
          { name: 'Sekuat Hatimu', url: '/dashboard/Sekuat Hatimu.mp3' },
        ];
        songs.forEach((song, index) => {
          const item = document.createElement('div');
          item.textContent = song.name;
          item.style.cursor = 'pointer';
          item.style.padding = '8px';
          item.onclick = () => {
            player.src = song.url;
            songTitleEl.textContent = song.name;
            player.play();
          };
          playlistEl.appendChild(item);
        });
      }
      function initEditor() {
        const codeEditor = document.getElementById('unified-code-editor');
        const previewFrame = document.getElementById('editor-preview');
        const runBtn = document.getElementById('editor-run');
        const saveBtn = document.getElementById('editor-save');
        const loadBtn = document.getElementById('editor-load');
        const newBtn = document.getElementById('editor-new');
        const undoBtn = document.getElementById('editor-undo');
        const redoBtn = document.getElementById('editor-redo');
        let history = [''];
        let historyPointer = 0;
        const updateHistory = () => {
          const currentCode = codeEditor.value;
          if (currentCode !== history[historyPointer]) {
            if (historyPointer < history.length - 1) {
              history = history.slice(0, historyPointer + 1);
            }
            history.push(currentCode);
            historyPointer = history.length - 1;
          }
        };
        const runCode = () => {
          const fullCode = codeEditor.value;
          const htmlMatch = fullCode.match(/<body>([\s\S]*?)<\/body>/i);
          const cssMatch = fullCode.match(/<style>([\s\S]*?)<\/style>/i);
          const jsMatch = fullCode.match(/<script>([\s\S]*?)<\/script>/i);
          const htmlContent = htmlMatch ? htmlMatch[1] : fullCode;
          const cssContent = cssMatch ? cssMatch[1] : '';
          const jsContent = jsMatch ? jsMatch[1] : '';
          const source = `<!DOCTYPE html><html><head><style>${cssContent}</style></head><body>${htmlContent}<script>${jsContent}<\/script></body></html>`;
          previewFrame.srcdoc = source;
        };
        const saveCode = () => {
          localStorage.setItem('unified_editor_code', codeEditor.value);
          console.log('Code saved successfully');
        };
        const loadCode = () => {
          codeEditor.value =
            localStorage.getItem('unified_editor_code') ||
            `<!DOCTYPE html><html><head><title>My trial</title><style>body {font-family: sans-serif;background-color: #000000;color: #259;text-align: center;padding-top: 50px;}h1 {color: var(--primary);}</style></head><body><h1>Hello Editor</h1><p id="message">Code Here</p><script>document.getElementById('message').onclick = function() {console.log('Paragraph clicked!');};<\/script></body></html>`;
          runCode();
          history = [codeEditor.value];
          historyPointer = 0;
        };
        const newDoc = () => {
          codeEditor.value = `<!DOCTYPE html><html><head><title>New trial</title><style>body {font-family: Arial, sans-serif;background-color: #000000;color: #abb2bf;display: flex;justify-content: center;align-items: center;min-height: 100vh;margin: 0;}h1 {color: #61dafb;}</style></head><body><h1>Start Coding Here!l</h1><script>console.log("New document loaded.");<\/script></body></html>`;
          runCode();
          history = [codeEditor.value];
          historyPointer = 0;
        };
        const undo = () => {
          if (historyPointer > 0) {
            historyPointer--;
            codeEditor.value = history[historyPointer];
            runCode();
          }
        };
        const redo = () => {
          if (historyPointer < history.length - 1) {
            historyPointer++;
            codeEditor.value = history[historyPointer];
            runCode();
          }
        };
        runBtn.addEventListener('click', runCode);
        saveBtn.addEventListener('click', saveCode);
        loadBtn.addEventListener('click', loadCode);
        newBtn.addEventListener('click', newDoc);
        undoBtn.addEventListener('click', undo);
        redoBtn.addEventListener('click', redo);
        codeEditor.addEventListener('input', updateHistory);
        loadCode();
      }
      async function fetchContributions() {
        const display = document.getElementById('contribution-display');
        display.innerHTML = `<p>Loading</p>`;
        try {
          const response = await fetch(CONTRIBUTIONS_WORKER_URL);
          const contributions = await response.json();
          if (contributions && contributions.length > 0) {
            display.innerHTML = contributions
              .reverse()
              .map((c) => {
                return `<div style="background:rgba(0,0,0,0.2);padding:10px;border-radius:5px;margin-bottom:10px;"><p style="margin:0;">${c.text}</p><small style="color:var(--text-secondary);">${new Date(
                  c.timestamp,
                ).toLocaleString()}</small></div>`;
              })
              .join('');
          } else {
            display.innerHTML = `<p>Be the first to leave a message</p>`;
          }
        } catch (e) {
          display.innerHTML = `<p style="color:var(--danger);">Could not load contributions.</p>`;
        }
      }
      document
        .getElementById('contribution-form')
        .addEventListener('submit', async (e) => {
          e.preventDefault();
          const statusEl = document.getElementById('contribution-status');
          statusEl.textContent = 'Uploading';
          const formData = new FormData();
          formData.append('text', document.getElementById('contribution-text').value);
          try {
            const response = await fetch(CONTRIBUTIONS_WORKER_URL, {
              method: 'POST',
              body: formData,
            });
            if (!response.ok) throw new Error('Upload failed');
            statusEl.textContent = 'Message sent. Thank you.';
            e.target.reset();
            fetchContributions();
          } catch (err) {
            statusEl.textContent = `Error: ${err.message}`;
          }
        });
      function initWebsiteAgeDisplay() {
        const websiteAgeDisplay = document.getElementById('website-age-display');
        const creationDate = new Date(2006, 7, 7, 0, 0, 0); 
        function updateWebsiteAge() {
          const now = new Date();
          const diff = now.getTime() - creationDate.getTime();
          const seconds = Math.floor(diff / 1000);
          const minutes = Math.floor(seconds / 60);
          const hours = Math.floor(minutes / 60);
          const days = Math.floor(hours / 24);
          const years = Math.floor(days / 365.25);
          const remainingDaysAfterYears = Math.floor(days % 365.25);
          const months = Math.floor(remainingDaysAfterYears / 30.44);
          const remainingDaysAfterMonths = Math.floor(remainingDaysAfterYears % 30.44);
          const displaySeconds = seconds % 60;
          const displayMinutes = minutes % 60;
          const displayHours = hours % 24;
          let ageString = '';
          if (years > 0) ageString += `${years}T `;
          if (months > 0 || years > 0) ageString += `${months}B `;
          ageString += `${remainingDaysAfterMonths}H `;
          ageString += `${displayHours.toString().padStart(2, '0')}:`;
          ageString += `${displayMinutes.toString().padStart(2, '0')}:`;
          ageString += `${displaySeconds.toString().padStart(2, '0')}`;
          websiteAgeDisplay.textContent = `${ageString}`;
        }
        updateWebsiteAge();
        setInterval(updateWebsiteAge, 1000);
      }
      function checkEzraLoginAndShowVisitorsButton() {
        const fabLiveVisitors = document.getElementById('fab-live-visitors');
      }
      document.addEventListener('DOMContentLoaded', checkEzraLoginAndShowVisitorsButton);
      async function fetchLiveVisitors() {
        const visitorList = document.getElementById('visitor-list');
        const lastUpdatedTime = document.getElementById('last-updated-time');
        if (!visitorList.innerHTML.trim() || visitorList.innerHTML.includes('Loading visitors')) {
          visitorList.innerHTML =
            '<li style="text-align: center; color: var(--text-secondary);">Loading</li>';
        }
        try {
          const response = await fetch(LIVE_VISITORS_WORKER_URL + '?get_visitors=true');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const visitors = await response.json();
          if (visitors && visitors.length > 0) {
            visitorList.innerHTML = visitors
              .map((visitor) => {
                const timestamp = new Date(visitor.timestamp).toLocaleString('id-ID', {
                  hour: '2-digit',
                  minute: '2-digit',
                  second: '2-digit',
                  day: '2-digit',
                  month: '2-digit',
                  year: 'numeric',
                });
                return `<li><strong>ID:</strong> <span>${visitor.browserId.substring(
                  0,
                  10,
                )}</span><br><strong>IP:</strong> <span>${visitor.ip || 'N/A'}</span
                  ><br><strong>Waktu:</strong> <span>${timestamp}</span></li>`;
              })
              .join('');
          } else {
            visitorList.innerHTML =
              '<li style="text-align: center; color: var(--text-secondary);">No online</li>';
          }
          lastUpdatedTime.textContent = new Date().toLocaleTimeString('id-ID');
        } catch (error) {
          console.error('Error fetching live visitors:', error);
          visitorList.innerHTML =
            '<li style="text-align: center; color: var(--danger);">Failed</li>';
          lastUpdatedTime.textContent = 'Error';
        }
      }    
      async function fetchVisitorHistory() {
        const historyContainer = document.getElementById('visitor-history');
        historyContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Loading history</p>';
        try {
            const response = await fetch(VISITOR_HISTORY_WORKER_URL + '?get_history=true');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            let history = await response.json();
            
            if (history && history.length > 0) {
                const visitCounts = history.reduce((acc, visitor) => {
                    acc[visitor.browserId] = (acc[visitor.browserId] || 0) + 1;
                    return acc;
                }, {});

                const tableHeader = `
                    <table>
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Browser ID</th>
                                <th>IP</th>
                                <th>Referral</th>
                                <th>Total Kunjungan</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                const tableRows = history
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)) 
                    .map(visitor => {
                        const timestamp = new Date(visitor.timestamp).toLocaleString('id-ID', {
                            year: 'numeric', month: '2-digit', day: '2-digit',
                            hour: '2-digit', minute: '2-digit'
                        });
                        return `
                            <tr>
                                <td>${timestamp}</td>
                                <td>${visitor.browserId.substring(0, 10)}...</td>
                                <td>${visitor.ip || 'N/A'}</td>
                                <td>${visitor.referrer || 'Direct'}</td>
                                <td>${visitCounts[visitor.browserId] || 1}</td>
                            </tr>
                        `;
                    }).join('');

                const tableFooter = `</tbody></table>`;
                historyContainer.innerHTML = tableHeader + tableRows + tableFooter;
            } else {
                historyContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No visitor history yet</p>';
            }
        } catch (error) {
            console.error('Failed to load visitor history:', error);
            historyContainer.innerHTML = `<p style="text-align: center; color: var(--danger);">Sistem lagi crash</p>`;
        }
      }
      function getBrowserId() {
        let browserId = localStorage.getItem('unique_browser_id');
        if (!browserId) {
          browserId = 'browser_' + Math.random().toString(36).substr(2, 9) + Date.now();
          localStorage.setItem('unique_browser_id', browserId);
        }
        return browserId;
      }
      async function trackVisitor() {
        try {
          const browserId = getBrowserId();
          let ipAddress = 'unknown';
          let referrer = document.referrer || 'direct';
          try {
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            ipAddress = ipData.ip;
          } catch (ipError) {
            console.warn('Could not fetch IP address:', ipError);
          }
          const data = {
            browserId: browserId,
            ip: ipAddress,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            referrer: referrer,
          };        
          
          fetch(LIVE_VISITORS_WORKER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          }).catch((e) => console.error('Error sending to live visitors worker:', e));       
          
          fetch(VISITOR_HISTORY_WORKER_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data),
          }).catch((e) => console.error('Error sending to visitor history worker:', e));
  
        } catch (e) {
          console.error('Error in trackVisitor:', e);
        }
      }
      async function fetchMomentVaultGallery() {
        const galleryContainer = document.getElementById('moment-vault-gallery');
        galleryContainer.innerHTML =
          '<p style="text-align: center; color: var(--text-secondary);">Loading</p>';
        try {
          const response = await fetch(MOMENT_VAULT_WORKER_URL + '?get_gallery=true');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const items = await response.json();
          if (items && items.length > 0) {
            items.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            galleryContainer.innerHTML = items
              .map((item) => {
                let mediaHTML = '';
                let fileExtension = item.fileUrl.split('.').pop().toLowerCase();
                let iconClass = '';
                if (item.fileType && item.fileType.startsWith('image/')) {
                  mediaHTML = `<img src="${item.fileUrl}" alt="${item.title}">`;
                } else if (item.fileType && item.fileType.startsWith('video/')) {
                  mediaHTML = `<video src="${item.fileUrl}" controls></video>`;
                } else if (item.fileType && item.fileType.startsWith('audio/')) {
                  mediaHTML = `<audio src="${item.fileUrl}" controls></audio>`;
                } else {
                  if (fileExtension === 'pdf') iconClass = 'fa-file-pdf';
                  else if (fileExtension.startsWith('doc')) iconClass = 'fa-file-word';
                  else if (fileExtension === 'txt') iconClass = 'fa-file-alt';
                  else iconClass = 'fa-file';
                  mediaHTML = `<i class="fas ${iconClass} file-icon"></i>`;
                }
                const timestamp = new Date(item.timestamp).toLocaleString('id-ID', {
                  day: '2-digit',
                  month: '2-digit',
                  year: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit',
                });
                return `<div class="gallery-item" data-id="${item.id}"><div class="gallery-media">${mediaHTML}</div><strong>${item.title}</strong><p class="item-text">${item.description}</p><small class="item-date">${timestamp}</small><div class="item-actions"><button class="edit-moment-btn"><i class="fas fa-edit"></i></button><button class="delete-moment-btn"><i class="fas fa-trash-alt"></i></button></div></div>`;
              })
              .join('');
            galleryContainer.querySelectorAll('.edit-moment-btn').forEach((button) => {
              button.addEventListener('click', (e) => {
                const itemId = e.target.closest('.gallery-item').dataset.id;
                editMoment(itemId, items);
              });
            });
            galleryContainer.querySelectorAll('.delete-moment-btn').forEach((button) => {
              button.addEventListener('click', (e) => {
                const itemId = e.target.closest('.gallery-item').dataset.id;
                deleteMoment(itemId);
              });
            });
          } else {
            galleryContainer.innerHTML =
              '<p style="text-align: center; color: var(--text-secondary);">No uploaded yet</p>';
          }
        } catch (error) {
          console.error('Error fetching Moment Vault gallery:', error);
          galleryContainer.innerHTML =
            '<p style="text-align: center; color: var(--danger);">Failed to load gallery items.</p>';
        }
      }
      document.getElementById('moment-upload-form').addEventListener('submit', uploadMoment);
      async function uploadMoment(e) {
        e.preventDefault();
        const statusEl = document.getElementById('moment-upload-status');
        statusEl.textContent = 'Uploading';
        statusEl.style.color = 'var(--text-secondary)';
        const title = document.getElementById('moment-title').value;
        const description = document.getElementById('moment-description').value;
        const fileInput = document.getElementById('moment-file');
        const file = fileInput.files[0];
        if (!file || !title) {
          statusEl.textContent = 'Title and file are required!';
          statusEl.style.color = 'var(--danger)';
          return;
        }
        let githubToken;
        try {
          const tokenResponse = await fetch(GITHUB_TOKEN_WORKER_URL);
          if (!tokenResponse.ok) throw new Error('Failed to fetch GitHub token');
          const tokenData = await tokenResponse.json();
          githubToken = tokenData.token;
          if (!githubToken) throw new Error('GitHub token not found in response');
        } catch (error) {
          console.error('Error getting GitHub token:', error);
          statusEl.textContent = `Error: Could not get GitHub token. ${error.message}`;
          statusEl.style.color = 'var(--danger)';
          return;
        }
        try {
          const filePath = `moments/${Date.now()}-${file.name}`;
          const fileContent = await readFileAsBase64(file);
          const githubApiUrl = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${filePath}`;
          const uploadResponse = await fetch(githubApiUrl, {
            method: 'PUT',
            headers: {
              Authorization: `token ${githubToken}`,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              message: `Upload moment: ${title}`,
              content: fileContent,
              branch: 'main',
            }),
          });
          if (!uploadResponse.ok) {
            const errorText = await uploadResponse.text();
            throw new Error(`GitHub upload failed: ${uploadResponse.status} - ${errorText}`);
          }
          const uploadData = await uploadResponse.json();
          const rawFileUrl = uploadData.content.download_url;
          const momentData = {
            id: 'moment_' + Math.random().toString(36).substr(2, 9) + Date.now(),
            title: title,
            description: description,
            fileUrl: rawFileUrl,
            fileType: file.type,
            timestamp: new Date().toISOString(),
          };
          const kvSaveResponse = await fetch(MOMENT_VAULT_WORKER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(momentData),
          });
          if (!kvSaveResponse.ok) {
            throw new Error('Failed to save moment metadata to KV');
          }
          statusEl.textContent = 'successfully';
          statusEl.style.color = 'var(--success)';
          e.target.reset();
          fetchMomentVaultGallery();
        } catch (error) {
          console.error('Error uploading moment:', error);
          statusEl.textContent = `Error uploading moment: ${error.message}`;
          statusEl.style.color = 'var(--danger)';
        }
      }
      function readFileAsBase64(file) {
          return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => {
                  const base64String = reader.result.split(',')[1];
                  resolve(base64String);
              };
              reader.onerror = (error) => reject(error);
              reader.readAsDataURL(file);
          });
      }
      async function editMoment(itemId, currentItems) {
        const password = prompt('Masukkan password untuk mengedit:');
        if (password !== MOMENT_VAULT_PASSWORD) {
            alert('false');
            return;
        }
        const itemToEdit = currentItems.find((item) => item.id === itemId);
        if (!itemToEdit) return;
        const newTitle = prompt('Edit Title:', itemToEdit.title);
        if (newTitle === null) return;
        const newDescription = prompt('Edit Description:', itemToEdit.description);
        if (newDescription === null) return;
        const statusEl = document.getElementById('moment-upload-status');
        statusEl.textContent = 'Updating';
        statusEl.style.color = 'var(--text-secondary)';
        try {
          const updatedMomentData = {
            id: itemId,
            title: newTitle,
            description: newDescription,
            fileUrl: itemToEdit.fileUrl,
            fileType: itemToEdit.fileType,
            timestamp: itemToEdit.timestamp,
          };
          const response = await fetch(MOMENT_VAULT_WORKER_URL, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedMomentData),
          });
          if (!response.ok) {
            throw new Error('Failed to update moment metadata');
          }
          statusEl.textContent = 'successfully';
          statusEl.style.color = 'var(--success)';
          fetchMomentVaultGallery();
        } catch (error) {
          console.error('Error updating moment:', error);
          statusEl.textContent = `Error updating moment: ${error.message}`;
          statusEl.style.color = 'var(--danger)';
        }
      }
      async function deleteMoment(itemId) {
        const password = prompt('Masukkan password untuk menghapus:');
        if (password !== MOMENT_VAULT_PASSWORD) {
            alert('false');
            return;
        }
        if (!confirm('Are you sure you want to delete? This action cannot be undone.')) {
          return;
        }
        const statusEl = document.getElementById('moment-upload-status');
        statusEl.textContent = 'Deleting';
        statusEl.style.color = 'var(--text-secondary)';
        try {
          let githubToken;
          try {
            const tokenResponse = await fetch(GITHUB_TOKEN_WORKER_URL);
            if (!tokenResponse.ok) throw new Error('Failed to fetch GitHub token');
            const tokenData = await tokenResponse.json();
            githubToken = tokenData.token;
            if (!githubToken) throw new Error('GitHub token not found in response');
          } catch (error) {
            console.error('Error getting GitHub token for delete:', error);
            statusEl.textContent = `Error: Could not get GitHub token for deletion. ${error.message}`;
            statusEl.style.color = 'var(--danger)';
            return;
          }
          const galleryResponse = await fetch(MOMENT_VAULT_WORKER_URL + '?get_gallery=true');
          if (!galleryResponse.ok) throw new Error('Failed to fetch gallery to find file path');
          const galleryItems = await galleryResponse.json();
          const itemToDelete = galleryItems.find((item) => item.id === itemId);
          if (!itemToDelete || !itemToDelete.fileUrl) {
            throw new Error('its file URL not found.');
          }
          let filePathOnGithub;
          const rawGithubContentBase = `https://raw.githubusercontent.com/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/main/`;
          if (itemToDelete.fileUrl.startsWith(rawGithubContentBase)) {
            filePathOnGithub = itemToDelete.fileUrl.substring(rawGithubContentBase.length);
          } else {
            console.warn(
              'Unexpected file URL format, attempting fallback path extraction:',
              itemToDelete.fileUrl,
            );
            filePathOnGithub = `moments/${itemToDelete.fileUrl.split('/').pop()}`;
          }
          const githubApiGetFileUrl = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${filePathOnGithub}`;
          const getFileResponse = await fetch(githubApiGetFileUrl, {
            headers: {
              Authorization: `token ${githubToken}`,
              Accept: 'application/vnd.github.v3+json',
            },
          });
          if (!getFileResponse.ok) {
            const errorText = await getFileResponse.text();
            throw new Error(`Failed to get file SHA from GitHub: ${getFileResponse.status} - ${errorText}`);
          }
          const fileMetaData = await getFileResponse.json();
          const fileSha = fileMetaData.sha;
          const githubDeleteUrl = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${filePathOnGithub}`;
          const deleteResponse = await fetch(githubDeleteUrl, {
            method: 'DELETE',
            headers: {
              Authorization: `token ${githubToken}`,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              message: `Delete moment: ${itemToDelete.title}`,
              sha: fileSha,
              branch: 'main',
            }),
          });
          if (!deleteResponse.ok) {
            const errorText = await deleteResponse.text();
            throw new Error(`GitHub deletion failed: ${deleteResponse.status} - ${errorText}`);
          }
          const kvDeleteResponse = await fetch(
            MOMENT_VAULT_WORKER_URL + `?delete_moment_id=${itemId}`,
            {
              method: 'DELETE',
            },
          );
          if (!kvDeleteResponse.ok) {
            throw new Error('Failed to delete');
          }
          statusEl.textContent = 'successfully';
          statusEl.style.color = 'var(--success)';
          fetchMomentVaultGallery();
        } catch (error) {
          console.error('Error deleting moment:', error);
          statusEl.textContent = `Error deleting moment: ${error.message}`;
          statusEl.style.color = 'var(--danger)';
        }
      }

      function initVisualizer() {
        visualizerCanvas = document.getElementById('visualizer-canvas');
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        renderer = new THREE.WebGLRenderer({ canvas: visualizerCanvas, alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        const icosahedronGeometry = new THREE.IcosahedronGeometry(1, 1);
        const icosahedronColors = [];
        const color = new THREE.Color();
        for (let i = 0; i < icosahedronGeometry.attributes.position.count; i++) {
            color.setHSL(i / icosahedronGeometry.attributes.position.count, 0.7, 0.6);
            icosahedronColors.push(color.r, color.g, color.b);
        }
        icosahedronGeometry.setAttribute('color', new THREE.Float32BufferAttribute(icosahedronColors, 3));
        const icosahedronMaterial = new THREE.MeshBasicMaterial({ vertexColors: true, wireframe: true });
        icosahedron = new THREE.Mesh(icosahedronGeometry, icosahedronMaterial);
        scene.add(icosahedron);
        
        frequencyBarsGroup = new THREE.Group();
        scene.add(frequencyBarsGroup);

        const particlesGeometry = new THREE.BufferGeometry();
        const particlesMaterial = new THREE.PointsMaterial({ size: 0.05, vertexColors: true });
        const particlePositions = [];
        const particleColors = [];
        for (let i = 0; i < PARTICLE_COUNT; i++) {
            particlePositions.push((Math.random() - 0.5) * 15, (Math.random() - 0.5) * 15, (Math.random() - 0.5) * 15);
            color.setHSL(Math.random(), 1.0, 0.5);
            particleColors.push(color.r, color.g, color.b);
        }
        particlesGeometry.setAttribute('position', new THREE.Float32BufferAttribute(particlePositions, 3));
        particlesGeometry.setAttribute('color', new THREE.Float32BufferAttribute(particleColors, 3));
        particles3D = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particles3D);

        window.addEventListener('resize', onWindowResize, false);
      }
      
      function createFrequencyBars(analyser) {
        while(frequencyBarsGroup.children.length > 0){ 
            const obj = frequencyBarsGroup.children[0];
            frequencyBarsGroup.remove(obj); 
        }

        const sampleRate = analyser.context.sampleRate;
        const fftSize = analyser.fftSize;
        const binWidth = sampleRate / fftSize;

        const startIndex = Math.ceil(FREQ_RANGE_START_HZ / binWidth);
        const endIndex = Math.floor(FREQ_RANGE_END_HZ / binWidth);
        const numBars = endIndex - startIndex + 1;

        for (let i = 0; i < numBars; i++) {
            const barHeight = 0.1;
            const barWidth = 0.02;
            const geometry = new THREE.PlaneGeometry(barWidth, barHeight);

            const hue = 0.6 + (i / numBars) * 0.3;
            const color = new THREE.Color().setHSL(hue, 0.8, 0.6);
            const material = new THREE.MeshBasicMaterial({ color: color });
            
            const bar = new THREE.Mesh(geometry, material);
            const angle = (i / numBars) * Math.PI * 2;
            const radius = 2.0;

            const wrapper = new THREE.Object3D();
            wrapper.position.x = Math.cos(angle) * radius;
            wrapper.position.y = Math.sin(angle) * radius;
            wrapper.rotation.z = angle + Math.PI / 2;
            
            bar.position.y = barHeight / 2;
            wrapper.add(bar);
            frequencyBarsGroup.add(wrapper);
        }
      }


      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function setupAudioVisualizer() {
        const audioPlayer = document.getElementById('audio-player');
        if (!audioPlayer.src) {
          alert('Pilih lagu terlebih dahulu');
          return false;
        }
        if (!audioContext) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          source = audioContext.createMediaElementSource(audioPlayer);
          analyser = audioContext.createAnalyser();
          source.connect(analyser);
          analyser.connect(audioContext.destination);
          
          analyser.fftSize = 8192; 
          analyser.minDecibels = -90;
          analyser.maxDecibels = -10;
          analyser.smoothingTimeConstant = 0.85;

          bufferLength = analyser.frequencyBinCount;
          frequencyData = new Uint8Array(bufferLength);
          
          createFrequencyBars(analyser);
        }
        return true;
      }

      function drawVisualizer() {
        if (!isVisualizerActive) return;

        requestAnimationFrame(drawVisualizer);
        analyser.getByteFrequencyData(frequencyData);
        
        const binWidth = analyser.context.sampleRate / analyser.fftSize;
        const startIndex = Math.ceil(FREQ_RANGE_START_HZ / binWidth);

        frequencyBarsGroup.children.forEach((wrapper, index) => {
            const bar = wrapper.children[0];
            const dataIndex = startIndex + index;
            const amplitude = frequencyData[dataIndex] / 255;
            const newScale = Math.max(0.05, amplitude * 3.5);
            bar.scale.y = newScale;
        });
        frequencyBarsGroup.rotation.z -= 0.001;

        const lowerHalfArray = frequencyData.slice(0, Math.floor(bufferLength / 4));
        const overallAvg = lowerHalfArray.reduce((prev, curr) => prev + curr, 0) / lowerHalfArray.length;
        const bassAvg = frequencyData.slice(0, 10).reduce((prev, curr) => prev + curr, 0) / 10;

        const pulse = 1 + (overallAvg / 255) * 0.8;
        icosahedron.scale.set(pulse, pulse, pulse);
        icosahedron.rotation.x += 0.002;
        icosahedron.rotation.y += 0.003;

        if (bassAvg > lastBassLevel * BASS_BEAT_THRESHOLD && bassAvg > 60) {
            const colors = particles3D.geometry.attributes.color.array;
            const color = new THREE.Color();
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                color.setHSL(Math.random(), 1.0, 0.5);
                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }
            particles3D.geometry.attributes.color.needsUpdate = true;
        }
        lastBassLevel = bassAvg;

        particles3D.rotation.y += 0.0005;

        renderer.render(scene, camera);
      }

      function toggleVisualizerOverlay() {
        const body = document.body;
        if (!isVisualizerActive) {
          if (!setupAudioVisualizer()) return;
          isVisualizerActive = true;
          body.classList.add('visualizer-active');
          drawVisualizer(); 
          toggleFullscreen();
        } else {
          isVisualizerActive = false;
          body.classList.remove('visualizer-active');
          toggleFullscreen();
        }
      }

      function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
                console.log(`Error when system attempting to enable fullscreen: ${err.message}`);
            });
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
      }
      
      function initPasswordFeature() {
            const keyboardToggleButton = document.getElementById('fab-keyboard-toggle');
            const liveVisitorsButton = document.getElementById('fab-live-visitors');
            const centerVideoContainer = document.getElementById('center-video-container');
            const centerVideoPlayer = document.getElementById('center-video-player');
            const centerVideoCloseBtn = document.getElementById('center-video-close');
            
            const passwordMap = {
                'mylove': () => {
                    liveVisitorsButton.style.display = 'flex';
                    liveVisitorsButton.setAttribute('data-unlocked', 'true');
                },
                'elvy': () => {
                    centerVideoContainer.classList.add('active');
                    centerVideoPlayer.src = '/dashboard/stiker.mp4';
                    centerVideoPlayer.play();
                },
                'elvi': () => {
                    // MODIFIKASI FUNGSI 'elvi'
                    isElviModeActive = true; 
                    const block = document.getElementById('block-2-3');
                    if (block) {
                        const backgroundDiv = block.querySelector('.grid-block-background');
                        if (backgroundDiv) {
                            backgroundDiv.style.background = `url('/dashboard/elvi.jpg') center center / cover no-repeat`;
                            backgroundDiv.style.filter = 'none';
                            backgroundDiv.style.webkitFilter = 'none';
                        }
                      const contentDiv = block.querySelector('.grid-block-content');
        if (contentDiv) {
            contentDiv.style.display = 'none';
                    }
                    updateUIVisibility();
                    }
                }
            };
            keyboardToggleButton.addEventListener('click', () => {
                const enteredPassword = prompt("Please enter the password:");
                if (enteredPassword && passwordMap[enteredPassword]) {
                    passwordMap[enteredPassword]();
                } else if (enteredPassword !== null) { 
                    alert('Incorrect password!');
                }
            });

            centerVideoCloseBtn.addEventListener('click', () => {
                centerVideoPlayer.pause();
                centerVideoPlayer.src = '';
                centerVideoContainer.classList.remove('active');
            });
      }

      function initSecurityFeatures() {
            document.addEventListener('contextmenu', (e) => e.preventDefault());
            document.addEventListener('copy', (e) => e.preventDefault());
            document.addEventListener('cut', (e) => e.preventDefault());
            window.addEventListener('keyup', (e) => {
                if (e.key === 'PrintScreen') {
                    const popup = document.getElementById('screenshot-popup');
                    popup.style.display = 'block';
                    setTimeout(() => { popup.style.display = 'none'; }, 3000);
                }
            });
      }

      function checkFirstVisit() {
        const hasVisited = localStorage.getItem('hasVisitedWebsite');
        const browserId = getBrowserId();
        if (!hasVisited) {
            const popup = document.getElementById('new-user-popup');
            const closeBtn = document.getElementById('popup-close-btn');

            popup.style.display = 'block';
            console.log(`Welcome, new visitor Browser ID: ${browserId}`);
            console.log("For the best experience, please use our app: https://drive.google.com/file/d/11fQBWB9C1PjUQvb8b-IqHdNLS7YkFSFD/view?usp=drivesdk and switch to landscape mode.");
            console.log("Privacy Policy: We collect anonymous data like browser ID and IP address for statistical analysis. This data will not be shared.");

            closeBtn.addEventListener('click', () => {
                popup.style.display = 'none';
                localStorage.setItem('hasVisitedWebsite', 'true');
            });
        } else {
            console.log(`Welcome back ID: ${browserId}`);
        }
      }
    </script>
  </body>
</html>
