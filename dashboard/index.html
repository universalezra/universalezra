<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ezra's Digital Nexus - Security Dashboard</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- Root Variables & Base Styles --- */
        :root {
            --primary-accent: #00FFC2; /* Bright green/cyan for highlights */
            --primary-dark: #00A880;   /* Darker shade of primary-accent */
            --secondary-accent: #00E0FF; /* Blue for secondary highlights */
            --text-light: #E0E0E0;     /* Light text for dark background */
            --text-muted: #A0A0A0;     /* Muted text for secondary info */
            --bg-darkest: #010103;     /* Deep black background */
            --bg-dark: #08080F;        /* Slightly lighter background for panels */
            --bg-medium: #151520;      /* Medium dark for active states/hover */
            --border-color: rgba(0, 255, 194, 0.15); /* Subtle border with primary tint */
            --input-bg: rgba(25, 25, 40, 0.6); /* Darker input background */
            --panel-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-main: 'Roboto Mono', monospace;
            --font-display: 'Orbitron', sans-serif;
            --header-height: 70px;

            /* Rainbow Colors (Fixed Palette for consistency) */
            --rainbow-0: #FF0000; /* Red */
            --rainbow-1: #FF8C00; /* DarkOrange */
            --rainbow-2: #FFFF00; /* Yellow */
            --rainbow-3: #00FF00; /* Lime */
            --rainbow-4: #00FFFF; /* Aqua */
            --rainbow-5: #0000FF; /* Blue */
            --rainbow-6: #9400D3; /* DarkViolet */
        }

        /* Light Theme (Adjusted for Professional Look) */
        [data-theme="light"] {
            --primary-accent: #3498db;
            --primary-dark: #2980b9;
            --secondary-accent: #e67e22;
            --text-light: #34495e;
            --text-muted: #7f8c8d;
            --bg-darkest: #f0f2f5;
            --bg-dark: #ffffff;
            --bg-medium: #e0e0e0;
            --border-color: #bdc3c7;
            --input-bg: rgba(255, 255, 255, 0.8);
            --panel-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Base Styles */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* Prevent body scroll, main content handles scroll */
        }
        body {
            background: radial-gradient(circle at center, var(--bg-medium), var(--bg-darkest));
            color: var(--text-light);
            font-family: var(--font-main);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            transition: background var(--transition-speed) ease, color var(--transition-speed) ease;
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 { font-family: var(--font-display); color: var(--primary-accent); margin-bottom: 0.5em; }

        /* Buttons */
        button {
            cursor: pointer; padding: 0.8rem 1.6rem; border: 1px solid var(--primary-accent);
            border-radius: var(--border-radius); background: rgba(0, 0, 0, 0.4);
            color: var(--primary-accent); font-family: inherit; font-size: 0.95rem;
            transition: all var(--transition-speed) ease;
            display: inline-flex; align-items: center; justify-content: center; gap: 0.6rem;
            text-transform: uppercase; letter-spacing: 0.05em;
            outline: none; /* Remove default focus outline */
        }
        button:focus-visible { /* For keyboard navigation */
            box-shadow: 0 0 0 3px rgba(0, 255, 194, 0.5);
            border-color: var(--secondary-accent);
        }
        button:hover:not(:disabled) {
            background: rgba(var(--primary-accent), 0.1); /* Use rgba for opacity with variable */
            box-shadow: 0 0 15px rgba(0, 255, 194, 0.5); /* Direct rgba for consistent effect */
            transform: translateY(-3px) scale(1.02);
        }
        button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: none;
            background: rgba(0, 0, 0, 0.6);
        }
        button:disabled { opacity: 0.6; cursor: not-allowed; border-color: var(--text-muted); color: var(--text-muted); }
        button.primary-btn { background: var(--primary-accent); color: var(--bg-darkest); font-weight: bold; }
        button.primary-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            box-shadow: 0 0 20px var(--primary-accent);
            animation: pulseEffect 1.2s infinite;
        }
        @keyframes pulseEffect {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 194, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0, 255, 194, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 194, 0); }
        }

        /* Inputs & Textareas */
        input, textarea {
            padding: 0.8rem 1.2rem; background: var(--input-bg); border: 1px solid var(--border-color);
            border-radius: var(--border-radius); color: var(--text-light); width: 100%;
            margin-bottom: 15px; resize: vertical; font-family: var(--font-main);
            font-size: 1rem; transition: all var(--transition-speed) ease;
            outline: none; /* Remove default focus outline */
        }
        input:focus, textarea:focus {
            border-color: var(--primary-accent); box-shadow: 0 0 12px var(--primary-accent);
            background-color: var(--bg-dark);
        }
        textarea { min-height: 100px; }

        /* Links */
        a { color: var(--secondary-accent); text-decoration: none; transition: color var(--transition-speed) ease; }
        a:hover { color: var(--primary-accent); text-decoration: underline; }

        /* Header */
        header {
            width: 100%; height: var(--header-height); background-color: var(--bg-dark);
            display: flex; justify-content: space-between; align-items: center; padding: 0 30px;
            box-shadow: var(--panel-shadow); z-index: 1000; flex-shrink: 0;
            border-bottom: 1px solid var(--border-color);
        }
        header .logo {
            font-size: 2.2em; font-weight: bold; color: var(--primary-accent);
            letter-spacing: 0.08em; font-family: var(--font-display);
            text-shadow: 0 0 10px rgba(0, 255, 194, 0.5);
        }

        /* Dashboard Layout */
        .dashboard-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-x: auto; /* Enable horizontal scrolling for the main content area */
            width: 100%;
            padding-bottom: 20px; /* Space for horizontal scrollbar */
            background-image: url('data:image/svg+xml;utf8,<svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><g fill="%230F0F1A" fill-opacity="0.4"><path d="M0 0h1v1H0zm2 2h1v1H2zm2 2h1v1H4zm2 2h1v1H6zm2 2h1v1H8zm-9 1h1v1H-1zm2 2h1v1H1zm2 2h1v1H3zm2 2h1v1H5zm2 2h1v1H7zM-1 2h1v1H-1zm2 2h1v1H1zm2 2h1v1H3zm2 2h1v1H5zm2 2h1v1H7zM0 9h1v1H0zm2 2h1v1H2zm2 2h1v1H4zm2 2h1v1H6zm2 2h1v1H8zM-1 0h1v1H-1zm2 2h1v1H1zm2 2h1v1H3zm2 2h1v1H5zm2 2h1v1H7z" /></g></svg>'); /* Subtle grid background */
            background-size: 20px 20px;
            position: relative; /* For website age container */
        }
        .main-content {
            flex-grow: 1;
            padding: 30px;
            min-width: 1024px; /* Force horizontal width as requested */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center the main content wrapper horizontally */
        }
        .main-content-wrapper {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap; /* Allow panels to wrap to next row */
            gap: 25px;
            width: 100%;
            max-width: 1280px; /* Overall max width for content inside 1024px minimum */
            justify-content: center; /* Center panels if not enough to fill row */
        }

        /* Panels */
        .panel {
            background-color: var(--bg-dark); border-radius: var(--border-radius);
            box-shadow: var(--panel-shadow); padding: 25px; backdrop-filter: blur(8px);
            border: 1px solid var(--border-color); position: relative;
            display: flex; flex-direction: column; overflow: hidden;
            animation: panelFadeIn 0.6s ease-out forwards;
            min-height: 350px;
            width: calc(50% - 12.5px); /* Two columns layout for main panels */
            max-width: 600px; /* Max width for single panel */
        }
        .panel.hidden { display: none !important; } /* Use !important to override flex/grid */
        @keyframes panelFadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .panel-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 194, 0.1); /* Use consistent rgba */
            position: sticky; top: 0; background-color: var(--bg-dark); z-index: 10;
        }
        .panel-header h3 { color: var(--primary-accent); font-size: 1.5em; letter-spacing: 0.03em; }
        .panel .close-btn {
            background: none; border: none; color: var(--text-muted);
            font-size: 1.3em; cursor: pointer; transition: color var(--transition-speed) ease, transform var(--transition-speed) ease;
        }
        .panel .close-btn:hover { color: var(--secondary-accent); transform: rotate(90deg); }
        .panel .close-btn:focus-visible {
            outline: 2px solid var(--secondary-accent);
            outline-offset: 2px;
        }

        /* Specific Panel Styles */
        #code-editor-panel textarea {
            flex-grow: 1; font-family: 'Fira Code', 'Cascadia Code', monospace; font-size: 0.95em;
            white-space: pre; word-wrap: normal; overflow: auto; min-height: 200px;
            line-height: 1.5; /* Improve readability */
        }
        #code-preview {
            width: 100%; height: 250px; border: 1px solid var(--border-color);
            background-color: var(--bg-darkest); border-radius: var(--border-radius); margin-top: 15px;
            resize: vertical; /* Allow resizing the preview */
            min-height: 100px;
        }
        #music-player-panel audio { width: 100%; margin-bottom: 15px; }
        #music-player-panel .audio-controls { display: flex; justify-content: space-around; gap: 10px; margin-top: 10px; flex-wrap: wrap;}
        #music-player-panel .audio-controls button { flex-grow: 1; min-width: 80px; } /* Ensure buttons are somewhat equal */
        #playlist-items {
            list-style: none; margin-top: 15px; padding: 0; max-height: 180px;
            overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--border-radius);
            background-color: rgba(0, 0, 0, 0.2);
        }
        #playlist-items li {
            padding: 10px 15px; cursor: pointer; transition: background-color var(--transition-speed) ease;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px dashed rgba(var(--border-color), 0.5);
        }
        #playlist-items li.active { background-color: var(--primary-accent); color: var(--bg-darkest); font-weight: bold; }
        #playlist-items li:hover:not(.active) { background-color: var(--bg-medium); }

        #contribute-panel form { display: flex; flex-direction: column; gap: 15px; flex-grow: 1; }
        #contribute-message { margin-top: 15px; font-size: 0.9em; text-align: center; } /* Remove specific color here */
        #contributor-messages-list {
            list-style: none; padding: 0; max-height: 200px; overflow-y: auto;
            border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-top: 20px;
            background-color: rgba(0, 0, 0, 0.2);
        }
        #contributor-messages-list li {
            padding: 10px 15px; border-bottom: 1px dashed var(--border-color); font-size: 0.95em;
        }
        #contributor-messages-list li:last-child { border-bottom: none; }
        #contributor-messages-list .message-meta { font-size: 0.85em; color: var(--text-muted); margin-top: 8px; }

        #live-visitors-panel { min-height: 350px; }
        #live-visitors-panel ul {
            list-style: none; padding: 0; max-height: 220px; overflow-y: auto;
            border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: 15px;
            background-color: rgba(0, 0, 0, 0.2);
        }
        #live-visitors-panel ul li {
            padding: 10px 15px; border-bottom: 1px dashed var(--border-color); font-size: 0.95em;
        }
        #live-visitors-panel ul li:last-child { border-bottom: none; }
        #live-visitors-panel .refresh-info {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.85em; color: var(--text-muted); margin-top: 15px;
        }
        #live-visitors-panel .loading-indicator {
            text-align: center; color: var(--text-muted); padding: 20px;
        }

        /* Random Ditolak Cewek Text Panel */
        #ditolak-cewek-text-panel {
            width: calc(100% - 50px); /* Span almost full width of main content */
            max-width: 1200px; /* Match main-content-wrapper max-width for consistency */
            background-color: var(--bg-dark);
            border-radius: var(--border-radius);
            box-shadow: var(--panel-shadow);
            padding: 25px;
            backdrop-filter: blur(8px);
            border: 1px solid var(--border-color);
            text-align: center;
            font-size: 1.4em;
            font-weight: bold;
            color: var(--secondary-accent); /* Use a warning-like color */
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap; /* Allow text to wrap */
            margin-bottom: 25px; /* Space before other panels */
            text-shadow: 0 0 10px rgba(0, 224, 255, 0.3);
        }
        #ditolak-cewek-text-panel span {
            display: inline-block; /* Essential for individual letter coloring */
        }

        /* FAB & Social Links */
        .fab-container {
            position: fixed; bottom: 30px; right: 30px; display: flex;
            flex-direction: column; gap: 12px; z-index: 999;
        }
        .fab {
            background: rgba(0,0,0,.6); border: 1px solid var(--primary-accent); color: var(--primary-accent);
            border-radius: 50%; width: 55px; height: 55px; font-size: 1.6em; box-shadow: var(--panel-shadow);
            display: flex; justify-content: center; align-items: center; transition: all var(--transition-speed) ease;
            outline: none;
        }
        .fab:focus-visible {
            box-shadow: 0 0 0 3px var(--secondary-accent);
        }
        .fab:hover {
            background-color: rgba(0, 255, 194, 0.15); /* Use direct rgba */
            transform: scale(1.1); box-shadow: 0 0 15px var(--primary-accent);
        }
        .social-links {
            position: fixed; bottom: 30px; left: 30px; display: flex;
            flex-direction: column; gap: 20px; z-index: 999;
        }
        .social-links a {
            color: var(--text-light); font-size: 2.2em; transition: all var(--transition-speed) ease;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
            outline: none;
        }
        .social-links a:focus-visible {
            box-shadow: 0 0 0 3px var(--secondary-accent);
            outline-offset: 2px;
        }
        .social-links a:hover { color: var(--primary-accent); transform: scale(1.2) rotate(5deg); text-shadow: 0 0 15px var(--primary-accent); }

        /* Private User Panel (Login Modal) */
        #private-user-panel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 450px; padding: 40px; z-index: 1001; text-align: center;
            background: var(--bg-dark); border: 1px solid var(--border-color);
            border-radius: var(--border-radius); box-shadow: var(--panel-shadow);
            animation: fadeInScale 0.4s ease-out forwards;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: translate(-50%, -40%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        #private-user-panel h3 { margin-bottom: 25px; color: var(--primary-accent); font-size: 1.8em; }
        #private-user-panel input { margin-bottom: 20px; text-align: center; }
        #private-user-panel button { width: 100%; }
        #private-user-message { margin-top: 15px; font-weight: bold; } /* Color handled by JS */
        .message-success { color: var(--primary-accent); }
        .message-error { color: #FF4444; }

        /* Login Form specific styles for ezra.js integration */
        #loginForm { display: flex; flex-direction: column; gap: 15px; }
        #status, #errorMsg, #ipDisplay, #webauthnUnsupported { font-size: 0.9em; margin-top: 10px; }
        #status { color: var(--text-muted); }
        #errorMsg { color: #FF4444; }
        #ipDisplay { color: var(--primary-accent); }
        #loadingSpinner { margin: 15px auto; }
        .toggle-password {
            background: none; border: none; color: var(--text-muted);
            font-size: 1em; cursor: pointer; position: absolute; right: 10px; top: 50%;
            transform: translateY(-50%); outline: none;
        }
        .input-group { position: relative; } /* For password toggle */


        /* Ezra Private Space */
        #ezra-panel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95); z-index: 1002; display: flex;
            flex-direction: column; padding: 30px; overflow-y: auto;
            transition: opacity 0.4s ease-out, visibility 0.4s ease-out; visibility: hidden; opacity: 0;
        }
        #ezra-panel.active { visibility: visible; opacity: 1; }
        #ezra-panel .panel-header { justify-content: space-between; margin-bottom: 30px; }
        #ezra-panel .panel-header h3 { font-size: 2.5em; text-align: center; flex-grow: 1; }
        #ezra-panel .logout-btn { background-color: #e74c3c; color: var(--text-light); border-color: #e74c3c; }
        #ezra-panel .logout-btn:hover { background-color: #c0392b; box-shadow: 0 0 15px #e74c3c; }

        #ezra-gallery-container {
            flex-grow: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px; padding: 25px; background-color: rgba(10, 10, 18, 0.8);
            border-radius: var(--border-radius); overflow-y: auto; margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }
        .gallery-item {
            background-color: var(--bg-dark); border-radius: var(--border-radius);
            box-shadow: var(--panel-shadow); overflow: hidden; position: relative;
            display: flex; flex-direction: column; border: 1px solid var(--border-color);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5), 0 0 20px var(--primary-accent);
        }
        .gallery-item img, .gallery-item video, .gallery-item .document-preview {
            width: 100%; height: 220px; object-fit: cover; display: flex;
            background-color: var(--bg-darkest); color: var(--text-muted);
            align-items: center; justify-content: center; font-size: 2em;
            border-bottom: 1px solid var(--border-color);
        }
        .gallery-item .document-preview {
            border: 1px dashed var(--border-color); padding: 20px; box-sizing: border-box;
            word-break: break-all; text-align: center; flex-direction: column; gap: 10px;
            font-size: 1.2em; /* Smaller font for document icons */
        }
        .gallery-item-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .gallery-item-info h4 { color: var(--primary-accent); margin-bottom: 8px; font-size: 1.3em; }
        .gallery-item-info p {
            font-size: 0.95em; color: var(--text-light); margin-bottom: 15px; flex-grow: 1;
        }
        .gallery-item-info small { font-size: 0.85em; color: var(--text-muted); text-align: right; display: block; }
        .gallery-item-controls {
            position: absolute; top: 15px; right: 15px; display: flex; gap: 8px;
            background-color: rgba(0, 0, 0, 0.6); border-radius: 5px; padding: 8px;
        }
        .gallery-item-controls button {
            background: none; border: none; color: var(--text-light); font-size: 1.1em; padding: 6px;
            transition: color var(--transition-speed) ease;
            outline: none;
        }
        .gallery-item-controls button:hover { color: var(--primary-accent); background-color: rgba(255, 255, 255, 0.15); border-radius: 4px; }
        .gallery-item-controls button:focus-visible {
            outline: 2px solid var(--secondary-accent);
            outline-offset: 2px;
        }

        #ezra-content-form {
            display: flex; flex-direction: column; gap: 20px; background-color: var(--bg-dark);
            padding: 30px; border-radius: var(--border-radius); margin-top: 30px;
            border: 1px solid var(--border-color);
        }
        #ezra-content-form h4 { color: var(--primary-accent); margin-bottom: 15px; font-size: 1.5em; }
        #ezra-content-form .form-row { display: flex; flex-direction: column; gap: 15px; }
        #ezra-content-form button { align-self: flex-end; margin-top: 15px; }
        .message-status { text-align: center; margin-top: 15px; font-size: 0.9em; } /* Color handled by JS */

        /* Website Age */
        .website-age-container {
            background-color: var(--bg-dark); border: 1px solid var(--border-color);
            border-radius: var(--border-radius); box-shadow: var(--panel-shadow);
            padding: 18px 25px; margin-top: 30px; text-align: center; color: var(--text-light);
            font-size: 0.95em; display: flex; flex-direction: column; align-items: center;
            gap: 8px; width: fit-content; margin-left: auto; margin-right: auto;
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 998; /* Ensure it's below FABs but above main content */
        }
        .website-age-container p:first-child { color: var(--text-muted); }
        #website-age { font-weight: bold; color: var(--primary-accent); font-size: 1.2em; letter-spacing: 0.05em; }

        /* Rainbow Text Universal */
        .rainbow-text-universal span {
             display: inline-block; /* Essential for individual letter styling */
             transition: color 0.1s linear; /* Smooth transition for rainbow effect */
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-accent);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsiveness */
        @media (max-width: 1023px) {
            .main-content {
                min-width: unset; /* Remove forced min-width on smaller screens */
                padding: 20px;
            }
            .main-content-wrapper {
                flex-direction: column; /* Stack panels vertically */
                align-items: center;
                width: 100%;
            }
            .panel {
                width: 95%; /* Full width for panels */
                max-width: 650px; /* Still apply a max-width for readability */
                min-height: 300px;
                padding: 20px;
            }
            #ditolak-cewek-text-panel {
                width: 95%;
                font-size: 1.2em;
                padding: 20px;
                min-height: 100px;
            }
            .fab-container {
                bottom: 20px;
                right: 50%;
                transform: translateX(50%);
                flex-direction: row; /* Layout FABs horizontally */
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                width: auto; /* Allow content to dictate width */
            }
            .social-links {
                bottom: 20px;
                left: 20px;
                flex-direction: row; /* Layout social links horizontally */
                gap: 15px;
            }
            .fab, .social-links a {
                width: 48px; height: 48px; font-size: 1.4em;
            }
            header { padding: 0 15px; height: 60px; }
            header .logo { font-size: 1.6em; }
            #ezra-panel .panel-header h3 { font-size: 1.8em; }
            #ezra-gallery-container { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
            .website-age-container {
                position: static; /* Make it flow with content on small screens */
                transform: translateX(0);
                margin-top: 20px;
            }
        }

        @media (max-width: 500px) {
            .panel {
                padding: 15px;
            }
            .panel-header h3 {
                font-size: 1.3em;
            }
            .fab, .social-links a {
                width: 40px; height: 40px; font-size: 1.2em;
            }
            .fab-container {
                gap: 8px;
            }
            .social-links {
                left: 15px;
                bottom: 15px;
                gap: 10px;
            }
            #private-user-panel {
                padding: 25px;
            }
            #ezra-panel {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo" id="rainbow-logo">Ezra's Digital Nexus</div>
    </header>

    <div class="dashboard-container">
        <main class="main-content">
            <div id="ditolak-cewek-text-panel">
                <span id="ditolak-cewek-output">Memuat kutipan inspiratif...</span>
            </div>

            <div class="main-content-wrapper">
                <div id="code-editor-panel" class="panel hidden" aria-labelledby="code-editor-title">
                    <div class="panel-header">
                        <h3 id="code-editor-title"><span class="rainbow-text-universal">Code Editor</span></h3>
                        <button class="close-btn" data-target="code-editor-panel" aria-label="Close Code Editor"><i class="fas fa-times"></i></button>
                    </div>
                    <textarea id="unified-editor" spellcheck="false" placeholder="Tulis HTML, CSS, dan JavaScript Anda di sini..." aria-label="HTML CSS JavaScript Editor"></textarea>
                    <button id="run-code" class="primary-btn"><i class="fas fa-play"></i> Run Code</button>
                    <h4><span class="rainbow-text-universal">Preview:</span></h4>
                    <iframe id="code-preview" title="Code Preview" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
                </div>

                <div id="music-player-panel" class="panel hidden" aria-labelledby="music-player-title">
                    <div class="panel-header">
                        <h3 id="music-player-title"><span class="rainbow-text-universal">Music Player</span></h3>
                        <button class="close-btn" data-target="music-player-panel" aria-label="Close Music Player"><i class="fas fa-times"></i></button>
                    </div>
                    <audio id="music-audio" controls preload="auto" aria-label="Music Player Audio"></audio>
                    <div class="audio-controls">
                        <button id="play-pause-btn" aria-label="Play/Pause"><i class="fas fa-play"></i> Play</button>
                        <button id="prev-btn" aria-label="Previous Track"><i class="fas fa-backward"></i> Prev</button>
                        <button id="next-btn" aria-label="Next Track"><i class="fas fa-forward"></i> Next</button>
                        <button id="shuffle-btn" aria-label="Toggle Shuffle"><i class="fas fa-random"></i> Shuffle</button>
                        <button id="repeat-btn" aria-label="Toggle Repeat"><i class="fas fa-redo"></i> Repeat</button>
                    </div>
                    <h4><span class="rainbow-text-universal">Playlist:</span></h4>
                    <ul id="playlist-items" role="listbox" aria-label="Music Playlist"></ul>
                </div>

                <div id="contribute-panel" class="panel hidden" aria-labelledby="contribute-title">
                    <div class="panel-header">
                        <h3 id="contribute-title"><span class="rainbow-text-universal">Kontribusi Pesan</span></h3>
                        <button class="close-btn" data-target="contribute-panel" aria-label="Close Contribute Panel"><i class="fas fa-times"></i></button>
                    </div>
                    <form id="contribute-form">
                        <input type="text" id="contributor-name" placeholder="Nama Anda (Opsional)" aria-label="Your Name">
                        <textarea id="contribute-text" placeholder="Tulis pesan Anda di sini..." required aria-label="Your Message"></textarea>
                        <button type="submit" class="primary-btn"><i class="fas fa-paper-plane"></i> Kirim Pesan</button>
                    </form>
                    <p id="contribute-message" role="status" aria-live="polite"></p>
                    <h4><span class="rainbow-text-universal">Pesan Terkini:</span></h4>
                    <ul id="contributor-messages-list" role="list">
                        <li><div class="spinner"></div> Memuat pesan...</li>
                    </ul>
                </div>

                <div id="live-visitors-panel" class="panel hidden" aria-labelledby="visitors-title">
                    <div class="panel-header">
                        <h3 id="visitors-title"><span class="rainbow-text-universal">Live Visitors</span></h3>
                        <button class="close-btn" data-target="live-visitors-panel" aria-label="Close Live Visitors Panel"><i class="fas fa-times"></i></button>
                    </div>
                    <ul id="visitor-list" role="list">
                        <li><div class="spinner"></div> Loading visitors...</li>
                    </ul>
                    <div class="refresh-info">
                        <small>Last updated: <span id="last-updated-time">N/A</span></small>
                        <button id="refresh-visitors-btn" aria-label="Refresh Visitors List"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="website-age-container" aria-live="polite">
        <p>Website Uptime:</p>
        <p id="website-age">loading</p>
    </div>

    <div class="fab-container" role="navigation" aria-label="Quick Access Buttons">
        <button class="fab" id="fab-theme-toggle" aria-label="Toggle Theme"><i class="fas fa-adjust"></i></button>
        <button class="fab" id="fab-code-editor" aria-label="Open Code Editor"><i class="fas fa-code"></i></button>
        <button class="fab" id="fab-music-player" aria-label="Open Music Player"><i class="fas fa-music"></i></button>
        <button class="fab" id="fab-contribute" aria-label="Contribute Message"><i class="fas fa-comment-dots"></i></button>
        <button class="fab" id="fab-live-visitors" aria-label="Live Visitors (Ezra Only)" style="display: none;"><i class="fas fa-eye"></i></button>
        <button class="fab" id="fab-private-user" aria-label="Private User Access"><i class="fas fa-user-secret"></i></button>
    </div>

    <div class="social-links" role="navigation" aria-label="Social Media Links">
        <a href="https://wa.me/yourwhatsappnumber" target="_blank" aria-label="WhatsApp Profile"><i class="fab fa-whatsapp"></i></a>
        <a href="https://instagram.com/yourinstagram" target="_blank" aria-label="Instagram Profile"><i class="fab fa-instagram"></i></a>
        <a href="https://github.com/yourgithub" target="_blank" aria-label="GitHub Profile"><i class="fab fa-github"></i></a>
        <a href="#" aria-label="Bible Link"><i class="fas fa-book-bible"></i></a>
    </div>

    <div id="private-user-panel" class="panel hidden" role="dialog" aria-modal="true" aria-labelledby="login-title">
        <div class="panel-header">
            <h3 id="login-title"><span class="rainbow-text-universal">Login Admin</span></h3>
            <button class="close-btn" data-target="private-user-panel" aria-label="Close Login Panel"><i class="fas fa-times"></i></button>
        </div>
        <form id="loginForm">
            <input type="email" id="email" placeholder="Email" autocomplete="email" required aria-label="Email">
            <div class="input-group">
                <input type="password" id="password" placeholder="Password" autocomplete="current-password" required aria-label="Password">
                <button type="button" class="toggle-password" aria-label="Show/Hide password">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <button type="submit" id="submitLogin" class="primary-btn"><i class="fas fa-sign-in-alt"></i> Login</button>
            <p id="status" role="status" aria-live="polite">Status: Idle</p>
            <p id="errorMsg" role="alert" aria-live="assertive"></p>
            <p id="ipDisplay"></p>
            <div id="loadingSpinner" style="display: none;"><div class="spinner"></div> Authenticating...</div>
            <button type="button" id="webauthnBtn" style="display: none;"><i class="fas fa-fingerprint"></i> Login with WebAuthn</button>
            <p id="webauthnUnsupported" style="display: none; color: #FF4444;">WebAuthn not supported.</p>
        </form>
    </div>

    <div id="ezra-panel" class="panel hidden" role="dialog" aria-modal="true" aria-labelledby="ezra-vault-title">
        <div class="panel-header">
            <h3 id="ezra-vault-title"><span class="rainbow-text-universal">Ezra's Secure Vault</span></h3>
            <button class="logout-btn primary-btn" id="ezra-logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>

        <div id="ezra-gallery-container" role="region" aria-label="Ezra's Private Content Gallery">
            <p id="ezra-gallery-status" class="loading-indicator">
                <div class="spinner"></div> Memuat konten...
            </p>
        </div>

        <form id="ezra-content-form">
            <h4><span class="rainbow-text-universal">Upload / Edit Content</span></h4>
            <input type="hidden" id="edit-item-id">
            <div class="form-row">
                <input type="text" id="gallery-item-title" placeholder="Content Title" required aria-label="Content Title">
                <input type="file" id="gallery-item-media" accept="image/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" aria-label="Media File Upload">
            </div>
            <textarea id="gallery-item-description" placeholder="Content Description" rows="4" required aria-label="Content Description"></textarea>
            <button type="submit" id="submit-gallery-item" class="primary-btn"><i class="fas fa-upload"></i> Add New Content</button>
            <p id="ezra-form-status" class="message-status" role="status" aria-live="polite"></p>
        </form>
    </div>
    
    <script>
        // Start of ezra.js content
        // This class is directly pasted from the provided ezra.js for integration
        class BioVAuth {
            constructor() {
                this.env = {
                    WORKER_URL: 'https://auth-logs.ezvvel.workers.dev/', // This URL is specific to ezra.js
                    RATE_LIMIT_WINDOW: 5 * 60 * 1000,
                    RATE_LIMIT_MAX_ATTEMPTS: 5
                };
                this.elements = {
                    scanLine: null, // Not present in current HTML
                    status: document.getElementById('status'),
                    btnContainer: null, // Not present in current HTML
                    loginForm: document.getElementById('loginForm'),
                    fallbackBtn: null, // Not present in current HTML
                    visitBtn: null, // Not present in current HTML
                    webauthnBtn: document.getElementById('webauthnBtn'),
                    emailInput: document.getElementById('email'),
                    passwordInput: document.getElementById('password'),
                    submitLogin: document.getElementById('submitLogin'),
                    loadingSpinner: document.getElementById('loadingSpinner'),
                    errorMsg: document.getElementById('errorMsg'),
                    ipDisplay: document.getElementById('ipDisplay'),
                    togglePassword: document.querySelector('.toggle-password'),
                    webauthnUnsupported: document.getElementById('webauthnUnsupported')
                };
                this.securityConfig = {
                    maxAttempts: 3,
                    blockDuration: 5 * 60 * 1000,
                    cookieName: 'bioVAuthSecurity',
                    localStorageKey: 'bioVAuthSession' // This is the key we'll check for login status
                };
                this.state = {
                    webauthnSupported: false,
                    clientInfo: {}
                };
                this.init();
            }

            async init() {
                // this.startBiometricAnimation(); // Not relevant for this HTML structure
                this.elements.loginForm?.addEventListener('submit', this.handleLoginSubmit.bind(this));
                this.elements.togglePassword?.addEventListener('click', this.togglePasswordVisibility.bind(this));
                this.checkWebAuthnSupport();
                await this.getClientInfo();
                this.displayIp();
            }

            startBiometricAnimation() {
                // Placeholder for biometric animation logic if needed in a more complex setup
            }

            togglePasswordVisibility() {
                const passwordInput = this.elements.passwordInput;
                const toggleIcon = this.elements.togglePassword.querySelector('i');
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleIcon.classList.remove('fa-eye');
                    toggleIcon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    toggleIcon.classList.remove('fa-eye-slash');
                    toggleIcon.classList.add('fa-eye');
                }
            }

            async getClientInfo() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    this.state.clientInfo.ip = data.ip;
                } catch (error) {
                    console.error('Failed to get client IP:', error);
                    this.state.clientInfo.ip = 'N/A';
                }
            }

            displayIp() {
                if (this.elements.ipDisplay) {
                    this.elements.ipDisplay.textContent = `IP Anda: ${this.state.clientInfo.ip}`;
                }
            }

            checkWebAuthnSupport() {
                if (typeof navigator.credentials !== 'undefined' && typeof navigator.credentials.create === 'function' && typeof navigator.credentials.get === 'function') {
                    this.state.webauthnSupported = true;
                    if (this.elements.webauthnBtn) {
                        this.elements.webauthnBtn.style.display = 'block';
                        this.elements.webauthnBtn.addEventListener('click', this.handleWebAuthnLogin.bind(this));
                    }
                } else {
                    if (this.elements.webauthnUnsupported) {
                        this.elements.webauthnUnsupported.style.display = 'block';
                    }
                }
            }

            async handleWebAuthnLogin(event) {
                event.preventDefault();
                this.setStatus('Mencoba login dengan WebAuthn...');
                this.showLoading(true);
                this.clearError();

                try {
                    // This is a placeholder for actual WebAuthn API calls
                    const credential = await navigator.credentials.get({
                        publicKey: {
                            challenge: new Uint8Array(32), // Replace with actual challenge from server
                            rpId: window.location.hostname,
                            userVerification: 'preferred',
                            allowCredentials: [] // Populate with actual credential IDs from server
                        }
                    });
                    this.setStatus('WebAuthn login berhasil (Simulasi)!');
                    this.setSession(true); // Simulate session set
                    // In a real app, send 'credential' to your server for verification
                    setTimeout(() => {
                        this.showLoading(false);
                        this.elements.loginForm.classList.add('hidden'); // Hide login form
                        // Trigger main app logic for successful login
                        window.dispatchEvent(new Event('ezraAuthSuccess'));
                    }, 1000);
                } catch (error) {
                    console.error('WebAuthn login failed:', error);
                    this.setError('WebAuthn login gagal. ' + error.message);
                    this.recordFailedAttempt();
                    this.showLoading(false);
                }
            }

            async handleLoginSubmit(event) {
                event.preventDefault();
                if (this.isBlocked()) {
                    this.setError(`Anda diblokir. Coba lagi dalam ${Math.ceil(this.getRemainingBlockTime() / 60000)} menit.`);
                    return;
                }

                this.setStatus('Authenticating...');
                this.showLoading(true);
                this.clearError();

                const email = this.elements.emailInput.value;
                const password = this.elements.passwordInput.value;

                // Simulate API call to Cloudflare Worker
                try {
                    const response = await fetch(`${this.env.WORKER_URL}/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password, ip: this.state.clientInfo.ip })
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        this.setStatus('Login berhasil!');
                        this.resetAttempts();
                        this.setSession(true); // Set login session
                        this.elements.loginForm.classList.add('hidden'); // Hide login form
                        // Dispatch a custom event for the main script to listen to
                        window.dispatchEvent(new Event('ezraAuthSuccess'));
                    } else {
                        this.setError(result.message || 'Login gagal. Periksa kredensial Anda.');
                        this.recordFailedAttempt();
                    }
                } catch (error) {
                    console.error('Login request failed:', error);
                    this.setError(`Login gagal: ${error.message}.`);
                    this.recordFailedAttempt();
                } finally {
                    this.showLoading(false);
                }
            }

            setStatus(message) {
                if (this.elements.status) {
                    this.elements.status.textContent = `Status: ${message}`;
                }
            }

            setError(message) {
                if (this.elements.errorMsg) {
                    this.elements.errorMsg.textContent = `Error: ${message}`;
                }
            }

            clearError() {
                if (this.elements.errorMsg) {
                    this.elements.errorMsg.textContent = '';
                }
            }

            showLoading(isLoading) {
                if (this.elements.submitLogin) {
                    this.elements.submitLogin.disabled = isLoading;
                }
                if (this.elements.loadingSpinner) {
                    this.elements.loadingSpinner.style.display = isLoading ? 'flex' : 'none';
                }
                if (this.elements.webauthnBtn) {
                    this.elements.webauthnBtn.disabled = isLoading;
                }
            }

            setSession(loggedIn) {
                if (loggedIn) {
                    localStorage.setItem(this.securityConfig.localStorageKey, 'true');
                } else {
                    localStorage.removeItem(this.securityConfig.localStorageKey);
                }
            }

            getSession() {
                return localStorage.getItem(this.securityConfig.localStorageKey) === 'true';
            }

            getDefaultData() {
                return { attempts: 0, lastAttempt: null, blockUntil: null };
            }

            loadAttemptData() {
                const cookieData = this.getCookie(this.securityConfig.cookieName);
                if (cookieData) {
                    try {
                        const data = JSON.parse(decodeURIComponent(cookieData));
                        if (this.isValidAttemptData(data)) {
                            this.attemptData = data;
                            return;
                        }
                    } catch (e) {
                        console.error("Failed to parse attempt data cookie:", e);
                    }
                }
                this.attemptData = this.getDefaultData();
            }

            isValidAttemptData(data) {
                return typeof data === 'object' &&
                       'attempts' in data && typeof data.attempts === 'number' &&
                       'lastAttempt' in data && (typeof data.lastAttempt === 'string' || data.lastAttempt === null) &&
                       'blockUntil' in data && (typeof data.blockUntil === 'string' || data.blockUntil === null);
            }

            saveAttemptData() {
                const expires = new Date();
                expires.setDate(expires.getDate() + 1); // Cookie valid for 1 day
                const data = encodeURIComponent(JSON.stringify(this.attemptData));
                document.cookie = `${this.securityConfig.cookieName}=${data}; expires=${expires.toUTCString()}; path=/; SameSite=Strict; Secure`;
            }

            getCookie(name) {
                return document.cookie.split(';')
                    .map(c => c.trim())
                    .find(c => c.startsWith(name + '='))
                    ?.substring(name.length + 1);
            }

            recordFailedAttempt() {
                const now = new Date();
                this.loadAttemptData(); // Ensure we have the latest data
                this.attemptData.attempts++;
                this.attemptData.lastAttempt = now.toISOString();
                if (this.attemptData.attempts >= this.securityConfig.maxAttempts) {
                    const blockUntil = new Date(now.getTime() + this.securityConfig.blockDuration);
                    this.attemptData.blockUntil = blockUntil.toISOString();
                }
                this.saveAttemptData();
            }

            resetAttempts() {
                this.attemptData = this.getDefaultData();
                this.saveAttemptData();
            }

            isBlocked() {
                this.loadAttemptData(); // Always load latest data before checking
                if (!this.attemptData.blockUntil) return false;
                const blockUntil = new Date(this.attemptData.blockUntil);
                const now = new Date();
                if (now > blockUntil) {
                    this.resetAttempts(); // Reset if block period is over
                    return false;
                }
                return true;
            }

            getRemainingBlockTime() {
                if (!this.isBlocked()) return 0;
                const blockUntil = new Date(this.attemptData.blockUntil);
                const now = new Date();
                return blockUntil.getTime() - now.getTime();
            }
        }
        // End of ezra.js content

        // Main script variables and functions
        const CLOUDFLARE_WORKER_URL = 'https://forever.universalezra.workers.dev'; // This URL is for Ezra's content, contributions, visitors
        const GITHUB_RAW_CONTENT_BASE_URL = 'https://raw.githubusercontent.com/universalezra/universalezra/main/gallery-media';

        const body = document.body;
        const rainbowLogo = document.getElementById('rainbow-logo');

        const fabThemeToggle = document.getElementById('fab-theme-toggle');
        const fabCodeEditorBtn = document.getElementById('fab-code-editor');
        const fabMusicPlayerBtn = document.getElementById('fab-music-player');
        const fabContributeBtn = document.getElementById('fab-contribute');
        const fabLiveVisitorsBtn = document.getElementById('fab-live-visitors');
        const fabPrivateUserBtn = document.getElementById('fab-private-user');

        const codeEditorPanel = document.getElementById('code-editor-panel');
        const musicPlayerPanel = document.getElementById('music-player-panel');
        const contributePanel = document.getElementById('contribute-panel');
        const liveVisitorsPanel = document.getElementById('live-visitors-panel');
        const privateUserPanel = document.getElementById('private-user-panel');
        const ezraPanel = document.getElementById('ezra-panel');
        const ditolakCewekOutput = document.getElementById('ditolak-cewek-output');
        const mainContentWrapper = document.querySelector('.main-content-wrapper');

        let activePanel = null; // Store active panel to avoid showing multiple at once

        // Function to close any currently open main panel
        function closeAllMainPanels() {
            [codeEditorPanel, musicPlayerPanel, contributePanel, liveVisitorsPanel, privateUserPanel].forEach(p => {
                if (!p.classList.contains('hidden')) {
                    p.classList.add('hidden');
                }
            });
            activePanel = null;
        }

        // Close panel logic
        document.querySelectorAll('.panel .close-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const targetPanelId = e.currentTarget.dataset.target || e.currentTarget.closest('.panel').id;
                document.getElementById(targetPanelId).classList.add('hidden');
                if (targetPanelId === 'ezra-panel') {
                    ezraPanel.classList.remove('active'); // Special handling for full-screen Ezra panel
                }
                if (activePanel && activePanel.id === targetPanelId) {
                    activePanel = null; // Clear active panel state
                }
            });
        });

        // Rainbow Colors (using CSS variables for consistency)
        const rainbowColors = [
            getComputedStyle(document.documentElement).getPropertyValue('--rainbow-0'),
            getComputedStyle(document.documentElement).getPropertyValue('--rainbow-1'),
            getComputedStyle(document.documentElement).getPropertyValue('--rainbow-2'),
            getComputedStyle(document.documentElement).getPropertyValue('--rainbow-3'),
            getComputedStyle(document.documentElement).getPropertyValue('--rainbow-4'),
            getComputedStyle(document.documentElement).getPropertyValue('--rainbow-5'),
            getComputedStyle(document.documentElement).getPropertyValue('--rainbow-6')
        ];

        // Apply rainbow effect to a given element's text content, character by character
        function applyRainbowEffectToElement(element) {
            if (!element) return;

            const originalText = element.textContent;
            if (!originalText) return; // Nothing to rainbow if empty

            element.innerHTML = ''; // Clear existing content

            originalText.split('').forEach((char, index) => {
                const span = document.createElement('span');
                span.textContent = char;
                span.style.color = rainbowColors[index % rainbowColors.length];
                span.classList.add('rainbow-char'); // Add a class for identification
                element.appendChild(span);
            });
        }

        // Apply rainbow to all designated elements
        function applyRainbowToAllText() {
            // Reapply to the logo
            applyRainbowEffectToElement(rainbowLogo);

            // Reapply to panel titles and specific texts
            document.querySelectorAll(
                '.panel-header h3 .rainbow-text-universal, ' +
                '#ezra-content-form h4 .rainbow-text-universal, ' +
                '.gallery-item-info h4 .rainbow-text-universal, ' +
                '#private-user-panel h3 .rainbow-text-universal, ' +
                '#ditolak-cewek-output, ' + // Target the span directly
                '#website-age' // Target the paragraph directly
            ).forEach(element => {
                applyRainbowEffectToElement(element);
            });

            // Handle dynamically loaded list items (only specific spans, not all text)
            document.querySelectorAll(
                '#contributor-messages-list li strong span, #contributor-messages-list li span:not(.message-meta), ' +
                '#visitor-list li strong span, #visitor-list li span:nth-child(2)'
            ).forEach(element => {
                applyRainbowEffectToElement(element);
            });
        }
        applyRainbowToAllText(); // Initial application on page load

        function toggleTheme() {
            body.dataset.theme = body.dataset.theme === 'dark' ? 'light' : 'dark';
            // Re-apply rainbow effect as colors might change with theme
            applyRainbowToAllText();
            // Re-fetch data for dynamic panels to ensure colors are consistent if open
            if (!contributePanel.classList.contains('hidden')) fetchContributorMessages();
            if (!liveVisitorsPanel.classList.contains('hidden') && ezraBioVAuth.getSession()) fetchLiveVisitors(); // Use ezraBioVAuth.getSession()
            if (ezraPanel.classList.contains('active')) loadEzraContent();
        }
        fabThemeToggle.addEventListener('click', toggleTheme);

        function showPanel(panel) {
            closeAllMainPanels(); // Close any other open main panels first
            panel.classList.remove('hidden');
            activePanel = panel; // Set the newly opened panel as active
            // Specific actions for each panel upon opening
            if (panel === contributePanel) {
                fetchContributorMessages();
            } else if (panel === liveVisitorsPanel && ezraBioVAuth.getSession()) { // Use ezraBioVAuth.getSession()
                fetchLiveVisitors();
            } else if (panel === ezraPanel) {
                ezraPanel.classList.add('active'); // Activate full-screen for Ezra panel
                loadEzraContent();
            }
            // Re-apply rainbow for panel headers, as their content might be hidden/shown
            applyRainbowToAllText();
        }

        fabCodeEditorBtn.addEventListener('click', () => showPanel(codeEditorPanel));
        fabMusicPlayerBtn.addEventListener('click', () => showPanel(musicPlayerPanel));
        fabContributeBtn.addEventListener('click', () => showPanel(contributePanel));
        fabLiveVisitorsBtn.addEventListener('click', () => {
            if (ezraBioVAuth.getSession()) { // Use ezraBioVAuth.getSession()
                showPanel(liveVisitorsPanel);
            } else {
                alert('Akses ditolak: Hanya Ezra yang dapat melihat Pengunjung Langsung.');
                fabLiveVisitorsBtn.style.display = 'none'; // Ensure it's hidden if somehow clicked by non-Ezra
            }
        });
        fabPrivateUserBtn.addEventListener('click', () => showPanel(privateUserPanel));

        const unifiedEditor = document.getElementById('unified-editor');
        const runCodeBtn = document.getElementById('run-code');
        const codePreview = document.getElementById('code-preview');

        runCodeBtn.addEventListener('click', () => {
            const code = unifiedEditor.value;
            // Using a Blob URL for better isolation and security than direct srcdoc
            const blob = new Blob([code], { type: 'text/html' });
            const blobUrl = URL.createObjectURL(blob);
            codePreview.src = blobUrl;

            // Revoke the object URL after the iframe has loaded the content
            codePreview.onload = () => {
                URL.revokeObjectURL(blobUrl);
            };
        });

        const musicAudio = document.getElementById('music-audio');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const playlistItems = document.getElementById('playlist-items');

        const playlist = [
            { title: "Cyberpunk Dreamscape", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { title: "Digital Echoes", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { title: "System Overload", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
            { title: "Network Groove", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" },
            { title: "Binary Bliss", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" }
        ];

        let currentTrackIndex = 0;
        let isShuffling = false;
        let isRepeating = false;

        function loadTrack(index) {
            if (index >= 0 && index < playlist.length) {
                currentTrackIndex = index;
                musicAudio.src = playlist[currentTrackIndex].src;
                musicAudio.load(); // Ensure audio is loaded
                musicAudio.play().catch(error => {
                    console.error("Failed to play audio:", error);
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
                    alert("Autoplay prevented or audio failed to load. Please click play.");
                });
                updatePlaylistUI();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            }
        }

        function playPause() {
            if (musicAudio.paused) {
                musicAudio.play().catch(error => {
                    console.error("Failed to resume playback:", error);
                    alert("Could not play audio. Browser may require user interaction first.");
                });
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            } else {
                musicAudio.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
            }
        }

        function nextTrack() {
            if (isShuffling) {
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * playlist.length);
                } while (newIndex === currentTrackIndex && playlist.length > 1);
                loadTrack(newIndex);
            } else {
                currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                loadTrack(currentTrackIndex);
            }
        }

        function prevTrack() {
            currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            loadTrack(currentTrackIndex);
        }

        function toggleShuffle() {
            isShuffling = !isShuffling;
            shuffleBtn.classList.toggle('active', isShuffling);
            shuffleBtn.style.color = isShuffling ? 'var(--primary-accent)' : '';
            shuffleBtn.setAttribute('aria-pressed', isShuffling);
        }

        function toggleRepeat() {
            isRepeating = !isRepeating;
            musicAudio.loop = isRepeating;
            repeatBtn.classList.toggle('active', isRepeating);
            repeatBtn.style.color = isRepeating ? 'var(--primary-accent)' : '';
            repeatBtn.setAttribute('aria-pressed', isRepeating);
        }

        function updatePlaylistUI() {
            playlistItems.innerHTML = '';
            playlist.forEach((song, index) => {
                const li = document.createElement('li');
                li.textContent = song.title;
                li.setAttribute('role', 'option');
                li.setAttribute('aria-selected', index === currentTrackIndex);
                if (index === currentTrackIndex) {
                    li.classList.add('active');
                }
                li.addEventListener('click', () => loadTrack(index));
                playlistItems.appendChild(li);
            });
        }

        musicAudio.addEventListener('ended', () => {
            if (isRepeating) {
                musicAudio.play();
            } else {
                nextTrack();
            }
        });
        musicAudio.addEventListener('error', (e) => {
            console.error("Audio error:", e);
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
            alert("Error playing audio. Please try another track.");
        });

        playPauseBtn.addEventListener('click', playPause);
        nextBtn.addEventListener('click', nextTrack);
        prevBtn.addEventListener('click', prevTrack);
        shuffleBtn.addEventListener('click', toggleShuffle);
        repeatBtn.addEventListener('click', toggleRepeat);

        updatePlaylistUI();
        if (playlist.length > 0) {
            musicAudio.src = playlist[currentTrackIndex].src;
        }

        const contributeForm = document.getElementById('contribute-form');
        const contributorNameInput = document.getElementById('contributor-name');
        const contributeTextInput = document.getElementById('contribute-text');
        const contributeMessage = document.getElementById('contribute-message');
        const contributorMessagesList = document.getElementById('contributor-messages-list');

        async function fetchContributorMessages() {
            contributorMessagesList.innerHTML = '<li><div class="spinner"></div><span class="rainbow-text-universal">Memuat pesan...</span></li>';
            applyRainbowEffectToElement(contributorMessagesList.querySelector('li span'));
            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/contributions`, { cache: 'no-store' }); // Bypass cache for live data
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const messages = await response.json();
                if (messages && messages.length > 0) {
                    messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    contributorMessagesList.innerHTML = messages.map(msg => {
                        const date = new Date(msg.timestamp).toLocaleString('id-ID', {
                            year: 'numeric', month: 'long', day: 'numeric',
                            hour: '2-digit', minute: '2-digit', second: '2-digit'
                        });
                        return `
                            <li>
                                <strong>Nama:</strong> <span class="rainbow-text-universal">${msg.name ? escapeHTML(msg.name) : 'Anonim'}</span><br>
                                <strong>Pesan:</strong> <span class="rainbow-text-universal">${escapeHTML(msg.text)}</span><br>
                                <div class="message-meta">Tanggal: ${date}</div>
                            </li>
                        `;
                    }).join('');
                    document.querySelectorAll('#contributor-messages-list .rainbow-text-universal').forEach(el => {
                        applyRainbowEffectToElement(el);
                    });
                } else {
                    contributorMessagesList.innerHTML = '<li><span class="rainbow-text-universal">Belum ada pesan kontribusi.</span></li>';
                    applyRainbowEffectToElement(contributorMessagesList.querySelector('li span'));
                }
            } catch (error) {
                console.error('Error fetching contributions:', error);
                contributorMessagesList.innerHTML = `<li style="color: #FF4444;"><span class="rainbow-text-universal">Gagal memuat pesan: ${escapeHTML(error.message)}</span></li>`;
                applyRainbowEffectToElement(contributorMessagesList.querySelector('li span'));
            }
        }

        contributeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            contributeMessage.textContent = 'Mengirim pesan...';
            contributeMessage.classList.remove('message-success', 'message-error');
            contributeMessage.style.color = 'var(--text-muted)'; // Reset color

            const name = contributorNameInput.value.trim();
            const text = contributeTextInput.value.trim();

            if (!text) {
                contributeMessage.textContent = 'Pesan tidak boleh kosong!';
                contributeMessage.classList.add('message-error');
                return;
            }

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/contributions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, text, timestamp: new Date().toISOString() }),
                });

                if (response.ok) {
                    contributeMessage.textContent = 'Pesan berhasil dikirim!';
                    contributeMessage.classList.add('message-success');
                    contributorNameInput.value = '';
                    contributeTextInput.value = '';
                    fetchContributorMessages(); // Refresh the list
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Gagal mengirim pesan.');
                }
            } catch (error) {
                console.error('Error sending contribution:', error);
                contributeMessage.textContent = `Gagal mengirim pesan: ${escapeHTML(error.message)}`;
                contributeMessage.classList.add('message-error');
            } finally {
                // Clear message after a short delay
                setTimeout(() => {
                    contributeMessage.textContent = '';
                }, 5000);
            }
        });

        const visitorList = document.getElementById('visitor-list');
        const refreshVisitorsBtn = document.getElementById('refresh-visitors-btn');
        const lastUpdatedTime = document.getElementById('last-updated-time');

        // Function to escape HTML for display
        function escapeHTML(str) {
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }

        async function trackVisitor() {
            let browserId = localStorage.getItem('browserId');
            if (!browserId) {
                browserId = 'browser-' + Date.now() + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('browserId', browserId);
            }

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/visitors`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ browserId: browserId, timestamp: new Date().toISOString() })
                });
                if (!response.ok) {
                    console.warn(`Failed to track visitor (HTTP status: ${response.status}). Worker might not be set up.`);
                }
            } catch (error) {
                console.error('Error tracking visitor:', error);
            }
        }
        trackVisitor();

        async function fetchLiveVisitors() {
            visitorList.innerHTML = '<li><div class="spinner"></div><span class="rainbow-text-universal">Memuat pengunjung...</span></li>';
            applyRainbowEffectToElement(visitorList.querySelector('li span'));
            lastUpdatedTime.textContent = 'Memuat...';

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/visitors`, { cache: 'no-store' });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const visitors = await response.json();

                if (visitors && visitors.length > 0) {
                    visitors.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    visitorList.innerHTML = ''; // Clear loading message

                    visitors.forEach(visitor => {
                        const li = document.createElement('li');
                        const timestamp = new Date(visitor.timestamp).toLocaleString('id-ID', {
                            hour: '2-digit', minute: '2-digit', second: '2-digit',
                            day: '2-digit', month: '2-digit', year: 'numeric'
                        });
                        li.innerHTML = `
                            <strong>ID:</strong> <span class="rainbow-text-universal">${escapeHTML(visitor.browserId.substring(0, 10))}...</span><br>
                            <strong>IP:</strong> <span class="rainbow-text-universal">${escapeHTML(visitor.ip || 'N/A')}</span><br>
                            <strong>Waktu:</strong> <span>${timestamp}</span>
                        `;
                        visitorList.appendChild(li);
                        applyRainbowEffectToElement(li.querySelector('strong span'));
                        applyRainbowEffectToElement(li.querySelector('span:nth-child(2)'));
                    });

                } else {
                    visitorList.innerHTML = '<li><span class="rainbow-text-universal">Tidak ada pengunjung online.</span></li>';
                    applyRainbowEffectToElement(visitorList.querySelector('li span'));
                }
                lastUpdatedTime.textContent = new Date().toLocaleTimeString('id-ID');

            } catch (error) {
                console.error('Error fetching live visitors:', error);
                visitorList.innerHTML = '<li style="color: #FF4444;"><span class="rainbow-text-universal">Gagal memuat pengunjung.</span></li>';
                applyRainbowEffectToElement(visitorList.querySelector('li span'));
                lastUpdatedTime.textContent = 'Error';
            }
        }

        refreshVisitorsBtn.addEventListener('click', fetchLiveVisitors);

        // Instantiate BioVAuth from ezra.js
        const ezraBioVAuth = new BioVAuth();

        const ezraLogoutBtn = document.getElementById('ezra-logout-btn');

        const ezraGalleryContainer = document.getElementById('ezra-gallery-container');
        const ezraGalleryStatus = document.getElementById('ezra-gallery-status');
        const ezraContentForm = document.getElementById('ezra-content-form');
        const editItemIdInput = document.getElementById('edit-item-id');
        const galleryItemTitleInput = document.getElementById('gallery-item-title');
        const galleryItemDescriptionInput = document.getElementById('gallery-item-description');
        const galleryItemMediaInput = document.getElementById('gallery-item-media');
        const submitGalleryItemBtn = document.getElementById('submit-gallery-item');
        const ezraFormStatus = document.getElementById('ezra-form-status');

        function checkEzraLoginAndShowVisitorsButton() {
            const isEzra = ezraBioVAuth.getSession(); // Use BioVAuth's session check
            const fabLiveVisitors = document.getElementById('fab-live-visitors');

            if (isEzra) {
                fabLiveVisitors.style.display = 'flex'; // Use flex for FABs
                if (privateUserPanel && !privateUserPanel.classList.contains('hidden')) {
                    privateUserPanel.classList.add('hidden'); // Hide login if already logged in
                }
                // If Ezra is logged in but panel isn't active, show it for better UX
                if (!ezraPanel.classList.contains('active')) {
                     ezraPanel.classList.add('active');
                     loadEzraContent();
                }
            } else {
                fabLiveVisitors.style.display = 'none';
                if (!liveVisitorsPanel.classList.contains('hidden')) {
                    liveVisitorsPanel.classList.add('hidden');
                }
                if (ezraPanel.classList.contains('active')) {
                    ezraPanel.classList.remove('active');
                }
            }
        }
        checkEzraLoginAndShowVisitorsButton();

        // Listen for successful authentication from BioVAuth
        window.addEventListener('ezraAuthSuccess', () => {
            checkEzraLoginAndShowVisitorsButton();
            showPanel(ezraPanel); // Show Ezra panel after successful login
        });

        ezraLogoutBtn.addEventListener('click', () => {
            ezraBioVAuth.setSession(false); // Clear BioVAuth session
            ezraPanel.classList.remove('active');
            closeAllMainPanels(); // Close all other panels too
            checkEzraLoginAndShowVisitorsButton();
            // Clear login form fields
            ezraBioVAuth.elements.emailInput.value = '';
            ezraBioVAuth.elements.passwordInput.value = '';
            ezraBioVAuth.setError(''); // Clear any error messages
            ezraBioVAuth.setStatus('Logged out.'); // Update login form status
            resetEzraForm(); // Clear Ezra content form
            ezraGalleryContainer.innerHTML = '<p id="ezra-gallery-status" class="loading-indicator"><div class="spinner"></div> Memuat konten...</p>';
            applyRainbowEffectToElement(ezraGalleryContainer.querySelector('#ezra-gallery-status span')); // Apply rainbow to loading text
        });

        async function loadEzraContent() {
            ezraGalleryStatus.innerHTML = '<div class="spinner"></div> Memuat konten...';
            ezraGalleryStatus.style.color = 'var(--text-muted)';
            ezraGalleryContainer.innerHTML = '';
            ezraGalleryContainer.appendChild(ezraGalleryStatus); // Re-append loading status

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/ezra-content`, { cache: 'no-store' });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const content = await response.json();

                if (content && content.length > 0) {
                    content.sort((a, b) => new Date(b.date) - new Date(a.date));
                    ezraGalleryContainer.innerHTML = ''; // Clear loading message

                    content.forEach(item => {
                        const galleryItem = document.createElement('div');
                        galleryItem.className = 'gallery-item';
                        galleryItem.dataset.id = item.id;

                        let mediaHtml = '';
                        let fileIcon = '';
                        const mediaUrl = item.mediaFileName ? `${GITHUB_RAW_CONTENT_BASE_URL}/${item.mediaFileName}` : '';

                        if (item.type && mediaUrl) {
                            if (item.type.startsWith('image/')) {
                                mediaHtml = `<img src="${mediaUrl}" alt="${escapeHTML(item.title)}">`;
                            } else if (item.type.startsWith('video/')) {
                                mediaHtml = `<video controls src="${mediaUrl}" preload="metadata"></video>`;
                            } else if (item.type === 'application/pdf') {
                                fileIcon = '<i class="fas fa-file-pdf"></i> PDF';
                            } else if (item.type.includes('wordprocessingml') || item.type.includes('msword')) {
                                fileIcon = '<i class="fas fa-file-word"></i> Word Doc';
                            } else {
                                fileIcon = '<i class="fas fa-file"></i> Unknown File';
                            }

                            if (fileIcon) {
                                mediaHtml = `<div class="document-preview">${fileIcon} <br> ${escapeHTML(item.mediaFileName || 'File')}</div>`;
                            }
                        } else {
                            mediaHtml = `<div class="document-preview"><i class="fas fa-info-circle"></i> No Media</div>`;
                        }

                        galleryItem.innerHTML = `
                            ${mediaHtml}
                            <div class="gallery-item-info">
                                <h4><span class="rainbow-text-universal">${escapeHTML(item.title)}</span></h4>
                                <p><span class="rainbow-text-universal">${escapeHTML(item.description)}</span></p>
                                <small>${new Date(item.date).toLocaleString('id-ID', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</small>
                            </div>
                            <div class="gallery-item-controls">
                                <button class="edit-item-btn" data-id="${item.id}" aria-label="Edit ${escapeHTML(item.title)}"><i class="fas fa-edit"></i></button>
                                <button class="delete-item-btn" data-id="${item.id}" data-filename="${escapeHTML(item.mediaFileName || '')}" aria-label="Delete ${escapeHTML(item.title)}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        `;
                        ezraGalleryContainer.appendChild(galleryItem);
                    });

                    document.querySelectorAll('#ezra-gallery-container .rainbow-text-universal').forEach(el => {
                        applyRainbowEffectToElement(el);
                    });

                    document.querySelectorAll('.edit-item-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => editEzraItem(e.currentTarget.dataset.id));
                    });
                    document.querySelectorAll('.delete-item-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => deleteEzraItem(e.currentTarget.dataset.id, e.currentTarget.dataset.filename));
                    });
                    ezraGalleryStatus.textContent = ''; // Clear loading text
                } else {
                    ezraGalleryStatus.innerHTML = '<span class="rainbow-text-universal">No content yet. Add the first one!</span>';
                    applyRainbowEffectToElement(ezraGalleryStatus.querySelector('span'));
                }
            } catch (error) {
                console.error('Error loading Ezra content:', error);
                ezraGalleryStatus.innerHTML = `<span style="color: #FF4444;"><span class="rainbow-text-universal">Gagal memuat konten: ${escapeHTML(error.message)}</span></span>`;
                applyRainbowEffectToElement(ezraGalleryStatus.querySelector('span span')); // Double span for rainbow color
            }
        }

        function resetEzraForm() {
            editItemIdInput.value = '';
            galleryItemTitleInput.value = '';
            galleryItemDescriptionInput.value = '';
            galleryItemMediaInput.value = ''; // Clear selected file
            submitGalleryItemBtn.innerHTML = '<i class="fas fa-upload"></i> Add New Content';
            submitGalleryItemBtn.classList.remove('btn-loading'); // Remove loading state
            ezraFormStatus.textContent = '';
            ezraFormStatus.classList.remove('message-success', 'message-error');
        }

        async function editEzraItem(id) {
            ezraFormStatus.textContent = '';
            ezraFormStatus.classList.remove('message-success', 'message-error');
            submitGalleryItemBtn.disabled = true;
            submitGalleryItemBtn.innerHTML = '<div class="spinner"></div> Loading...';

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/ezra-content?id=${id}`);
                if (!response.ok) throw new Error('Failed to fetch item for editing');
                const itemToEdit = await response.json();

                editItemIdInput.value = itemToEdit.id;
                galleryItemTitleInput.value = itemToEdit.title;
                galleryItemDescriptionInput.value = itemToEdit.description;
                submitGalleryItemBtn.innerHTML = '<i class="fas fa-save"></i> Update Content';
                submitGalleryItemBtn.disabled = false;
                galleryItemMediaInput.value = ''; // Clear selected file in input
                ezraFormStatus.textContent = 'Edit mode: Upload new media to replace existing file. Old media: ' + (escapeHTML(itemToEdit.mediaFileName) || 'None');
                ezraFormStatus.style.color = 'var(--text-muted)';

            } catch (error) {
                console.error('Error preparing edit:', error);
                ezraFormStatus.textContent = `Failed to prepare edit: ${escapeHTML(error.message)}`;
                ezraFormStatus.classList.add('message-error');
                submitGalleryItemBtn.innerHTML = '<i class="fas fa-upload"></i> Add New Content'; // Reset button
                submitGalleryItemBtn.disabled = false;
            }
        }

        async function deleteEzraItem(id, filename) {
            if (!confirm('Are you sure you want to delete this content? This action cannot be undone and will also remove the associated media file from storage.')) {
                return;
            }
            ezraFormStatus.textContent = 'Deleting content...';
            ezraFormStatus.classList.remove('message-success', 'message-error');
            ezraFormStatus.style.color = 'var(--text-muted)';

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/ezra-content`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: id, filename: filename })
                });
                if (response.ok) {
                    ezraFormStatus.textContent = 'Content successfully deleted!';
                    ezraFormStatus.classList.add('message-success');
                    loadEzraContent(); // Refresh gallery
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to delete content.');
                }
            } catch (error) {
                console.error('Error deleting Ezra item:', error);
                ezraFormStatus.textContent = `Failed to delete: ${escapeHTML(error.message)}`;
                ezraFormStatus.classList.add('message-error');
            } finally {
                setTimeout(() => {
                    ezraFormStatus.textContent = '';
                }, 5000);
            }
        }

        ezraContentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            ezraFormStatus.textContent = 'Submitting content...';
            ezraFormStatus.classList.remove('message-success', 'message-error');
            ezraFormStatus.style.color = 'var(--text-muted)';
            submitGalleryItemBtn.disabled = true;
            submitGalleryItemBtn.innerHTML = '<div class="spinner"></div> Processing...';

            const id = editItemIdInput.value || `item-${Date.now()}`;
            const title = galleryItemTitleInput.value.trim();
            const description = galleryItemDescriptionInput.value.trim();
            const mediaFile = galleryItemMediaInput.files[0];
            const isEditing = !!editItemIdInput.value;

            if (!title || !description) {
                ezraFormStatus.textContent = 'Title and Description are required!';
                ezraFormStatus.classList.add('message-error');
                submitGalleryItemBtn.disabled = false;
                submitGalleryItemBtn.innerHTML = isEditing ? '<i class="fas fa-save"></i> Update Content' : '<i class="fas fa-upload"></i> Add New Content';
                return;
            }

            if (!mediaFile && !isEditing) {
                ezraFormStatus.textContent = 'Please select a media file for new content!';
                ezraFormStatus.classList.add('message-error');
                submitGalleryItemBtn.disabled = false;
                submitGalleryItemBtn.innerHTML = '<i class="fas fa-upload"></i> Add New Content';
                return;
            }

            const formData = new FormData();
            formData.append('id', id);
            formData.append('title', title);
            formData.append('description', description);
            formData.append('date', new Date().toISOString());
            if (mediaFile) {
                formData.append('media', mediaFile);
                formData.append('type', mediaFile.type);
                formData.append('filename', `${id}-${mediaFile.name}`); // Unique filename
            } else if (isEditing) {
                formData.append('noMediaChange', 'true'); // Indicate no media file upload for update
            }

            try {
                const method = isEditing ? 'PUT' : 'POST';
                const url = `${CLOUDFLARE_WORKER_URL}/ezra-content`;

                const response = await fetch(url, {
                    method: method,
                    body: formData,
                });

                if (response.ok) {
                    ezraFormStatus.textContent = `Content successfully ${isEditing ? 'updated' : 'added'}!`;
                    ezraFormStatus.classList.add('message-success');
                    resetEzraForm(); // Reset form fields
                    loadEzraContent(); // Refresh gallery
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Failed to ${isEditing ? 'update' : 'add'} content.`);
                }
            } catch (error) {
                console.error('Error adding/updating Ezra content:', error);
                ezraFormStatus.textContent = `Failed to ${isEditing ? 'update' : 'add'}: ${escapeHTML(error.message)}`;
                ezraFormStatus.classList.add('message-error');
            } finally {
                submitGalleryItemBtn.disabled = false;
                submitGalleryItemBtn.innerHTML = isEditing ? '<i class="fas fa-save"></i> Update Content' : '<i class="fas fa-upload"></i> Add New Content';
                setTimeout(() => {
                    ezraFormStatus.textContent = '';
                }, 5000);
            }
        });

        const launchDate = new Date(2025, 5, 25, 0, 0, 0); // June 25, 2025, 00:00:00 (Month is 0-indexed)

        const websiteAgeElement = document.getElementById('website-age');

        function updateWebsiteAge() {
            const now = new Date();
            const diff = now.getTime() - launchDate.getTime();

            if (diff < 0) {
                websiteAgeElement.textContent = "Website not yet launched!";
                applyRainbowEffectToElement(websiteAgeElement);
                return;
            }

            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            // Calculate precise years, months, days, hours, minutes, seconds
            const totalYears = Math.floor(days / 365.25);
            const remainingDaysAfterYears = days % 365.25;

            // Approximate months based on average days (30.44 days/month)
            const totalMonths = Math.floor(remainingDaysAfterYears / 30.44);
            const remainingDaysAfterMonths = Math.floor(remainingDaysAfterYears % 30.44);

            const displaySeconds = seconds % 60;
            const displayMinutes = minutes % 60;
            const displayHours = hours % 24;

            let ageString = "";
            if (totalYears > 0) ageString += `${totalYears} year${totalYears > 1 ? 's' : ''} `;
            if (totalMonths > 0) ageString += `${totalMonths} month${totalMonths > 1 ? 's' : ''} `;
            if (remainingDaysAfterMonths > 0) ageString += `${Math.floor(remainingDaysAfterMonths)} day${Math.floor(remainingDaysAfterMonths) > 1 ? 's' : ''} `;

            // Always display at least hours, minutes, seconds if less than a day/month/year
            if (totalYears === 0 && totalMonths === 0 && remainingDaysAfterMonths === 0) {
                if (displayHours > 0) ageString += `${displayHours} hour${displayHours > 1 ? 's' : ''} `;
                if (displayMinutes > 0) ageString += `${displayMinutes} minute${displayMinutes > 1 ? 's' : ''} `;
                ageString += `${displaySeconds} second${displaySeconds > 1 ? 's' : ''}`;
            } else {
                // If there are days/months/years, still show hours/minutes/seconds if they are significant
                if (displayHours > 0) ageString += `${displayHours}h `;
                if (displayMinutes > 0) ageString += `${displayMinutes}m `;
                if (displaySeconds > 0) ageString += `${displaySeconds}s`;
            }

            websiteAgeElement.textContent = ageString.trim();
            applyRainbowEffectToElement(websiteAgeElement);
        }

        updateWebsiteAge();
        setInterval(updateWebsiteAge, 1000);

        // Random "Ditolak Cewek" Text Feature
        const ditolakCewekQuotes = [
            "Error 404: Cinta tidak ditemukan.",
            "Dia bilang 'notifikasi mati', padahal hatinya yang mati rasa.",
            "Server down, perasaanku hancur.",
            "Firewall anti-jodoh aktif.",
            "Mungkin koneksi hati kita terputus, atau memang belum terhubung.",
            "Update cinta gagal, rollback ke status single.",
            "Virus rindu menyerang, anti-virus cuek.",
            "Password hatinya terlalu rumit untuk dipecahkan.",
            "Log file penuh dengan penolakan.",
            "Dia lebih suka mode incognito, tidak ingin terlihat denganku.",
            "Backup hati gagal, semua data cinta hilang.",
            "Bootloop perasaan, stuck di kenangan."
        ];

        function updateDitolakCewekText() {
            const randomIndex = Math.floor(Math.random() * ditolakCewekQuotes.length);
            const quote = ditolakCewekQuotes[randomIndex];
            ditolakCewekOutput.textContent = quote;
            applyRainbowEffectToElement(ditolakCewekOutput);
        }

        updateDitolakCewekText();
        setInterval(updateDitolakCewekText, 10000); // Change quote every 10 seconds

        // Initial check for Ezra login on page load
        checkEzraLoginAndShowVisitorsButton();
    </script>
</body>
</html>
