<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Pribadi Ezra</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style id="dynamic-styles">
        /* CSS Umum dan Default (Light Theme) */
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --accent-color: #007bff;
            --border-color: #e0e0e0;
            --header-bg: #ffffff;
            --nav-link-color: #555;
            --nav-link-hover: #007bff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --code-bg: #f5f5f5;
            --code-border: #ddd;
            --chat-bg-owner: #e6f7ff;
            --chat-bg-visitor: #f0f0f0;
            --audio-wave-color: #007bff;
        }

        /* Dark Theme */
        body.dark-mode {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #e0e0e0;
            --accent-color: #0f4c75;
            --border-color: #333;
            --header-bg: #0f3460;
            --nav-link-color: #ccc;
            --nav-link-hover: #3e92cc;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --code-bg: #222;
            --code-border: #444;
            --chat-bg-owner: #0f4c75;
            --chat-bg-visitor: #2e3a51;
            --audio-wave-color: #3e92cc;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        #app-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .view-section {
            display: none; /* Default hidden, managed by JS */
            flex-grow: 1;
            padding: 20px;
        }

        /* Navigasi Samping / Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--card-bg);
            padding: 20px;
            box-shadow: var(--shadow);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            text-decoration: none;
            color: var(--nav-link-color);
            border-radius: 8px;
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
        }

        .sidebar a i {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .sidebar a:hover, .sidebar a.active {
            background-color: var(--accent-color);
            color: white;
        }

        /* Header */
        .header {
            background-color: var(--header-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            margin: 0;
            font-size: 1.8em;
            color: var(--text-color);
        }

        .header .theme-switcher {
            cursor: pointer;
            font-size: 1.5em;
            color: var(--text-color);
            transition: color 0.2s;
        }

        .header .theme-switcher:hover {
            color: var(--accent-color);
        }

        /* Konten Utama */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-content: flex-start; /* Penting untuk wrapping card */
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            flex: 1 1 calc(33.333% - 40px); /* 3 kartu per baris, disesuaikan dengan gap */
            box-sizing: border-box;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card h2 {
            margin-top: 0;
            color: var(--accent-color);
            font-size: 1.5em;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .card p {
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: auto; /* Push buttons to the bottom of the card */
        }

        .button-group a, .button-group button {
            background-color: var(--accent-color);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .button-group a:hover, .button-group button:hover {
            background-color: darken(var(--accent-color), 10%); /* Placeholder for CSS color functions */
            filter: brightness(0.9);
        }

        .button-group a i, .button-group button i {
            margin-right: 8px;
        }

        /* Code Editor */
        #code-editor-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #html-code {
            width: 100%;
            height: 300px;
            border: 1px solid var(--code-border);
            background-color: var(--code-bg);
            color: var(--text-color);
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            resize: vertical;
            border-radius: 8px;
        }
        #code-preview {
            width: 100%;
            height: 400px;
            border: 1px solid var(--code-border);
            border-radius: 8px;
            background-color: white; /* Always white for clarity */
        }
        .code-editor-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .code-editor-controls button {
            background-color: var(--accent-color);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .code-editor-controls button:hover {
            filter: brightness(0.9);
        }
        input[type="file"] {
            display: none; /* Hide default input */
        }
        .custom-file-upload {
            background-color: #28a745; /* Green for upload */
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: inline-block;
        }
        .custom-file-upload:hover {
            filter: brightness(0.9);
        }

        /* Music Player */
        #music-player-card {
            flex-basis: 100%; /* Take full width */
        }
        .music-player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }
        .music-player-controls button {
            background: none;
            border: none;
            font-size: 1.8em;
            color: var(--accent-color);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .music-player-controls button:hover {
            transform: scale(1.1);
        }
        #audio-progress-container {
            flex-grow: 1;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        #audio-progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            border-radius: 4px;
        }
        #audio-time {
            font-size: 0.9em;
            margin-left: 10px;
            color: var(--text-color);
        }
        #volume-control {
            width: 80px;
        }
        #music-visualizer canvas {
            width: 100%;
            height: 100px;
            background-color: var(--code-bg);
            border-radius: 8px;
            margin-top: 15px;
        }
        .audio-track-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }
        .audio-track-list div {
            padding: 8px 0;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        .audio-track-list div:hover {
            background-color: var(--border-color);
        }
        .audio-track-list div.active-track {
            background-color: var(--accent-color);
            color: white;
            border-radius: 4px;
        }
        .audio-track-list div i {
            margin-right: 10px;
        }

        /* Live Chat */
        #chat-container {
            display: flex;
            flex-direction: column;
            height: 400px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }
        #chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chat-message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        .chat-message.owner {
            align-self: flex-end;
            background-color: var(--chat-bg-owner);
            color: var(--text-color);
            border-bottom-right-radius: 2px;
        }
        .chat-message.visitor {
            align-self: flex-start;
            background-color: var(--chat-bg-visitor);
            color: var(--text-color);
            border-bottom-left-radius: 2px;
        }
        #chat-input-area {
            display: flex;
            border-top: 1px solid var(--border-color);
            padding: 10px;
            background-color: var(--card-bg);
        }
        #chat-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            margin-right: 10px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        #chat-send-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #chat-send-btn:hover {
            filter: brightness(0.9);
        }

        /* Admin View Specifics */
        .admin-dashboard-container {
            display: flex;
            flex-grow: 1;
        }

        .admin-main-content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-content: flex-start;
        }

        /* Live Visitors */
        #live-visitors-card {
            flex-basis: 100%;
        }
        #visitor-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
        }
        .visitor-item {
            padding: 8px 0;
            border-bottom: 1px dashed var(--border-color);
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }
        .visitor-item:last-child {
            border-bottom: none;
        }
        .visitor-item span {
            word-break: break-all;
        }

        /* Gallery Content */
        #gallery-content-card {
            flex-basis: 100%;
        }
        #gallery-upload-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            border: 1px dashed var(--border-color);
            padding: 15px;
            border-radius: 8px;
            align-items: flex-start;
        }
        #gallery-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        .gallery-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            width: 180px;
            box-shadow: var(--shadow);
            position: relative;
            background-color: var(--card-bg);
            display: flex;
            flex-direction: column;
        }
        .gallery-item img, .gallery-item video, .gallery-item audio {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }
        .gallery-item audio {
            height: auto;
            min-height: 40px;
            padding: 5px;
        }
        .gallery-item .item-info {
            padding: 10px;
            font-size: 0.9em;
            color: var(--text-color);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .gallery-item .item-info h4 {
            margin: 0;
            font-size: 1.1em;
            color: var(--accent-color);
        }
        .gallery-item .item-actions {
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            padding: 5px 10px 10px;
        }
        .gallery-item .item-actions button {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 1em;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .gallery-item .item-actions button:hover {
            background-color: var(--border-color);
        }

        /* Ruang Khusus Diriku */
        #my-space-card {
            flex-basis: 100%;
        }
        .video-streaming-section {
            margin-bottom: 20px;
        }
        .video-streaming-section video {
            width: 100%;
            max-height: 400px;
            background-color: black;
            border-radius: 8px;
        }
        .inspirational-quotes, .hacking-news {
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }
        .inspirational-quotes p, .hacking-news p {
            background-color: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap; /* Preserve line breaks */
        }
        .news-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border-color);
        }
        .news-item:last-child {
            border-bottom: none;
        }
        .news-item h3 {
            margin: 0 0 5px 0;
            color: var(--accent-color);
        }
        .news-item a {
            color: var(--accent-color);
            text-decoration: none;
        }
        .news-item a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .card {
                flex: 1 1 calc(50% - 30px); /* 2 kartu per baris */
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            .main-content, .admin-main-content {
                padding: 15px;
            }
            .card {
                flex: 1 1 100%; /* 1 kartu per baris */
                min-width: unset;
            }
            .header h1 {
                font-size: 1.5em;
            }
            .music-player-controls {
                flex-wrap: wrap;
            }
            #audio-progress-container {
                width: 100%;
                margin-top: 10px;
            }
            #audio-time {
                margin-left: 0;
                text-align: right;
                width: 100%;
            }
            #volume-control {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div class="header">
            <h1 id="website-title">Dashboard Pribadi Ezra</h1>
            <div class="theme-switcher" id="theme-switcher">
                <i class="fas fa-moon"></i>
            </div>
        </div>

        <div id="guest-view" class="view-section">
            <div class="main-content">
                <div class="card">
                    <h2><i class="fas fa-code"></i> HTML Code Editor</h2>
                    <div id="code-editor-container">
                        <textarea id="html-code" placeholder="Tulis kode HTML Anda di sini..."></textarea>
                        <div class="code-editor-controls">
                            <button id="run-code"><i class="fas fa-play"></i> Run/Preview</button>
                            <button id="save-code"><i class="fas fa-save"></i> Save</button>
                            <button id="load-code"><i class="fas fa-folder-open"></i> Load</button>
                            <button id="undo-code"><i class="fas fa-undo"></i> Undo</button>
                            <button id="redo-code"><i class="fas fa-redo"></i> Redo</button>
                            <label for="insert-media-file" class="custom-file-upload"><i class="fas fa-plus"></i> Insert Media</label>
                            <input type="file" id="insert-media-file" accept="image/*,video/*,audio/*">
                        </div>
                        <iframe id="code-preview" sandbox="allow-scripts allow-same-origin"></iframe>
                    </div>
                </div>

                <div class="card" id="music-player-card">
                    <h2><i class="fas fa-music"></i> Music Player</h2>
                    <audio id="background-audio" loop></audio>
                    <div class="music-player-controls">
                        <button id="prev-track"><i class="fas fa-backward"></i></button>
                        <button id="play-pause"><i class="fas fa-play"></i></button>
                        <button id="next-track"><i class="fas fa-forward"></i></button>
                        <button id="loop-toggle" title="Toggle Loop"><i class="fas fa-sync"></i></button>
                        <div id="audio-progress-container">
                            <div id="audio-progress-bar"></div>
                        </div>
                        <span id="audio-time">0:00 / 0:00</span>
                        <input type="range" id="volume-control" min="0" max="1" step="0.01" value="0.7">
                    </div>
                    <canvas id="music-visualizer"></canvas>
                    <div class="audio-track-list" id="audio-track-list">
                        </div>
                    <input type="file" id="upload-music" accept="audio/*" multiple style="display: none;">
                    <button onclick="document.getElementById('upload-music').click()" class="button-group-upload"><i class="fas fa-upload"></i> Upload Music</button>
                </div>

                <div class="card">
                    <h2><i class="fas fa-comments"></i> Live Chat</h2>
                    <div id="chat-container">
                        <div id="chat-messages">
                            </div>
                        <div id="chat-input-area">
                            <input type="text" id="chat-input" placeholder="Ketik pesan Anda...">
                            <button id="chat-send-btn"><i class="fas fa-paper-plane"></i> Kirim</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-info-circle"></i> Informasi Website</h2>
                    <p>Umur Website: <span id="website-age"></span></p>
                    <p>Total Kunjungan: <span id="hit-counter"></span></p>
                    <p>Fitur Eksklusif dan Personal untuk Ezra.</p>
                </div>

                <div class="card">
                    <h2><i class="fas fa-share-alt"></i> Hubungi Aku</h2>
                    <div class="button-group">
                        <a href="https://wa.me/YOUR_WA_NUMBER" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                        <a href="https://www.instagram.com/YOUR_IG_USERNAME" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
                        <a href="https://alkitab.me/in-tb/Matius/5/13" target="_blank"><i class="fas fa-bible"></i> Alkitab</a>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-view" class="view-section">
            <div class="admin-dashboard-container">
                <div class="sidebar">
                    <a href="#" id="admin-nav-visitors" class="active"><i class="fas fa-users"></i> Live Visitors</a>
                    <a href="#" id="admin-nav-gallery"><i class="fas fa-images"></i> Gallery Content</a>
                    <a href="#" id="admin-nav-myspace"><i class="fas fa-user-secret"></i> Ruang Khusus Diriku</a>
                    <a href="#" id="admin-logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>

                <div class="admin-main-content">
                    <div class="card admin-panel" id="admin-panel-visitors">
                        <h2><i class="fas fa-users"></i> Live Visitors</h2>
                        <div id="visitor-list">
                            <p>Loading live visitor data...</p>
                        </div>
                    </div>

                    <div class="card admin-panel" id="admin-panel-gallery" style="display: none;">
                        <h2><i class="fas fa-images"></i> Gallery Content (Moments)</h2>
                        <div id="gallery-upload-area">
                            <input type="text" id="gallery-item-title" placeholder="Judul Moment" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color);">
                            <textarea id="gallery-item-description" placeholder="Deskripsi Moment" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); height: 80px;"></textarea>
                            <label for="gallery-file-upload" class="custom-file-upload"><i class="fas fa-upload"></i> Pilih Media</label>
                            <input type="file" id="gallery-file-upload" accept="image/*,video/*,audio/*,application/pdf" style="display: none;">
                            <button id="upload-gallery-item" class="button-group-upload"><i class="fas fa-plus"></i> Tambah Moment</button>
                            <span id="upload-status-message" style="font-size: 0.9em; color: green;"></span>
                        </div>
                        <div id="gallery-preview-container">
                            <p>Moment-moment Anda akan muncul di sini.</p>
                        </div>
                    </div>

                    <div class="card admin-panel" id="admin-panel-myspace" style="display: none;">
                        <h2><i class="fas fa-user-secret"></i> Ruang Khusus Diriku</h2>
                        <div class="video-streaming-section">
                            <h3>Video Streaming Pribadi</h3>
                            <input type="text" id="video-stream-url" placeholder="Paste URL Video (e.g., MP4, HLS, DASH)" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color);">
                            <button id="load-video-stream" style="margin-top: 10px; background-color: #6c757d; color: white; padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer;">Load Video</button>
                            <video id="my-private-video" controls></video>
                        </div>

                        <div class="inspirational-quotes">
                            <h3>Kata-kata Penghibur untuk Putus Cinta</h3>
                            <p id="breakup-quote">
                                Cinta adalah perjalanan, bukan tujuan. Terkadang, perpisahan adalah langkah yang diperlukan untuk menemukan arah yang lebih baik. Biarkan waktu menyembuhkan, dan percayalah bahwa ada babak baru yang menanti dengan kebahagiaan yang lebih besar.
                            </p>
                            <button id="generate-new-quote" style="background-color: #17a2b8; color: white; padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer;">Kata-kata Lain</button>
                        </div>

                        <div class="hacking-news">
                            <h3>Berita Hacking Terkini (Simulasi/Placeholder)</h3>
                            <div id="hacking-news-list">
                                <div class="news-item">
                                    <h3><a href="#" target="_blank">Waspada Serangan Phishing Terbaru Mengincar Data Pribadi</a></h3>
                                    <p>Para ahli keamanan siber menemukan gelombang baru serangan phishing yang sangat canggih...</p>
                                    <span>2025-06-28</span>
                                </div>
                                <div class="news-item">
                                    <h3><a href="#" target="_blank">Bug Kritis Ditemukan di Sistem Operasi Populer, Segera Patch!</a></h3>
                                    <p>Sebuah kerentanan serius telah diidentifikasi yang memungkinkan eksekusi kode jarak jauh...</p>
                                    <span>2025-06-27</span>
                                </div>
                                </div>
                            <button id="refresh-hacking-news" style="background-color: #dc3545; color: white; padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer;">Refresh Berita</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====================================================================
        // GLOBAL CONFIGURATION & UTILITIES
        // ====================================================================
        const WORKER_URL = 'YOUR_CLOUDFLARE_WORKER_URL'; // GANTI DENGAN URL WORKER ANDA!
        const GITHUB_USERNAME = 'YOUR_GITHUB_USERNAME'; // GANTI DENGAN USERNAME GITHUB ANDA
        const GITHUB_REPO = 'YOUR_GITHUB_REPO_NAME'; // GANTI DENGAN NAMA REPO GITHUB ANDA
        const GITHUB_TOKEN = 'YOUR_GITHUB_PERSONAL_ACCESS_TOKEN'; // GANTI DENGAN TOKEN GITHUB ANDA (HATI-HATI JANGAN DIPUBLIKASIKAN!)

        const WA_NUMBER = 'YOUR_WA_NUMBER'; // GANTI DENGAN NOMOR WA ANDA
        const IG_USERNAME = 'YOUR_IG_USERNAME'; // GANTI DENGAN USERNAME IG ANDA

        const WEBSITE_BIRTH_DATE = new Date('2024-01-01T00:00:00Z'); // GANTI DENGAN TANGGAL LAHIR WEBSITE

        const BREAKUP_QUOTES = [
            "Cinta adalah perjalanan, bukan tujuan. Terkadang, perpisahan adalah langkah yang diperlukan untuk menemukan arah yang lebih baik. Biarkan waktu menyembuhkan, dan percayalah bahwa ada babak baru yang menanti dengan kebahagiaan yang lebih besar.",
            "Setiap akhir adalah awal yang baru. Meskipun terasa sakit sekarang, percayalah bahwa ada kebahagiaan yang menanti di depan.",
            "Patah hati adalah bagian dari pertumbuhan. Ini adalah kesempatan untuk mengenal diri sendiri lebih baik dan menjadi lebih kuat.",
            "Jangan pernah menyesali cinta yang hilang, karena setiap pengalaman mengajarkan sesuatu yang berharga.",
            "Cinta sejati tidak pernah berakhir, ia hanya berubah bentuk. Lepaskan yang lama untuk memberi ruang bagi yang baru dan lebih baik.",
            "Kesedihan adalah jembatan menuju kebahagiaan. Rasakanlah, lalu lepaskan, dan melangkahlah maju.",
            "Bukan apa yang terjadi padamu, tetapi bagaimana kamu bereaksi terhadapnya yang penting. Kamu lebih kuat dari yang kamu kira.",
            "Terimalah rasa sakit, lalu lepaskan. Kehidupan terus berjalan, dan begitu juga kamu.",
            "Kamu pantas mendapatkan cinta yang tulus. Percayalah bahwa yang terbaik akan datang pada waktu yang tepat."
        ];

        let visitorHistory = []; // Untuk menyimpan riwayat pengunjung lokal (simulasi)
        let chatMessages = []; // Untuk menyimpan pesan chat lokal (simulasi)
        let audioTracks = [
            { name: "Track 1: Morning Vibes", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { name: "Track 2: Chill Beat", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { name: "Track 3: Upbeat Groove", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" }
            // Tambahkan lebih banyak lagu di sini
        ];
        let currentTrackIndex = 0;
        let galleryMoments = []; // Untuk menyimpan data gallery

        // Utility function to fetch from Worker
        async function fetchFromWorker(path, method = 'GET', body = null) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
            };
            if (body) {
                options.body = JSON.stringify(body);
            }
            try {
                const response = await fetch(`${WORKER_URL}${path}`, options);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Error fetching from worker (${path}):`, error);
                return null;
            }
        }

        // ====================================================================
        // DOM ELEMENTS
        // ====================================================================
        const appContainer = document.getElementById('app-container');
        const guestView = document.getElementById('guest-view');
        const adminView = document.getElementById('admin-view');
        const themeSwitcher = document.getElementById('theme-switcher');
        const websiteAgeSpan = document.getElementById('website-age');
        const hitCounterSpan = document.getElementById('hit-counter');

        // Guest View Elements
        const htmlCodeEditor = document.getElementById('html-code');
        const codePreview = document.getElementById('code-preview');
        const runCodeBtn = document.getElementById('run-code');
        const saveCodeBtn = document.getElementById('save-code');
        const loadCodeBtn = document.getElementById('load-code');
        const undoCodeBtn = document.getElementById('undo-code');
        const redoCodeBtn = document.getElementById('redo-code');
        const insertMediaFile = document.getElementById('insert-media-file');

        const backgroundAudio = document.getElementById('background-audio');
        const playPauseBtn = document.getElementById('play-pause');
        const prevTrackBtn = document.getElementById('prev-track');
        const nextTrackBtn = document.getElementById('next-track');
        const loopToggleBtn = document.getElementById('loop-toggle');
        const audioProgressBar = document.getElementById('audio-progress-bar');
        const audioProgressContainer = document.getElementById('audio-progress-container');
        const audioTimeSpan = document.getElementById('audio-time');
        const volumeControl = document.getElementById('volume-control');
        const musicVisualizerCanvas = document.getElementById('music-visualizer');
        const audioTrackListDiv = document.getElementById('audio-track-list');
        const uploadMusicInput = document.getElementById('upload-music');

        const chatMessagesDiv = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');

        // Admin View Elements
        const adminNavVisitors = document.getElementById('admin-nav-visitors');
        const adminNavGallery = document.getElementById('admin-nav-gallery');
        const adminNavMySpace = document.getElementById('admin-nav-myspace');
        const adminLogoutBtn = document.getElementById('admin-logout');

        const adminPanelVisitors = document.getElementById('admin-panel-visitors');
        const adminPanelGallery = document.getElementById('admin-panel-gallery');
        const adminPanelMySpace = document.getElementById('admin-panel-myspace');

        const visitorListDiv = document.getElementById('visitor-list');

        const galleryItemTitle = document.getElementById('gallery-item-title');
        const galleryItemDescription = document.getElementById('gallery-item-description');
        const galleryFileUpload = document.getElementById('gallery-file-upload');
        const uploadGalleryItemBtn = document.getElementById('upload-gallery-item');
        const uploadStatusMessage = document.getElementById('upload-status-message');
        const galleryPreviewContainer = document.getElementById('gallery-preview-container');

        const videoStreamUrlInput = document.getElementById('video-stream-url');
        const loadVideoStreamBtn = document.getElementById('load-video-stream');
        const myPrivateVideo = document.getElementById('my-private-video');
        const breakupQuoteP = document.getElementById('breakup-quote');
        const generateNewQuoteBtn = document.getElementById('generate-new-quote');
        const hackingNewsListDiv = document.getElementById('hacking-news-list');
        const refreshHackingNewsBtn = document.getElementById('refresh-hacking-news');

        // ====================================================================
        // THEME SWITCHER
        // ====================================================================
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            themeSwitcher.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeSwitcher.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('dark-mode');
                themeSwitcher.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }
        themeSwitcher.addEventListener('click', toggleTheme);
        loadTheme(); // Load theme on page load

        // ====================================================================
        // WEBSITE AGE & HIT COUNTER (GUEST & ADMIN)
        // ====================================================================
        function calculateWebsiteAge() {
            const now = new Date();
            const diffTime = Math.abs(now - WEBSITE_BIRTH_DATE);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const years = Math.floor(diffDays / 365);
            const remainingDays = diffDays % 365;
            const months = Math.floor(remainingDays / 30); // Approx. months
            const days = remainingDays % 30;

            let ageString = '';
            if (years > 0) ageString += `${years} tahun `;
            if (months > 0) ageString += `${months} bulan `;
            if (days > 0) ageString += `${days} hari`;
            if (ageString === '') ageString = 'Baru saja diluncurkan!';
            websiteAgeSpan.textContent = ageString.trim();
        }

        async function updateHitCounter() {
            // Increment hit counter on load (only if not an admin session already counted)
            if (!localStorage.getItem('hasIncrementedHit')) {
                const result = await fetchFromWorker('/increment-hit-counter', 'POST');
                if (result) {
                    hitCounterSpan.textContent = result.hits;
                    localStorage.setItem('hasIncrementedHit', 'true'); // Prevent multiple increments in one session
                }
            } else {
                const result = await fetchFromWorker('/get-hit-counter', 'GET');
                if (result) {
                    hitCounterSpan.textContent = result.hits;
                }
            }
        }

        calculateWebsiteAge();
        updateHitCounter();

        // ====================================================================
        // CODE EDITOR (GUEST)
        // ====================================================================
        function runCode() {
            const code = htmlCodeEditor.value;
            const iframeDoc = codePreview.contentWindow.document;
            iframeDoc.open();
            iframeDoc.write(code);
            iframeDoc.close();
        }

        function saveCode() {
            const code = htmlCodeEditor.value;
            localStorage.setItem('savedHtmlCode', code);
            alert('Kode HTML disimpan!');
        }

        function loadCode() {
            const savedCode = localStorage.getItem('savedHtmlCode');
            if (savedCode) {
                htmlCodeEditor.value = savedCode;
                runCode();
                alert('Kode HTML dimuat!');
            } else {
                alert('Tidak ada kode yang tersimpan.');
            }
        }

        // Basic Undo/Redo (limited, for full features need a library)
        let history = [];
        let historyIndex = -1;

        function recordHistory() {
            if (htmlCodeEditor.value !== history[historyIndex]) {
                history = history.slice(0, historyIndex + 1);
                history.push(htmlCodeEditor.value);
                historyIndex++;
            }
        }

        function undoCode() {
            if (historyIndex > 0) {
                historyIndex--;
                htmlCodeEditor.value = history[historyIndex];
                runCode();
            }
        }

        function redoCode() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                htmlCodeEditor.value = history[historyIndex];
                runCode();
            }
        }

        htmlCodeEditor.addEventListener('input', () => {
            recordHistory();
            runCode(); // Live preview as you type
        });

        // Initialize history with current content
        recordHistory();

        runCodeBtn.addEventListener('click', runCode);
        saveCodeBtn.addEventListener('click', saveCode);
        loadCodeBtn.addEventListener('click', loadCode);
        undoCodeBtn.addEventListener('click', undoCode);
        redoCodeBtn.addEventListener('click', redoCode);

        // Insert Media
        insertMediaFile.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const dataURL = e.target.result;
                    let mediaTag = '';
                    if (file.type.startsWith('image/')) {
                        mediaTag = `<img src="${dataURL}" alt="Inserted Image" style="max-width:100%;">`;
                    } else if (file.type.startsWith('video/')) {
                        mediaTag = `<video controls src="${dataURL}" style="max-width:100%;"></video>`;
                    } else if (file.type.startsWith('audio/')) {
                        mediaTag = `<audio controls src="${dataURL}"></audio>`;
                    }
                    const start = htmlCodeEditor.selectionStart;
                    const end = htmlCodeEditor.selectionEnd;
                    htmlCodeEditor.value = htmlCodeEditor.value.substring(0, start) + mediaTag + htmlCodeEditor.value.substring(end);
                    runCode();
                };
                reader.readAsDataURL(file);
            }
        });


        // ====================================================================
        // MUSIC PLAYER (GUEST)
        // ====================================================================
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let analyser = audioContext.createAnalyser();
        let source;
        let dataArray;
        let bufferLength;
        let canvasCtx = musicVisualizerCanvas.getContext('2d');

        function setupAudioVisualizer() {
            if (!source) {
                source = audioContext.createMediaElementSource(backgroundAudio);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                analyser.fftSize = 256;
                bufferLength = analyser.frequencyBinData.length;
                dataArray = new Uint8Array(bufferLength);
            }
            drawVisualizer();
        }

        function drawVisualizer() {
            requestAnimationFrame(drawVisualizer);

            analyser.getByteFrequencyData(dataArray);

            canvasCtx.clearRect(0, 0, musicVisualizerCanvas.width, musicVisualizerCanvas.height);

            const barWidth = (musicVisualizerCanvas.width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;

            for (let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i] / 2;

                canvasCtx.fillStyle = 'var(--audio-wave-color)';
                canvasCtx.fillRect(x, musicVisualizerCanvas.height - barHeight / 2, barWidth, barHeight);

                x += barWidth + 1;
            }
        }

        function loadTrack(index) {
            backgroundAudio.src = audioTracks[index].src;
            backgroundAudio.load();
            backgroundAudio.play().then(() => {
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                if (!source) { // Ensure visualizer is setup only once after first play
                    setupAudioVisualizer();
                }
            }).catch(e => console.error("Error playing audio:", e));
            highlightCurrentTrack(index);
        }

        function playPauseAudio() {
            if (backgroundAudio.paused) {
                backgroundAudio.play().then(() => {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    if (!source) {
                        setupAudioVisualizer();
                    }
                }).catch(e => console.error("Error playing audio:", e));
            } else {
                backgroundAudio.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        function nextTrack() {
            currentTrackIndex = (currentTrackIndex + 1) % audioTracks.length;
            loadTrack(currentTrackIndex);
        }

        function prevTrack() {
            currentTrackIndex = (currentTrackIndex - 1 + audioTracks.length) % audioTracks.length;
            loadTrack(currentTrackIndex);
        }

        function updateProgressBar() {
            const progress = (backgroundAudio.currentTime / backgroundAudio.duration) * 100;
            audioProgressBar.style.width = `${progress}%`;
            audioTimeSpan.textContent = `${formatTime(backgroundAudio.currentTime)} / ${formatTime(backgroundAudio.duration)}`;
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function setAudioProgress(e) {
            const width = audioProgressContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = backgroundAudio.duration;
            backgroundAudio.currentTime = (clickX / width) * duration;
        }

        function toggleLoop() {
            backgroundAudio.loop = !backgroundAudio.loop;
            loopToggleBtn.style.color = backgroundAudio.loop ? 'var(--accent-color)' : 'var(--nav-link-color)';
            alert(`Looping ${backgroundAudio.loop ? 'aktif' : 'nonaktif'}`);
        }

        function renderAudioTracks() {
            audioTrackListDiv.innerHTML = '';
            audioTracks.forEach((track, index) => {
                const trackDiv = document.createElement('div');
                trackDiv.classList.add('audio-track-item');
                if (index === currentTrackIndex) {
                    trackDiv.classList.add('active-track');
                }
                trackDiv.innerHTML = `<i class="fas fa-music"></i> <span>${track.name}</span>`;
                trackDiv.addEventListener('click', () => {
                    currentTrackIndex = index;
                    loadTrack(currentTrackIndex);
                });
                audioTrackListDiv.appendChild(trackDiv);
            });
        }

        function highlightCurrentTrack(index) {
            const trackItems = audioTrackListDiv.querySelectorAll('.audio-track-item');
            trackItems.forEach((item, idx) => {
                if (idx === index) {
                    item.classList.add('active-track');
                } else {
                    item.classList.remove('active-track');
                }
            });
        }

        playPauseBtn.addEventListener('click', playPauseAudio);
        nextTrackBtn.addEventListener('click', nextTrack);
        prevTrackBtn.addEventListener('click', prevTrack);
        loopToggleBtn.addEventListener('click', toggleLoop);
        backgroundAudio.addEventListener('timeupdate', updateProgressBar);
        backgroundAudio.addEventListener('ended', nextTrack);
        volumeControl.addEventListener('input', (e) => backgroundAudio.volume = e.target.value);
        audioProgressContainer.addEventListener('click', setAudioProgress);

        uploadMusicInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    // Create a Blob URL for the audio file
                    const blobUrl = URL.createObjectURL(file);
                    audioTracks.push({ name: file.name, src: blobUrl });
                }
                renderAudioTracks();
                alert(`${files.length} lagu berhasil ditambahkan!`);
            }
        });

        // Initial load for music player
        if (audioTracks.length > 0) {
            loadTrack(currentTrackIndex); // Load the first track
        }
        renderAudioTracks(); // Render the list of tracks


        // ====================================================================
        // LIVE CHAT (GUEST) - Simple client-side simulation for now
        // For real-time, needs WebSockets/polling to Cloudflare KV.
        // ====================================================================
        function addChatMessage(message, sender) {
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('chat-message', sender);
            msgDiv.textContent = message;
            chatMessagesDiv.appendChild(msgDiv);
            chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Auto-scroll to bottom
            chatMessages.push({ message, sender, timestamp: new Date().toISOString() }); // Store for history
            // In a real app, you'd send this to Cloudflare Worker to save to KV
        }

        function sendChatMessage() {
            const message = chatInput.value.trim();
            if (message) {
                addChatMessage(message, 'owner'); // Simulate owner sending message
                chatInput.value = '';
                // Simulate a visitor response for demo purposes
                setTimeout(() => {
                    addChatMessage(`Terima kasih atas pesan Anda: "${message}". Saya akan segera membalas!`, 'visitor');
                }, 1500);
            }
        }

        chatSendBtn.addEventListener('click', sendChatMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // ====================================================================
        // LOGIN & VIEW MANAGEMENT
        // ====================================================================
        async function checkLoginStatus() {
            const bioVAuthSession = localStorage.getItem('bioVAuthSession');

            if (bioVAuthSession) {
                // Verify the token with Cloudflare Worker
                const response = await fetchFromWorker('/verify-auth-session', 'POST', { sessionKey: bioVAuthSession });

                if (response && response.authenticated) {
                    showAdminView();
                    return;
                } else {
                    console.warn('Invalid or expired bioVAuthSession. Clearing...');
                    localStorage.removeItem('bioVAuthSession'); // Clear invalid session
                }
            }
            showGuestView();
        }

        function showGuestView() {
            guestView.style.display = 'flex';
            adminView.style.display = 'none';
            document.getElementById('website-title').textContent = 'Dashboard Pribadi Ezra'; // Reset title for guest
        }

        function showAdminView() {
            guestView.style.display = 'none';
            adminView.style.display = 'flex';
            document.getElementById('website-title').textContent = 'Admin Dashboard - Ezra'; // Change title for admin
            loadAdminData(); // Load admin-specific data
        }

        function handleSuccessfulLogin(sessionKey) {
            localStorage.setItem('bioVAuthSession', sessionKey);
            showAdminView();
        }

        function adminLogout() {
            localStorage.removeItem('bioVAuthSession');
            localStorage.removeItem('hasIncrementedHit'); // Allow hit counter to increment again for guest
            showGuestView();
            alert('Anda telah logout dari mode admin.');
        }

        // Handle login logic from external JS (as described in prompt)
        // Assume this function will be called by your external login.html's JS
        // For demonstration, let's manually trigger it after a delay or a mock login.
        // Example: If an external login page redirects back with a query param or sets localStorage:
        // window.simulateLogin = (key) => handleSuccessfulLogin(key);

        // --- Mock Login Verification (Replace with your actual login.html integration) ---
        // This is where you'd integrate the logic from your `login.html`
        // For testing, uncomment the line below and ensure your `login.html` sets `bioVAuthSession` correctly
        // For instance, if `login.html` sets localStorage.setItem('bioVAuthSession', 'your-secret-ezra-key');
        // then the `checkLoginStatus()` will pick it up and verify with the Worker.

        // Example of how `login.html` might set the session (DON'T DO THIS IN REAL PROD, it's insecure):
        // (This would be in your separate login.html's JS after successful server verification)
        // localStorage.setItem('bioVAuthSession', 'your-secret-ezra-key');
        // window.location.href = '/'; // Redirect to the main dashboard

        // --- End Mock Login Verification ---

        // ====================================================================
        // ADMIN DASHBOARD FEATURES
        // ====================================================================

        // Admin Navigation
        const adminPanels = {
            'admin-panel-visitors': adminPanelVisitors,
            'admin-panel-gallery': adminPanelGallery,
            'admin-panel-myspace': adminPanelMySpace
        };

        function showAdminPanel(panelId) {
            for (const key in adminPanels) {
                adminPanels[key].style.display = (key === panelId) ? 'flex' : 'none';
            }
            // Update active state in sidebar
            const navLinks = document.querySelectorAll('.sidebar a');
            navLinks.forEach(link => link.classList.remove('active'));
            document.getElementById(`admin-nav-${panelId.replace('admin-panel-', '')}`).classList.add('active');
        }

        adminNavVisitors.addEventListener('click', (e) => { e.preventDefault(); showAdminPanel('admin-panel-visitors'); });
        adminNavGallery.addEventListener('click', (e) => { e.preventDefault(); showAdminPanel('admin-panel-gallery'); loadGalleryMoments(); });
        adminNavMySpace.addEventListener('click', (e) => { e.preventDefault(); showAdminPanel('admin-panel-myspace'); });
        adminLogoutBtn.addEventListener('click', adminLogout);


        // Live Visitors (Admin)
        async function getVisitorIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error("Error fetching IP:", error);
                return 'Unknown';
            }
        }

        function getBrowserInfo() {
            const browser = navigator.userAgent;
            const timestamp = new Date().toLocaleString();
            return { browser, timestamp };
        }

        async function recordAndDisplayVisitor() {
            const ip = await getVisitorIP();
            const { browser, timestamp } = getBrowserInfo();
            const visitorData = { ip, browser, timestamp };

            // Add to local history (for display, not persistent across sessions without backend)
            visitorHistory.unshift(visitorData); // Add to the beginning
            // Keep only the last 10-20 for display
            if (visitorHistory.length > 20) {
                visitorHistory = visitorHistory.slice(0, 20);
            }
            renderVisitorList();

            // In a real scenario, this data would be sent to Cloudflare Worker and stored in KV
            // For now, we're simulating the display based on local generation.
            // A persistent solution would involve the Worker recording visitors and then a separate API
            // call to fetch them for the admin view.
        }

        function renderVisitorList() {
            visitorListDiv.innerHTML = '';
            if (visitorHistory.length === 0) {
                visitorListDiv.innerHTML = '<p>Belum ada pengunjung aktif.</p>';
                return;
            }
            visitorHistory.forEach(visitor => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('visitor-item');
                itemDiv.innerHTML = `
                    <span><strong>IP:</strong> ${visitor.ip}</span>
                    <span><strong>Browser:</strong> ${visitor.browser}</span>
                    <span><strong>Waktu:</strong> ${visitor.timestamp}</span>
                `;
                visitorListDiv.appendChild(itemDiv);
            });
        }

        // Gallery Content (Admin) - Using Cloudflare KV via Worker
        async function uploadGalleryItem() {
            const title = galleryItemTitle.value.trim();
            const description = galleryItemDescription.value.trim();
            const file = galleryFileUpload.files[0];

            if (!title || !description || !file) {
                uploadStatusMessage.textContent = 'Harap lengkapi semua bidang dan pilih file.';
                uploadStatusMessage.style.color = 'red';
                return;
            }

            uploadStatusMessage.textContent = 'Mengunggah...';
            uploadStatusMessage.style.color = 'orange';

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64Content = e.target.result.split(',')[1]; // Get base64 string
                const fileName = file.name;
                const fileType = file.type;

                // For actual GitHub integration, you'd use GitHub API here
                // Example with GitHub API (requires GITHUB_TOKEN with repo scope):
                // const githubApiPath = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/gallery/${fileName}`;
                // const githubBody = {
                //     message: `Add gallery item: ${fileName}`,
                //     content: base64Content,
                //     branch: 'main' // or your default branch
                // };
                // const githubHeaders = {
                //     'Authorization': `token ${GITHUB_TOKEN}`,
                //     'Content-Type': 'application/json'
                // };
                // try {
                //     const githubResponse = await fetch(githubApiPath, {
                //         method: 'PUT',
                //         headers: githubHeaders,
                //         body: JSON.stringify(githubBody)
                //     });
                //     if (!githubResponse.ok) {
                //         throw new Error(`GitHub API error: ${githubResponse.statusText}`);
                //     }
                //     const githubResult = await githubResponse.json();
                //     const mediaUrl = githubResult.content.download_url; // Or raw.githubusercontent.com URL
                //     console.log('File uploaded to GitHub:', mediaUrl);

                // Now save metadata to KV
                const newMoment = {
                    title,
                    description,
                    mediaUrl: e.target.result, // Use Data URL for simplicity in demo, replace with actual GitHub URL
                    fileType,
                    fileName,
                    timestamp: new Date().toISOString()
                };

                const result = await fetchFromWorker('/gallery-moments', 'POST', newMoment);

                if (result && result.success) {
                    uploadStatusMessage.textContent = 'Moment berhasil diunggah dan disimpan!';
                    uploadStatusMessage.style.color = 'green';
                    galleryItemTitle.value = '';
                    galleryItemDescription.value = '';
                    galleryFileUpload.value = '';
                    loadGalleryMoments(); // Refresh list
                } else {
                    uploadStatusMessage.textContent = 'Gagal menyimpan moment.';
                    uploadStatusMessage.style.color = 'red';
                }
                // } catch (githubError) {
                //     console.error('Error uploading to GitHub:', githubError);
                //     uploadStatusMessage.textContent = `Gagal mengunggah ke GitHub: ${githubError.message}`;
                //     uploadStatusMessage.style.color = 'red';
                // }
            };
            reader.readAsDataURL(file); // Read as Data URL for direct display
        }

        async function loadGalleryMoments() {
            const result = await fetchFromWorker('/gallery-moments', 'GET');
            if (result) {
                galleryMoments = result;
                renderGalleryMoments();
            } else {
                galleryMoments = [];
                renderGalleryMoments();
            }
        }

        function renderGalleryMoments() {
            galleryPreviewContainer.innerHTML = '';
            if (galleryMoments.length === 0) {
                galleryPreviewContainer.innerHTML = '<p>Belum ada moment yang tersimpan.</p>';
                return;
            }
            galleryMoments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); // Sort by newest first

            galleryMoments.forEach(moment => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('gallery-item');

                let mediaElement;
                if (moment.fileType.startsWith('image/')) {
                    mediaElement = `<img src="${moment.mediaUrl}" alt="${moment.title}">`;
                } else if (moment.fileType.startsWith('video/')) {
                    mediaElement = `<video controls src="${moment.mediaUrl}"></video>`;
                } else if (moment.fileType.startsWith('audio/')) {
                    mediaElement = `<audio controls src="${moment.mediaUrl}"></audio>`;
                } else if (moment.fileType.includes('pdf')) { // For PDF, show an icon/link
                    mediaElement = `<div style="height:120px; display:flex; justify-content:center; align-items:center; background-color: #f0f0f0;"><i class="fas fa-file-pdf" style="font-size: 3em; color: #dc3545;"></i></div>`;
                } else {
                    mediaElement = `<div style="height:120px; display:flex; justify-content:center; align-items:center; background-color: #f0f0f0;"><i class="fas fa-file" style="font-size: 3em; color: #6c757d;"></i></div>`;
                }

                itemDiv.innerHTML = `
                    ${mediaElement}
                    <div class="item-info">
                        <h4>${moment.title}</h4>
                        <p>${moment.description}</p>
                        <small>Diunggah: ${new Date(moment.timestamp).toLocaleDateString()}</small>
                    </div>
                    <div class="item-actions">
                        <button onclick="editGalleryItem('${moment.id}')"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteGalleryItem('${moment.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                galleryPreviewContainer.appendChild(itemDiv);
            });
        }

        async function editGalleryItem(id) {
            alert('Fitur edit moment belum diimplementasikan. Anda bisa menambahkan logikanya di sini!');
            // Implement: Get item by ID, populate form, send PUT request to Worker.
        }

        async function deleteGalleryItem(id) {
            if (confirm('Apakah Anda yakin ingin menghapus moment ini?')) {
                // In a real app, send delete request to Worker which updates KV and potentially GitHub
                // For demo, we'll just remove from local array and re-render.
                const updatedMoments = galleryMoments.filter(m => m.id !== id);
                const result = await fetchFromWorker('/gallery-moments', 'POST', updatedMoments); // Send entire updated array or specific delete endpoint
                if (result && result.success) { // Assuming your Worker's POST for gallery allows full replacement or has a DELETE endpoint
                    galleryMoments = updatedMoments;
                    renderGalleryMoments();
                    alert('Moment berhasil dihapus!');
                } else {
                    alert('Gagal menghapus moment.');
                }
            }
        }

        uploadGalleryItemBtn.addEventListener('click', uploadGalleryItem);

        // Ruang Khusus Diriku (Admin)
        loadVideoStreamBtn.addEventListener('click', () => {
            const url = videoStreamUrlInput.value.trim();
            if (url) {
                myPrivateVideo.src = url;
                myPrivateVideo.load();
                myPrivateVideo.play().catch(e => console.error("Error playing video:", e));
            } else {
                alert('Harap masukkan URL video.');
            }
        });

        generateNewQuoteBtn.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * BREAKUP_QUOTES.length);
            breakupQuoteP.textContent = BREAKUP_QUOTES[randomIndex];
        });

        refreshHackingNewsBtn.addEventListener('click', () => {
            // Simulate fetching new news or just reload existing
            alert('Berita hacking sedang diperbarui... (Simulasi)');
            // In a real app, you'd fetch from an API like newsapi.org or other cybersecurity news sources
            // This would require a proxy in your Cloudflare Worker to avoid CORS issues.
        });

        // ====================================================================
        // INITIALIZATION
        // ====================================================================
        function loadAdminData() {
            recordAndDisplayVisitor(); // Start recording and displaying visitors
            // Consider setting up an interval for live visitor updates
            // setInterval(recordAndDisplayVisitor, 5000); // Update every 5 seconds (be careful with API limits)

            loadGalleryMoments(); // Load gallery on admin view
        }

        // Run this when the page first loads
        window.addEventListener('DOMContentLoaded', checkLoginStatus);

        // Example: if you have a separate login.js that sets bioVAuthSession
        // and redirects, this part won't be explicitly needed here.
        // But if login is on the same page (e.g., a modal), you'd call
        // handleSuccessfulLogin with the verified key.

        // Placeholder for external login function calling handleSuccessfulLogin
        // For testing, if you want to simulate login without a separate login.html,
        // you can use this in your browser console:
        // handleSuccessfulLogin('your-secret-ezra-key');
    </script>
</body>
</html>
