<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>universalezra</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon1.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon-32x321.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon-16x161.png"
    />
    <link rel="manifest" href="/site.webmanifest" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      :root {
        --primary: #8e44ad;
        --accent: #00a8ff;
        --success: #2ecc71;
        --danger: #e74c3c;
        --light: #ecf0f1;
        --dark: #1a1a2e;
        --bg-main: #16213e;
        --bg-panel: rgba(26, 26, 46, 0.9);
        --text-primary: #e0fbfc;
        --text-secondary: #98ded9;
        --border-color: rgba(0, 168, 255, 0.3);
      }
      * {
        box-sizing: border-box;
      }
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: 'Courier New', Courier, monospace;
        background-color: var(--bg-main);
        color: #00ff00;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      body::before {
        content: "Ezra A";
        position: fixed;
        bottom: 10px;
        left: 10px;
        font-size: 1.5rem;
        color: rgba(255, 255, 255, 0.1);
        z-index: 999;
        pointer-events: none;
        opacity: 0.8;
      }
      #main-viewport {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }
      #grid-container {
        width: 500vw;
        height: 500vh;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr 1fr 1fr;
        transform: translate3d(-200vw, -200vh, 0);
        transition: transform 0.7s cubic-bezier(0.86, 0, 0.07, 1);
      }
      .grid-block {
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .grid-block-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        filter: blur(3px);
        -webkit-filter: blur(3px);
        z-index: 1;
      }
      .grid-block-content {
        position: relative;
        z-index: 2;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        padding: 20px;
        width: 100%;
        height: 100%;
      }
      .grid-block-content iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 10px;
      }
      .panel {
        position: fixed;
        background: rgba(26, 26, 46, 0.7);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        z-index: 1010;
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.6);
        transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        display: flex;
        flex-direction: column;
        color: #00ff00;
      }
      .panel.active {
        transform: translate(0, 0) !important;
      }
      #editor-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateX(-100%);
      }
      #music-panel {
        bottom: 0;
        left: 0;
        width: 100%;
        height: auto;
        max-height: 50vh;
        border-top: 1px solid var(--border-color);
        transform: translateY(100%);
        padding: 15px;
      }
      #contribution-panel {
        top: 0;
        right: 0;
        width: 400px;
        max-width: 90vw;
        height: 100%;
        transform: translateX(100%);
        padding: 20px;
      }
      #live-visitors-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateY(100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #moment-vault-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateY(100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #dashboard-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateX(-100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #visualizer-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99;
        display: none;
        background-color: transparent;
      }
      .visualizer-active #visualizer-canvas {
        display: block;
        pointer-events: none;
      }
      .panel-close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: #00ff00;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 5;
      }
      .fab-container {
        position: fixed;
        z-index: 1000;
      }
      .fab, .fab-container a {
        background: rgba(142, 68, 173, 0.7);
        color: #00ff00;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.4rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        text-decoration: none;
      }
      .fab:hover, .fab-container a:hover {
        background: var(--accent);
        transform: scale(1.1);
      }
      #fab-editor {
        top: 20px;
        left: 20px;
      }
      #fab-music {
        top: 50%;
        left: 20px;
        transform: translateY(-50%);
      }
      #fab-alkitab {
        top: 20px;
        right: 20px;
      }
      #fab-contribution {
        top: calc(50% + 70px);
        left: 20px;
        transform: translateY(-50%);
      }
      #fab-visualizer {
        bottom: 20px;
        left: 50%;
        transform: translateX(-120%);
      }
      #fab-moment-vault {
        bottom: 20px;
        left: 50%;
        transform: translateX(0%);
      }
      #fab-live-visitors {
        bottom: 90px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
      }
      #fab-keyboard-toggle {
        bottom: 20px;
        right: 20px;
      }
      #fab-dashboard-toggle {
        bottom: 20px;
        left: 20px;
      }
      #live-visitors-panel .live-visitors-content,
      #moment-vault-panel .moment-vault-content,
      #dashboard-panel .dashboard-content-wrapper {
          width: 100%;
          height: 100%;
          max-width: 1200px;
          background: var(--bg-panel);
          border-radius: 15px;
          box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
          overflow: hidden;
          display: flex;
          flex-direction: column;
          padding: 20px;
      }
      #visitor-list ul {
          list-style: none;
          padding: 0;
          margin: 0;
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 15px;
      }
      #visitor-history {
        flex-grow: 1;
        overflow-y: auto;
        padding: 0 10px;
      }
      #visitor-history table {
          width: 100%;
          border-collapse: collapse;
          font-size: 0.85em;
      }
      #visitor-history th, #visitor-history td {
          border: 1px solid var(--border-color);
          padding: 8px;
          text-align: left;
      }
      #visitor-history th {
          background-color: rgba(0, 168, 255, 0.2);
          position: sticky;
          top: 0;
      }
      #moment-vault-gallery-container {
        flex-grow: 1; 
        overflow-y: auto; 
        padding-right: 10px;
      }
      #moment-vault-gallery {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
          gap: 15px;
      }
      #moment-upload-form input, #moment-upload-form textarea, #moment-upload-form button {
        margin-top: 10px;
      }
      .gallery-item {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 8px;
        position: relative;
      }
      .gallery-media {
        width: 100%;
        height: 120px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        border-radius: 5px;
        background-color: #333;
      }
      .gallery-media img, .gallery-media video, .gallery-media audio {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .gallery-media .file-icon {
        font-size: 3em;
        color: var(--text-secondary);
      }
      #video-player-widget {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999;
        width: 150px;
        height: 150px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        border: 2px solid var(--border-color);
      }
      #video-player-widget video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .social-links {
        position: fixed;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 15px;
        z-index: 999;
      }
      #website-age-display {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.8em;
        color: #00ff00;
        z-index: 10;
        background: none;
        padding: 0;
        text-align: center;
        white-space: nowrap;
      }
      .editor-toolbar {
        padding: 10px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .editor-toolbar button, .editor-toolbar select {
        background: var(--accent);
        color: var(--text-primary);
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
        font-family: 'Courier New', Courier, monospace;
      }
      .editor-toolbar button:hover, .editor-toolbar select:hover {
        background: var(--primary);
      }
      .editor-main {
        display: flex;
        flex-grow: 1;
        gap: 10px;
        padding: 10px;
      }
      .editor-code-area, .editor-preview-area {
        flex: 1;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        overflow: hidden;
      }
      #unified-code-editor {
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.3);
        color: var(--text-primary);
        border: none;
        padding: 10px;
        resize: none;
        outline: none;
      }
      #editor-preview {
        width: 100%;
        height: 100%;
        border: none;
        background: var(--light);
      }
      #video-player-widget .video-controls {
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          display: flex;
          justify-content: space-evenly;
          align-items: center;
          padding: 5px 0;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(5px);
          -webkit-backdrop-filter: blur(5px);
          transition: opacity 0.3s ease;
          opacity: 0;
      }
      #video-player-widget:hover .video-controls {
          opacity: 1;
      }
      #video-player-widget .video-controls button {
          background: none;
          border: none;
          color: white;
          font-size: 1rem;
          cursor: pointer;
          padding: 5px;
      }
      #moment-vault-panel h3 {
        padding: 10px 20px;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }
      #moment-upload-form {
        width: 100%;
        max-width: 600px;
      }
      #moment-upload-form input, #moment-upload-form textarea {
        display: block;
        width: 100%;
        margin-top: 15px;
        padding: 12px;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        border-radius: 8px;
      }
      #moment-upload-form button {
        width: 100%;
        padding: 12px;
        background: var(--accent);
        border: none;
        color: white;
        font-size: 1em;
        cursor: pointer;
        border-radius: 8px;
        transition: background 0.3s ease;
      }
      #moment-upload-form button:hover {
        background: var(--primary);
      }
      .grid-block-background video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
      }
      #block-4-3 .grid-block-background {
        -webkit-filter: none;
        -moz-filter: none;
        -ms-filter: none;
        filter: none;
      }
      #block-3-4 .grid-block-background {
        -webkit-filter: none;
        filter: none;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }
      #sabda-widget-container {
        width: 100%;
        max-width: 500px;
        height: 100%;
        max-height: 400px;
        background: rgba(0,0,0,0.3);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
      }
      #sabda-widget-container iframe {
        border-radius: 5px;
      }
      #dashboard-content {
        height: 100%;
        width: 100%;
        padding: 20px;
        text-align: left;
        color: var(--text-primary);
        overflow-y: auto;
      }
      .dashboard-card {
        background: rgba(0, 0, 0, 0.4);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        border: 1px solid var(--border-color);
      }
      .dashboard-card h4 {
        margin-top: 0;
        color: var(--accent);
      }
      .dashboard-card p {
        margin-bottom: 10px;
        font-size: 0.9em;
      }
      .progress-bar-container {
        width: 100%;
        background-color: rgba(0,0,0,0.5);
        border-radius: 5px;
        margin-top: 10px;
        position: relative;
        height: 20px;
        border: 1px solid var(--border-color);
      }
      .progress-bar {
        width: 0;
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        border-radius: 5px;
        transition: width 0.5s ease-in-out;
      }
      .progress-bar-text {
        position: absolute;
        width: 100%;
        text-align: center;
        top: 0;
        left: 0;
        line-height: 20px;
        font-size: 0.8em;
        color: white;
        text-shadow: 1px 1px 2px black;
      }
      .screenshot-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 10px;
        font-size: 1.2em;
        z-index: 9999;
        display: none;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
      }
      #new-user-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 500px;
        background: var(--bg-panel);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        z-index: 10000;
        padding: 25px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        display: none;
        text-align: center;
      }
      #new-user-popup h3 {
        margin-top: 0;
        color: var(--accent);
      }
      #new-user-popup p {
        margin-bottom: 15px;
      }
      #new-user-popup a {
        color: var(--accent);
      }
      #popup-close-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        transition: background 0.2s;
      }
      #popup-close-btn:hover {
        background: var(--accent);
      }
      #elvi-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10001;
        display: none;
        padding: 15px;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(10px);
        border-radius: 50%;
        border: 3px solid var(--accent);
        box-shadow: 0 0 40px var(--accent);
      }
      #elvi-popup img {
        width: 250px;
        height: 250px;
        border-radius: 50%;
        object-fit: cover;
      }
      #equalizer-container {
        padding: 0 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        margin-top: 10px;
        border-left: 1px solid var(--border-color);
        margin-left: 10px;
      }
      #equalizer-container p {
        margin: 0 0 5px 0;
        font-size: 0.9em;
        text-align: center;
      }
      .equalizer-bands {
        display: flex;
        gap: 8px;
        justify-content: center;
        align-items: center;
      }
      .equalizer-band {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .equalizer-band input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        writing-mode: bt-lr;
        width: 15px;
        height: 100px;
        background: rgba(0,0,0,0.3);
        border: 1px solid var(--border-color);
        border-radius: 5px;
        cursor: pointer;
      }
      .equalizer-band input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 15px;
        height: 10px;
        background: var(--accent);
        border-radius: 2px;
      }
       .equalizer-band label {
         font-size: 0.7em;
         margin-top: 5px;
       }
    </style>
  </head>
  <body>
    <div id="new-user-popup">
      <h3>Selamat Datang!</h3>
      <p>Untuk pengalaman terbaik, kami merekomendasikan:</p>
      <ul>
        <li style="text-align: left; margin-bottom: 10px;">
          Gunakan aplikasi kami untuk fitur penuh: 
          <a href="https://drive.google.com/file/d/11fQBWB9C1PjUQvb8b-IqHdNLS7YkFSFD/view?usp=drivesdk" target="_blank">Download di sini</a>
        </li>
        <li style="text-align: left; margin-bottom: 10px;">
          Putar layar Anda ke mode lanskap (landscape).
        </li>
      </ul>
      <p>
        Dengan melanjutkan, Anda setuju dengan 
        <a href="#privacy" onclick="alert('Kebijakan Privasi: Kami mengumpulkan data anonim seperti ID browser dan alamat IP untuk analisis statistik pengunjung. Data ini tidak akan dibagikan dengan pihak ketiga.');">Kebijakan Privasi</a> kami.
      </p>
      <button id="popup-close-btn">Mengerti</button>
    </div>

    <div class="screenshot-popup" id="screenshot-popup">
        Screenshot tidak diizinkan!
    </div>

    <div id="elvi-popup">
      <img src="elvi.jpg" alt="Elvi">
    </div>

    <canvas id="visualizer-canvas"></canvas>
    <audio id="matrix-sound" src="https://www.myinstants.com/media/sounds/matrix-code.mp3" preload="auto"></audio>

    <div id="main-viewport">
      <div id="grid-container">   
        <div class="grid-block" id="block-1-1">
          <div class="grid-block-content">
              <iframe src="https://www.windy.com/embed/-6.175/106.827?zoom=5&level=surface&overlay=wind" frameborder="0"></iframe>
          </div>
        </div>
        <div class="grid-block" id="block-1-2">
          <div class="grid-block-content">
              <iframe src="https://www.flightradar24.com/simple?lat=-2.5&lon=118&z=4" frameborder="0"></iframe>
          </div>
        </div>
        <div class="grid-block" id="block-1-3">
           <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=3');"></div>
           <div class="grid-block-content"><h1>Block (1,3)</h1></div>
        </div>
        <div class="grid-block" id="block-1-4">
           <div class="grid-block-content">
              <iframe src="https://earth.nullschool.net/#current/wind/surface/level/orthographic=-252.69,-5.27,1000" frameborder="0"></iframe>
          </div>
        </div>
        <div class="grid-block" id="block-1-5">
            <div class="grid-block-content">
              <iframe src="https://liveuamap.com/" frameborder="0"></iframe>
            </div>
        </div>
        <div class="grid-block" id="block-2-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=6');"></div>
          <div class="grid-block-content"><h1>Block (2,1)</h1></div>
        </div>
        <div class="grid-block" id="block-2-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=7');"></div>
          <div class="grid-block-content"><h1>Block (2,2)</h1></div>
        </div>
        <div class="grid-block" id="block-2-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=8');"></div>
          <div class="grid-block-content"><h1>Block (2,3)</h1></div>
        </div>
        <div class="grid-block" id="block-2-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=9');"></div>
          <div class="grid-block-content"><h1>Block (2,4)</h1></div>
        </div>
        <div class="grid-block" id="block-2-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=10');"></div>
          <div class="grid-block-content"><h1>Block (2,5)</h1></div>
        </div>    
        <div class="grid-block" id="block-3-1">
          <div class="grid-block-content">
              <h3 style="margin-bottom: 20px;">Peta Bintang</h3>
              <iframe src="https://stellarium-web.org/" width="80%" height="60%" frameborder="0" style="border-radius: 10px;"></iframe>
          </div>
        </div>
        <div class="grid-block" id="block-3-2">
          <div class="grid-block-content">
            <h3>Ayat Hari Ini</h3>
            <div id="sabda-widget-container">
              <iframe src="https://alkitab.sabda.org/daily/widget.php" width="100%" height="100%" frameborder="0"></iframe>
            </div>
          </div>
        </div>
        <div class="grid-block" id="block-center">
          <div class="grid-block-background" id="interactive-bg" style="background-image: url('wallpaper.png');"></div>
          <div class="grid-block-content">
              <div class="central-message">
                  <p>By <a href="secret.html" class="ezra-link">Ezra</a></p>
              </div>
          </div>
        </div>
        <div class="grid-block" id="block-3-4">
          <div class="grid-block-background" style="background-image: url('https://universalezra.netlify.app/moments/1751293320517-December 13, 2024 at 4.29 AM (1).jpg');"></div>
        </div>
        <div class="grid-block" id="block-3-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=15');"></div>
          <div class="grid-block-content"><h1>Block (3,5)</h1></div>
        </div>
        <div class="grid-block" id="block-4-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=16');"></div>
          <div class="grid-block-content"><h1>Block (4,1)</h1></div>
        </div>
        <div class="grid-block" id="block-4-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=17');"></div>
          <div class="grid-block-content"><h1>Block (4,2)</h1></div>
        </div>
        <div class="grid-block" id="block-4-3">
          <div class="grid-block-background">
              <video autoplay loop muted playsinline>
                  <source src="bg.mp4" type="video/mp4">
              </video>
          </div>
          <div class="grid-block-content"></div>
        </div>
        <div class="grid-block" id="block-4-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=19');"></div>
          <div class="grid-block-content"><h1>Block (4,4)</h1></div>
        </div>
        <div class="grid-block" id="block-4-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=20');"></div>
          <div class="grid-block-content"><h1>Block (4,5)</h1></div>
        </div>
        <div class="grid-block" id="block-5-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=21');"></div>
          <div class="grid-block-content"><h1>Block (5,1)</h1></div>
        </div>
        <div class="grid-block" id="block-5-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=22');"></div>
          <div class="grid-block-content"><h1>Block (5,2)</h1></div>
        </div>
        <div class="grid-block" id="block-5-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=23');"></div>
          <div class="grid-block-content"><h1>Block (5,3)</h1></div>
        </div>
        <div class="grid-block" id="block-5-4">
            <div class="grid-block-content">
              <iframe src="https://driveandlisten.herokuapp.com/" frameborder="0"></iframe>
            </div>
        </div>
        <div class="grid-block" id="block-5-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=25');"></div>
          <div class="grid-block-content"><h1>Block (5,5)</h1></div>
        </div>      
      </div>
    </div>  

    <div class="fab-container" id="fab-editor">
        <button class="fab" data-panel="editor-panel" title="Code Editor">
            <i class="fas fa-code"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-music">
        <button class="fab" data-panel="music-panel" title="Music Player">
            <i class="fas fa-music"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-contribution">
        <button class="fab" data-panel="contribution-panel" title="Leave a Message">
            <i class="fas fa-feather-alt"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-alkitab">
        <a
            class="fab"
            href="https://alkitab.me/in-tb/Matius/5/13"
            target="_blank"
            title="Alkitab"
            ><i class="fas fa-book"></i
        ></a>
    </div>
    <div class="fab-container" id="fab-visualizer">
        <button class="fab" data-panel="visualizer" title="Visualizer">
            <i class="fas fa-expand"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-moment-vault">
        <button class="fab" data-panel="moment-vault-panel" title="Moment Vault">
            <i class="fas fa-archive"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-live-visitors">
        <button class="fab" data-panel="live-visitors-panel" title="Live Visitors">
            <i class="fas fa-eye"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-keyboard-toggle">
        <button class="fab" title="Enter Password">
            <i class="fas fa-key"></i>
        </button>
    </div>
    <div class="fab-container" id="fab-dashboard-toggle">
        <button class="fab" data-panel="dashboard-panel" title="Target Dashboard">
            <i class="fas fa-bullseye"></i>
        </button>
    </div>

    <div id="video-player-widget">
        <video id="widget-video" loop src="video.mp4"></video>
        <div class="video-controls">
            <button id="video-play-pause"><i class="fas fa-play"></i></button>
            <button id="video-mute"><i class="fas fa-volume-up"></i></button>
        </div>
    </div>
    <div class="social-links">
        <a href="https://wa.me/6283844959380" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="https://instagram.com/zilifucek" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
    </div>
    <div id="website-age-display"></div>

    <div class="panel" id="editor-panel">
        <button class="panel-close-btn" data-panel="editor-panel"><i class="fas fa-times"></i></button>
        <div style="display: flex; align-items: flex-start;">
            <div class="editor-toolbar" style="flex-direction: column; align-items: stretch; gap: 15px; flex-wrap: nowrap;">
                <button id="editor-run"><i class="fas fa-play"></i> Run</button>
                <button id="editor-save"><i class="fas fa-save"></i> Save</button>
                <button id="editor-load"><i class="fas fa-folder-open"></i> Load</button>
                <button id="editor-new"><i class="fas fa-file"></i> New</button>
                <button id="editor-undo"><i class="fas fa-undo"></i> Undo</button>
                <button id="editor-redo"><i class="fas fa-redo"></i> Redo</button>
                 <select id="code-template-select">
                    <option value="">Select Template</option>
                    <option value="html5">HTML5 Boilerplate</option>
                    <option value="bootstrap5">Bootstrap 5 Starter</option>
                    <option value="react">React Component</option>
                </select>
            </div>
             <div id="equalizer-container">
                <p>Equalizer</p>
                <div class="equalizer-bands"></div>
            </div>
        </div>
        <div class="editor-main">
            <div class="editor-code-area">
                <textarea id="unified-code-editor" spellcheck="false"></textarea>
            </div>
            <div class="editor-preview-area">
                <iframe id="editor-preview"></iframe>
            </div>
        </div>
    </div>
    <div class="panel" id="music-panel">
        <button class="panel-close-btn" data-panel="music-panel"><i class="fas fa-times"></i></button>
        <h4>Now Playing</h4>
        <div id="music-player-content">
            <h5 id="song-title">Select a song</h5>
            <audio id="audio-player" controls loop style="width: 100%"></audio>
            <div id="playlist" style="max-height: 20vh; overflow-y: auto; margin-top: 10px"></div>
        </div>
    </div>
    <div class="panel" id="contribution-panel">
        <button class="panel-close-btn" data-panel="contribution-panel"><i class="fas fa-times"></i></button>
        <div id="contribution-content" style="display: flex; flex-direction: column; height: 100%">
            <h3 style="margin-top: 20px">Leave a Message</h3>
            <div id="contribution-display" style="flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-bottom: 15px">
                <p>Loading</p>
            </div>
            <form id="contribution-form">
                <textarea id="contribution-text" placeholder="Your message" required style="width: 100%; min-height: 80px; background: rgba(0, 0, 0, 0.2); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 5px; padding: 10px;"></textarea>
                <div style="display: flex; justify-content: flex-end; align-items: center; margin-top: 10px;">
                    <button type="submit" class="fab" style="position: static; width: 45px; height: 45px; font-size: 1.1rem">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <p id="contribution-status" style="font-size: 0.9em; text-align: center; margin-top: 10px"></p>
            </form>
        </div>
    </div>
    <div class="panel" id="live-visitors-panel">
      <button class="panel-close-btn" data-panel="live-visitors-panel"><i class="fas fa-times"></i></button>
      <div class="live-visitors-content">
          <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Live Visitors</h3>
          <div id="mv-live-visitors-list-container" style="flex-grow: 1; overflow-y: auto; padding-right: 10px">
              <p style="text-align: center; color: var(--text-secondary)">visitor</p>
              <ul id="visitor-list" style="list-style: none; padding: 0; margin: 0"></ul>
          </div>
          <h4 style="margin-top: 20px; color: var(--primary); text-align: center;">Visitor History</h4>
          <div id="visitor-history">
              <p style="text-align: center; color: var(--text-secondary);">Loading history</p>
          </div>
          <div style="margin-top: 15px; text-align: center; font-size: 0.85em; color: var(--text-secondary)">
              updated: <span id="last-updated-time">N/A</span>
          </div>
      </div>
    </div>
    <div class="panel" id="moment-vault-panel">
        <button class="panel-close-btn" data-panel="moment-vault-panel"><i class="fas fa-times"></i></button>
        <div class="moment-vault-content" style="display: flex; flex-direction: column; height: 100%;">
            <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Share your moment here</h3>
            <div id="moment-vault-gallery-container" style="flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-bottom: 15px;">
                <p style="text-align: center; color: var(--text-secondary)">Memories</p>
                <div id="moment-vault-gallery"></div>
            </div>
            <form id="moment-upload-form">
                <input type="text" id="moment-title" placeholder="Title" required />
                <textarea id="moment-description" placeholder="Describe" rows="3"></textarea>
                <input type="file" id="moment-file" accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt" required/>
                <button type="submit">Upload</button>
                <p id="moment-upload-status" style="font-size: 0.9em; text-align: center; margin-top: 10px"></p>
            </form>
        </div>
    </div>
    <div class="panel" id="dashboard-panel">
      <button class="panel-close-btn" data-panel="dashboard-panel"><i class="fas fa-times"></i></button>
      <div class="dashboard-content-wrapper">
        <div id="dashboard-content">
          <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Target Dashboard</h3>
          <div class="dashboard-card">
            <h4>噫 Proyek "Atlas"</h4>
            <p>Menciptakan mesin pencari web 3.0 yang terdesentralisasi, aman, dan tanpa iklan.</p>
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: 35%;"></div>
                <div class="progress-bar-text">35%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4>庁 Inisiatif "Project Athena"</h4>
            <p>Pengembangan sistem AI personal yang dapat mempersonalisasi konten secara on-device.</p>
             <div class="progress-bar-container">
                <div class="progress-bar" style="width: 15%;"></div>
                <div class="progress-bar-text">15%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4>験 Misi "Gaia"</h4>
            <p>Membangun platform edukasi interaktif untuk anak-anak, berfokus pada STEM dan kreativitas.</p>
             <div class="progress-bar-container">
                <div class="progress-bar" style="width: 60%;"></div>
                <div class="progress-bar-text">60%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4>迫 Integrasi "Omni-Connect"</h4>
            <p>Menghubungkan semua aplikasi web pribadi ke dalam satu ekosistem yang kohesif.</p>
             <div class="progress-bar-container">
                <div class="progress-bar" style="width: 80%;"></div>
                <div class="progress-bar-text">80%</div>
            </div>
          </div>
          <div class="dashboard-card">
            <h4>Riset Kuantum</h4>
            <p>Memulai penelitian awal pada algoritma komputasi kuantum untuk enkripsi masa depan.</p>
             <div class="progress-bar-container">
                <div class="progress-bar" style="width: 5%;"></div>
                <div class="progress-bar-text">5%</div>
            </div>
          </div>
        </div>
      </div>
    </div>
   
    <script>
      // --- KONFIGURASI UTAMA ---
      const PRIMARY_WORKER_URL = 'https://YOUR-WORKER-NAME.YOUR-WORKER-SUBDOMAIN.workers.dev/'; // Ganti dengan URL Worker Anda

      // Konfigurasi untuk Moment Vault (tetap terpisah sesuai permintaan)
      const MOMENT_VAULT_WORKER_URL = 'https://moment-vault-worker-url.universalezra.workers.dev';
      const GITHUB_REPO_OWNER = 'universalezra';
      const GITHUB_REPO_NAME = 'universalezra';
      const GITHUB_TOKEN_WORKER_URL = 'https://github-token-worker-url.universalezra.workers.dev';

      // --- Variabel Global ---
      let liveVisitorRefreshInterval;
      let gridContainer, currentX = 2, currentY = 2;
      let isDragging = false, startX = 0, startY = 0;
      const SWIPE_THRESHOLD = 50;
      
      // Visualizer
      let isVisualizerActive = false;
      let visualizerCanvas, ctx, audioContext, analyser, source;
      let particles = [], bassThreshold = 140, lastBassLevel = 0;
      let bufferLength, frequencyData;
      const PARTICLE_COUNT = 150;
      const PARTICLE_SPEED_MULTIPLIER = 0.4;
      
      // Equalizer
      let equalizerFilters = [];

      // --- EVENT LISTENER UTAMA ---
      document.addEventListener('DOMContentLoaded', () => {
        gridContainer = document.getElementById('grid-container');
        initPanelControls();
        initPasswordPrompt();
        initVideoPlayer();
        initEditor();
        initMusicPlayer();
        initWebsiteAgeDisplay();
        trackVisitor();
        initVisualizer();
        initSwipeGestures();
        initSecurityFeatures();
        checkFirstVisit();
      });

      // --- FUNGSI INISIALISASI ---

      function initSwipeGestures() {
        const matrixSound = document.getElementById('matrix-sound');
        const moveGrid = (x, y) => {
            const oldX = currentX;
            const oldY = currentY;
            currentX = Math.min(4, Math.max(0, currentX + x));
            currentY = Math.min(4, Math.max(0, currentY + y));

            // DETEKSI PERUBAHAN POSISI GRID UNTUK SUARA
            if (oldX !== currentX || oldY !== currentY) {
              gridContainer.style.transform = `translate3d(-${currentX * 100}vw, -${currentY * 100}vh, 0)`;
              matrixSound.currentTime = 0;
              matrixSound.play().catch(e => console.error("Audio play failed:", e));
            }
        };
        const handleStart = (e) => {
            isDragging = true;
            startX = e.clientX || e.touches[0].clientX;
            startY = e.clientY || e.touches[0].clientY;
        };
        const handleEnd = (e) => {
            if (!isDragging) return;
            const endX = e.clientX || e.changedTouches[0].clientX;
            const endY = e.clientY || e.changedTouches[0].clientY;
            const dx = endX - startX;
            const dy = endY - startY;
            isDragging = false;
            if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > SWIPE_THRESHOLD) {
                moveGrid(dx > 0 ? -1 : 1, 0);
            } else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > SWIPE_THRESHOLD) {
                moveGrid(0, dy > 0 ? -1 : 1);
            }
        };
        document.addEventListener('mousedown', handleStart);
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchstart', handleStart);
        document.addEventListener('touchend', handleEnd);
      }

      function initPanelControls() {
        document.querySelectorAll('[data-panel]').forEach((button) => {
          button.addEventListener('click', (event) => {
            const panelId = button.getAttribute('data-panel');
            if (panelId === 'visualizer') {
              toggleVisualizerOverlay();
              return;
            }
            
            const panel = document.getElementById(panelId);
            panel.classList.toggle('active');

            if (panelId === 'contribution-panel' && panel.classList.contains('active')) fetchContributions();
            if (panelId === 'moment-vault-panel' && panel.classList.contains('active')) fetchMomentVaultGallery();
            if (panelId === 'live-visitors-panel' && !panel.classList.contains('active')) clearInterval(liveVisitorRefreshInterval);
          });
        });

        document.querySelectorAll('.panel-close-btn').forEach((button) => {
          button.addEventListener('click', () => {
            const panelId = button.getAttribute('data-panel');
            document.getElementById(panelId).classList.remove('active');
            if (panelId === 'live-visitors-panel') clearInterval(liveVisitorRefreshInterval);
          });
        });
      }
      
      function initPasswordPrompt() {
          const fabKeyboard = document.getElementById('fab-keyboard-toggle');
          fabKeyboard.addEventListener('click', async () => {
              const password = prompt('Enter password to unlock feature:');
              if (!password) return;

              // Fitur Elvi (client-side)
              if (password.toLowerCase() === 'elvi') {
                  const popup = document.getElementById('elvi-popup');
                  popup.style.display = 'block';
                  setTimeout(() => { popup.style.display = 'none'; }, 4000);
                  return;
              }

              // Fitur Live Visitor (Contoh Autentikasi Backend)
              try {
                  const response = await fetch(PRIMARY_WORKER_URL + '?action=login', {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({ password: password })
                  });
                  const result = await response.json();

                  if (result.success && result.feature === 'live-visitors') {
                      const panel = document.getElementById('live-visitors-panel');
                      panel.classList.add('active');
                      fetchLiveVisitors();
                      fetchVisitorHistory();
                      liveVisitorRefreshInterval = setInterval(fetchLiveVisitors, 5000);
                      document.getElementById('fab-live-visitors').style.display = 'flex';
                  } else {
                      alert(result.message || 'Incorrect password!');
                  }
              } catch (error) {
                  console.error('Login error:', error);
                  alert('Failed to contact server for authentication.');
              }
          });
      }

      function initVideoPlayer() {
        const video = document.getElementById('widget-video');
        const playBtn = document.getElementById('video-play-pause');
        const muteBtn = document.getElementById('video-mute');
        playBtn.addEventListener('click', () => {
          if (video.paused) {
            video.play();
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
          } else {
            video.pause();
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
          }
        });
        muteBtn.addEventListener('click', () => {
          video.muted = !video.muted;
          muteBtn.innerHTML = video.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
        });
      }

      function initMusicPlayer() {
        const player = document.getElementById('audio-player');
        const playlistEl = document.getElementById('playlist');
        const songTitleEl = document.getElementById('song-title');
        const songs = [
          { name: 'On And On', url: 'On-And-On.mp3' },
          { name: 'Where We Are', url: 'Where-We-Are.mp3' },
          { name: 'Sekuat Hatimu', url: 'Sekuat Hatimu.mp3' },
        ];
        songs.forEach((song) => {
          const item = document.createElement('div');
          item.textContent = song.name;
          item.style.cursor = 'pointer';
          item.style.padding = '8px';
          item.onclick = () => {
            player.src = song.url;
            songTitleEl.textContent = song.name;
            player.play();
            if (!audioContext) setupAudioAPI(); // Setup Audio API saat lagu pertama kali diputar
          };
          playlistEl.appendChild(item);
        });
      }

      function initEditor() {
        const codeEditor = document.getElementById('unified-code-editor');
        const previewFrame = document.getElementById('editor-preview');
        const templateSelect = document.getElementById('code-template-select');
        let history = [''];
        let historyPointer = 0;

        const templates = {
          html5: `<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Document</title>\n  <style>\n    body { font-family: sans-serif; background: #f0f0f0; }\n  </style>\n</head>\n<body>\n\n  <h1>Hello, World!</h1>\n\n  <script>\n  <\/script>\n</body>\n</html>`,
          bootstrap5: `<!doctype html>\n<html lang="en">\n  <head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <title>Bootstrap demo</title>\n    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">\n  </head>\n  <body>\n    <div class="container">\n      <h1>Hello, Bootstrap!</h1>\n    </div>\n    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"><\/script>\n  </body>\n</html>`,
          react: `import React, { useState } from 'react';\n\nfunction MyComponent() {\n  const [count, setCount] = useState(0);\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n\nexport default MyComponent;`
        };

        templateSelect.addEventListener('change', () => {
            if (templateSelect.value && templates[templateSelect.value]) {
                codeEditor.value = templates[templateSelect.value];
                runCode();
            }
        });

        const runCode = () => {
             const source = codeEditor.value;
             previewFrame.srcdoc = source;
        };
        const saveCode = () => localStorage.setItem('unified_editor_code', codeEditor.value);
        const loadCode = () => {
            codeEditor.value = localStorage.getItem('unified_editor_code') || templates.html5;
            runCode();
        };
        document.getElementById('editor-run').addEventListener('click', runCode);
        document.getElementById('editor-save').addEventListener('click', saveCode);
        document.getElementById('editor-load').addEventListener('click', loadCode);
        document.getElementById('editor-new').addEventListener('click', () => { codeEditor.value = templates.html5; runCode(); });
        loadCode();
      }

      function initWebsiteAgeDisplay() {
        const display = document.getElementById('website-age-display');
        const creationDate = new Date(2006, 7, 7);
        setInterval(() => {
          const now = new Date();
          const diff = now - creationDate;
          const years = diff / (1000 * 60 * 60 * 24 * 365.25);
          display.textContent = `${years.toFixed(9)} tahun`;
        }, 100);
      }
      
      function initSecurityFeatures() {
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        window.addEventListener('keyup', (e) => {
            if (e.key === 'PrintScreen') {
                const popup = document.getElementById('screenshot-popup');
                popup.style.display = 'block';
                setTimeout(() => { popup.style.display = 'none'; }, 3000);
            }
        });
      }

      function checkFirstVisit() {
        if (!localStorage.getItem('hasVisitedWebsite')) {
            const popup = document.getElementById('new-user-popup');
            popup.style.display = 'block';
            document.getElementById('popup-close-btn').onclick = () => {
                popup.style.display = 'none';
                localStorage.setItem('hasVisitedWebsite', 'true');
            };
        }
      }

      // --- BACKEND & DATA HANDLING ---

      async function fetchContributions() {
        const display = document.getElementById('contribution-display');
        display.innerHTML = `<p>Loading...</p>`;
        try {
          const response = await fetch(PRIMARY_WORKER_URL + '?action=get_contributions');
          const contributions = await response.json();
          if (contributions && contributions.length > 0) {
            display.innerHTML = contributions.reverse().map(c => 
                `<div style="background:rgba(0,0,0,0.2);padding:10px;border-radius:5px;margin-bottom:10px;">
                   <p style="margin:0;">${c.text}</p>
                   <small style="color:var(--text-secondary);">${new Date(c.timestamp).toLocaleString()}</small>
                 </div>`
            ).join('');
          } else {
            display.innerHTML = `<p>Be the first to leave a message.</p>`;
          }
        } catch (e) {
          display.innerHTML = `<p style="color:var(--danger);">Could not load contributions.</p>`;
        }
      }

      document.getElementById('contribution-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const statusEl = document.getElementById('contribution-status');
          statusEl.textContent = 'Sending...';
          try {
            const response = await fetch(PRIMARY_WORKER_URL + '?action=add_contribution', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text: document.getElementById('contribution-text').value }),
            });
            if (!response.ok) throw new Error('Upload failed');
            statusEl.textContent = 'Message sent. Thank you.';
            e.target.reset();
            fetchContributions();
          } catch (err) {
            statusEl.textContent = `Error: ${err.message}`;
          }
      });
      
      async function fetchLiveVisitors() {
        const visitorList = document.getElementById('visitor-list');
        try {
          const response = await fetch(PRIMARY_WORKER_URL + '?action=get_visitors');
          const visitors = await response.json();
          if (visitors && visitors.length > 0) {
            visitorList.innerHTML = visitors.map(v => `<li><strong>ID:</strong> ${v.browserId.substring(0,10)}<br><strong>IP:</strong> ${v.ip}</li>`).join('');
          } else {
            visitorList.innerHTML = `<li style="text-align: center;">No online visitors.</li>`;
          }
          document.getElementById('last-updated-time').textContent = new Date().toLocaleTimeString();
        } catch (error) {
          visitorList.innerHTML = `<li style="text-align: center;">Failed to load.</li>`;
        }
      }

      async function fetchVisitorHistory() {
        const historyContainer = document.getElementById('visitor-history');
        historyContainer.innerHTML = `<p>Loading history...</p>`;
        try {
            const response = await fetch(PRIMARY_WORKER_URL + '?action=get_history');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            let history = await response.json();
            
            if (history && history.length > 0) {
                const visitCounts = history.reduce((acc, visitor) => {
                    acc[visitor.browserId] = (acc[visitor.browserId] || 0) + 1;
                    return acc;
                }, {});

                const tableHeader = `<table><thead><tr><th>Timestamp</th><th>Browser ID</th><th>IP</th><th>Referral</th><th>Total Visits</th></tr></thead><tbody>`;
                const tableRows = history
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(visitor => `
                        <tr>
                            <td>${new Date(visitor.timestamp).toLocaleString('id-ID')}</td>
                            <td>${visitor.browserId.substring(0, 10)}...</td>
                            <td>${visitor.ip || 'N/A'}</td>
                            <td>${visitor.referrer || 'Direct'}</td>
                            <td>${visitCounts[visitor.browserId] || 1}</td>
                        </tr>
                    `).join('');
                historyContainer.innerHTML = tableHeader + tableRows + `</tbody></table>`;
            } else {
                historyContainer.innerHTML = `<p>No visitor history yet.</p>`;
            }
        } catch (error) {
            console.error('Failed to load visitor history:', error);
            historyContainer.innerHTML = `<p style="color:var(--danger);">Failed to load history.</p>`;
        }
      }

      function getBrowserId() {
        let id = localStorage.getItem('unique_browser_id');
        if (!id) {
          id = 'browser_' + Date.now() + Math.random().toString(36).substr(2, 9);
          localStorage.setItem('unique_browser_id', id);
        }
        return id;
      }

      async function trackVisitor() {
        try {
          let ipAddress = 'unknown';
          try {
              const ipResponse = await fetch('https://api.ipify.org?format=json');
              const ipData = await ipResponse.json();
              ipAddress = ipData.ip;
          } catch(e){ console.warn("Could not fetch IP."); }
          
          const data = {
            browserId: getBrowserId(),
            ip: ipAddress,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            referrer: document.referrer || 'direct',
          };        
          
          fetch(PRIMARY_WORKER_URL + '?action=track_visitor', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          }).catch((e) => console.error('Error tracking visitor:', e));
        } catch (e) {
          console.error('Error in trackVisitor:', e);
        }
      }
      
      // --- MOMENT VAULT (Tetap menggunakan worker terpisah) ---
      // Fungsi fetchMomentVaultGallery, uploadMoment, editMoment, deleteMoment tetap sama seperti di file asli.
      // Anda bisa salin-tempel fungsi-fungsi tersebut ke bagian ini.
      
      // --- AUDIO VISUALIZER & EQUALIZER ---
      
      function initVisualizer() {
        visualizerCanvas = document.getElementById('visualizer-canvas');
        ctx = visualizerCanvas.getContext('2d');
        window.addEventListener('resize', () => {
            visualizerCanvas.width = window.innerWidth;
            visualizerCanvas.height = window.innerHeight;
        });
      }

      function setupAudioAPI() {
        const audioPlayer = document.getElementById('audio-player');
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            source = audioContext.createMediaElementSource(audioPlayer);
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 2048;
            bufferLength = analyser.frequencyBinCount;
            frequencyData = new Uint8Array(bufferLength);

            // Setup Equalizer
            const frequencies = [60, 170, 310, 600, 1000, 3000, 6000, 12000, 14000, 16000];
            let lastNode = source;

            frequencies.forEach(freq => {
                const filter = audioContext.createBiquadFilter();
                filter.type = 'peaking';
                filter.frequency.value = freq;
                filter.Q.value = 1;
                filter.gain.value = 0;
                lastNode.connect(filter);
                lastNode = filter;
                equalizerFilters.push(filter);
            });
            lastNode.connect(analyser);
            analyser.connect(audioContext.destination);
            
            createEqualizerUI(frequencies);
        }
        return true;
      }
      
      function createEqualizerUI(frequencies) {
          const container = document.querySelector('.equalizer-bands');
          container.innerHTML = '';
          frequencies.forEach((freq, i) => {
              const band = document.createElement('div');
              band.className = 'equalizer-band';
              const slider = document.createElement('input');
              slider.type = 'range';
              slider.min = -20;
              slider.max = 20;
              slider.value = 0;
              slider.step = 1;
              slider.oninput = (e) => {
                  equalizerFilters[i].gain.value = e.target.value;
              };
              const label = document.createElement('label');
              label.textContent = (freq >= 1000 ? (freq / 1000) + 'k' : freq);
              band.appendChild(slider);
              band.appendChild(label);
              container.appendChild(band);
          });
      }
      
      function createParticles() {
        particles = [];
        for (let i = 0; i < PARTICLE_COUNT; i++) {
          particles.push({
            x: Math.random() * visualizerCanvas.width,
            y: Math.random() * visualizerCanvas.height,
            size: Math.random() * 2 + 1,
            speedX: (Math.random() - 0.5) * PARTICLE_SPEED_MULTIPLIER,
            speedY: (Math.random() - 0.5) * PARTICLE_SPEED_MULTIPLIER,
            color: `hsl(${Math.random() * 360}, 100%, 50%)`
          });
        }
      }

      function drawVisualizer() {
        if (!isVisualizerActive) return;
        requestAnimationFrame(drawVisualizer);
        analyser.getByteFrequencyData(frequencyData);
        ctx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
        
        // --- GAMBAR VISUALIZER GAYA BARIS ---
        drawVisualizerBars();
        
        // --- GAMBAR VISUALIZER GAYA PARTIKEL ---
        // Deteksi Bass
        const bassLevel = frequencyData[1] + frequencyData[2]; // Sample low frequencies
        if (bassLevel > bassThreshold && lastBassLevel <= bassThreshold) {
            // Bass Hit
            particles.forEach(p => {
                p.color = `hsl(${Math.random() * 360}, 100%, 70%)`;
            });
        }
        lastBassLevel = bassLevel;
        
        const avgAmplitude = frequencyData.reduce((a, b) => a + b) / bufferLength;
        const speedFactor = (avgAmplitude / 128) * 2;

        for (const p of particles) {
            p.x += p.speedX * speedFactor;
            p.y += p.speedY * speedFactor;

            if (p.x > visualizerCanvas.width) p.x = 0;
            else if (p.x < 0) p.x = visualizerCanvas.width;
            if (p.y > visualizerCanvas.height) p.y = 0;
            else if (p.y < 0) p.y = visualizerCanvas.height;

            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
        }
      }

      function drawVisualizerBars() {
        const centerX = visualizerCanvas.width / 2;
        const centerY = visualizerCanvas.height / 2;
        const barWidth = (visualizerCanvas.width / bufferLength) * 2.5;
        let x = 0;

        for (let i = 0; i < bufferLength; i++) {
            const barHeight = frequencyData[i] * 1.5;
            const hue = i * 2;
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
            
            // Draw bars from center outwards
            ctx.fillRect(centerX - x, centerY - barHeight / 2, barWidth, barHeight);
            ctx.fillRect(centerX + x - barWidth, centerY - barHeight / 2, barWidth, barHeight);
            
            x += barWidth + 1;
        }
      }

      function toggleVisualizerOverlay() {
        if (!isVisualizerActive) {
          if (!audioContext) {
              const player = document.getElementById('audio-player');
              if (!player.src) {
                  alert('Please select a song first!');
                  return;
              }
              setupAudioAPI();
          }
          isVisualizerActive = true;
          document.body.classList.add('visualizer-active');
          visualizerCanvas.width = window.innerWidth;
          visualizerCanvas.height = window.innerHeight;
          createParticles();
          drawVisualizer();
          document.documentElement.requestFullscreen().catch(err => console.log(err));
        } else {
          isVisualizerActive = false;
          document.body.classList.remove('visualizer-active');
          if(document.fullscreenElement) document.exitFullscreen();
        }
      }

    </script>
  </body>
</html>
