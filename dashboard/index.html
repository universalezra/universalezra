<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ezra's Personal Site</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* --- General Variables & Base Styles (Adapted from elvi.css & enhanced for themes) --- */
        :root {
            --primary: #00ff88; /* From elvi.css */
            --primary-dark: #00cc6a; /* From elvi.css */
            --accent: #00a8ff; /* Original, kept for specific highlights */
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #ffcc00; /* From elvi.css */
            --dark: #0a0a12; /* From elvi.css */
            --darker: #050508; /* From elvi.css */

            /* Dark Theme Specific */
            --bg-main: radial-gradient(circle at center, #0a0a20, #000000); /* From elvi.css */
            --bg-panel: rgba(10, 10, 18, 0.8); /* Adapted from elvi.css login-form background */
            --text-primary: #e0e0e0; /* From elvi.css */
            --text-secondary: #a0a0a0; /* From elvi.css */
            --border-color: rgba(0, 255, 136, 0.2); /* Adapted from elvi.css login-form border */
            --input-bg: rgba(0, 0, 0, 0.5); /* From elvi.css form-group input */
            --button-hover-bg: rgba(0, 255, 136, 0.1); /* Adapted from elvi.css auth-btn:hover */

            --border-radius: 8px; /* From elvi.css */
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* From elvi.css */
            --transition: all .3s ease; /* From elvi.css */
            --header-height: 60px;
        }

        [data-theme="light"] {
            --bg-main: #f0f2f5; /* Lighter background for theme difference */
            --bg-panel: rgba(255, 255, 255, 0.95); /* White panel background */
            --text-primary: #34495e; /* Darker text */
            --text-secondary: #7f8c8d; /* Muted text */
            --border-color: #bdc3c7; /* Light border */
            --input-bg: rgba(255, 255, 255, 0.7); /* Lighter input background */
            --button-hover-bg: rgba(0, 0, 0, 0.05); /* Subtle hover for light theme */
            --primary: #3498db; /* A different primary for light theme */
            --primary-dark: #2980b9; /* A different primary-dark for light theme */
            --accent: #e67e22; /* Different accent */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            /* This is the key change: force horizontal width and enable scrolling */
            min-width: 1200px; /* Minimum width for the entire page to mimic desktop */
            overflow-x: auto; /* Allow horizontal scrolling */
            height: 100%;
        }

        body {
            background: var(--bg-main);
            color: var(--text-primary);
            font-family: 'Courier New', Courier, monospace; /* From elvi.css */
            line-height: 1.6; /* From elvi.css */
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100vh; /* Ensure body takes full height */
            /* Do NOT set overflow-x: hidden here, it would prevent scrolling */
        }

        button {
            cursor: pointer;
            padding: .75rem 1.5rem; /* From elvi.css auth-btn */
            border: 1px solid var(--primary); /* From elvi.css auth-btn */
            border-radius: var(--border-radius); /* From elvi.css */
            background: rgba(0, 0, 0, 0.3); /* From elvi.css auth-btn */
            color: var(--primary); /* From elvi.css auth-btn */
            font-family: inherit; /* From elvi.css auth-btn */
            font-size: .9rem; /* From elvi.css auth-btn */
            transition: var(--transition); /* From elvi.css */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .5rem; /* From elvi.css auth-btn */
        }

        button:hover:not(:disabled) {
            background: var(--button-hover-bg); /* Adapted for general buttons */
            box-shadow: 0 0 10px var(--primary); /* From elvi.css auth-btn:hover */
            transform: translateY(-2px); /* From elvi.css auth-btn:hover */
        }

        button:disabled {
            opacity: .5; /* From elvi.css auth-btn:disabled */
            cursor: not-allowed; /* From elvi.css auth-btn:disabled */
            border-color: var(--text-secondary); /* From elvi.css auth-btn:disabled */
        }

        /* Primary button style */
        button.primary-btn { /* Custom class for primary style */
            background: var(--primary); /* From elvi.css auth-btn.primary */
            color: var(--dark); /* From elvi.css auth-btn.primary */
            font-weight: bold;
        }

        button.primary-btn:hover:not(:disabled) {
            background: var(--primary-dark); /* From elvi.css auth-btn.primary:hover */
            box-shadow: 0 0 15px var(--primary); /* From elvi.css auth-btn.primary:hover */
            animation: buttonPulse 1s infinite; /* From elvi.css auth-btn.primary:hover */
        }

        @keyframes buttonPulse { /* From elvi.css */
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
        }

        input, textarea {
            padding: .75rem 1rem; /* From elvi.css form-group input */
            background: var(--input-bg); /* From elvi.css form-group input */
            border: 1px solid var(--border-color); /* From elvi.css form-group input */
            border-radius: var(--border-radius); /* From elvi.css */
            color: var(--text-primary);
            width: 100%;
            margin-bottom: 10px;
            resize: vertical;
            font-family: inherit; /* From elvi.css form-group input */
            transition: var(--transition); /* From elvi.css */
        }

        input:focus, textarea:focus {
            outline: none; /* From elvi.css form-group input:focus */
            border-color: var(--primary); /* From elvi.css form-group input:focus */
            box-shadow: 0 0 10px var(--primary); /* From elvi.css form-group input:focus */
        }

        a {
            color: var(--accent);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* --- Header --- */
        header {
            width: 100%;
            height: var(--header-height);
            background-color: var(--bg-panel); /* Use panel background for header */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: var(--box-shadow); /* From elvi.css */
            z-index: 1000;
        }

        header .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary);
        }

        header .header-controls {
            display: flex;
            gap: 15px;
        }

        header .header-controls button {
            background: none;
            border: 1px solid var(--border-color); /* Use general border color */
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: var(--border-radius); /* From elvi.css */
            transition: var(--transition);
        }

        header .header-controls button:hover {
            background-color: var(--button-hover-bg);
            border-color: var(--primary); /* Use primary for hover border */
        }

        /* --- Main Content Area (Layout: Header + Wide Content) --- */
        .main-content {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            overflow-y: auto; /* Allow vertical scrolling within content area */
            width: 100%;
            /* min-width and max-width removed from here to allow html min-width to take effect */
        }

        .main-content-wrapper {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* More horizontal columns, flexible */
            gap: 20px;
            width: 100%; /* Ensure it fills the available width from the html min-width */
        }

        /* --- Panel Styles (Re-used for general panels) --- */
        .panel {
            background-color: var(--bg-panel);
            border-radius: var(--border-radius); /* From elvi.css */
            box-shadow: var(--box-shadow); /* From elvi.css */
            padding: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--border-color);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: fadeIn .5s ease; /* From elvi.css */
        }
        .panel.hidden {
            display: none;
        }

        @keyframes fadeIn { /* From elvi.css */
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .panel-header h3 {
            color: var(--primary);
            font-size: 1.4em;
        }

        .panel .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2em;
            cursor: pointer;
            transition: var(--transition);
        }

        .panel .close-btn:hover {
            color: var(--danger);
        }

        /* --- Specific Panel Overrides --- */
        #code-editor-panel {
            min-height: 400px;
        }
        #code-editor-panel textarea {
            flex-grow: 1;
            font-family: 'Fira Code', 'Cascadia Code', monospace;
            font-size: 0.9em;
            white-space: pre;
            word-wrap: normal;
            overflow: auto;
        }
        #code-preview {
            width: 100%;
            height: 200px;
            border: 1px solid var(--border-color);
            background-color: var(--darker); /* Darker background for code preview in dark theme */
            border-radius: var(--border-radius);
            margin-top: 10px;
        }
        [data-theme="light"] #code-preview {
            background-color: var(--light); /* Use light for preview in light theme */
        }


        #music-player-panel .audio-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        #music-player-panel audio {
            width: 100%;
            margin-top: 15px;
        }
        #playlist-items {
            list-style: none;
            margin-top: 10px;
            padding: 0;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }
        #playlist-items li {
            padding: 8px 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #playlist-items li.active {
            background-color: var(--primary);
            color: var(--dark); /* Text color from elvi.css for active primary buttons */
            font-weight: bold;
        }
        #playlist-items li:hover {
            background-color: var(--button-hover-bg);
        }

        #contribute-panel form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #contribute-panel textarea {
            min-height: 80px;
        }
        #contribute-panel button {
            align-self: flex-end;
            margin-top: 10px;
        }
        #contribute-message {
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Live Visitors Panel */
        #live-visitors-panel {
            min-height: 300px;
            /* display: none; Handled by JS based on Ezra login */
        }
        #live-visitors-panel ul {
            list-style: none;
            padding: 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }
        #live-visitors-panel ul li {
            padding: 8px 10px;
            border-bottom: 1px dashed var(--border-color);
            font-size: 0.9em;
        }
        #live-visitors-panel ul li:last-child {
            border-bottom: none;
        }
        #live-visitors-panel .refresh-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        /* --- Floating Action Buttons (FABs) --- */
        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }

        .fab {
            background: rgba(0,0,0,.3); /* From elvi.css auth-btn */
            border: 1px solid var(--primary); /* From elvi.css auth-btn */
            color: var(--primary); /* From elvi.css auth-btn */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            box-shadow: var(--box-shadow); /* From elvi.css */
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
        }

        .fab:hover {
            background-color: var(--button-hover-bg);
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--primary); /* From elvi.css auth-btn:hover */
        }

        /* --- Social Links (Fixed position) --- */
        .social-links {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 15px;
            z-index: 999;
        }

        .social-links a {
            color: var(--text-primary);
            font-size: 1.8em;
            transition: var(--transition);
        }

        .social-links a:hover {
            color: var(--primary);
            transform: scale(1.1);
        }

        /* --- Private User Panel (for initial login) --- */
        #private-user-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            padding: 30px;
            z-index: 1001;
            text-align: center;
            background: rgba(10,10,18,.95); /* Slightly less transparent */
            border: 1px solid rgba(0,255,136,.2); /* From elvi.css login-form border */
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        #private-user-panel h3 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        #private-user-panel input {
            margin-bottom: 15px;
            text-align: center;
        }
        #private-user-panel button {
            width: 100%;
        }

        /* --- Ezra Panel (Full-Screen, Editable Gallery) --- */
        #ezra-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.98);
            z-index: 1002;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            visibility: hidden;
            opacity: 0;
        }
        #ezra-panel.active {
            visibility: visible;
            opacity: 1;
        }

        #ezra-panel .panel-header {
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        #ezra-panel .panel-header h3 {
            flex-grow: 1;
            text-align: center;
            color: var(--primary); /* Changed to primary from accent */
            font-size: 2em;
        }
        #ezra-panel .logout-btn {
            background-color: var(--danger);
            color: var(--text-primary); /* Ensure it's light text on danger background */
            border-color: var(--danger);
        }
        #ezra-panel .logout-btn:hover {
            background-color: #c0392b;
            box-shadow: 0 0 15px var(--danger);
        }

        #ezra-gallery-container {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px;
            background-color: rgba(10, 10, 18, 0.8); /* Adapted from elvi.css dark */
            border-radius: var(--border-radius);
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .gallery-item {
            background-color: var(--bg-panel);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
        }

        .gallery-item img, .gallery-item video {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .gallery-item-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .gallery-item-info h4 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 1.2em;
        }

        .gallery-item-info p {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            flex-grow: 1;
        }

        .gallery-item-info small {
            font-size: 0.8em;
            color: var(--text-secondary);
            text-align: right;
        }

        .gallery-item-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            padding: 5px;
        }

        .gallery-item-controls button {
            background: none;
            border: none;
            color: var(--text-primary); /* Changed to text-primary for controls */
            font-size: 1em;
            padding: 5px;
        }

        .gallery-item-controls button:hover {
            color: var(--accent); /* Kept accent for specific icon hover */
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* --- Ezra Content Editor Form --- */
        #ezra-content-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: var(--bg-panel);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }
        #ezra-content-form h4 {
            color: var(--primary); /* Changed to primary */
            margin-bottom: 10px;
        }
        #ezra-content-form .form-row {
            display: flex;
            gap: 10px;
        }
        #ezra-content-form .form-row input, #ezra-content-form .form-row textarea {
            flex-grow: 1;
        }
        #ezra-content-form button {
            align-self: flex-end;
            margin-top: 10px;
        }
        .message-status {
            color: var(--text-primary);
            text-align: center;
            margin-top: 10px;
        }
        /* Styling for Website Age Feature */
.website-age-container {
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 15px 20px;
    margin-top: 20px; /* Adjust as needed */
    text-align: center;
    color: var(--text-primary);
    font-size: 0.9em;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    width: fit-content; /* Adjust width as needed */
    margin-left: auto;
    margin-right: auto;
}

.website-age-container p:first-child {
    color: var(--text-secondary);
}

#website-age {
    font-weight: bold;
    color: var(--primary); /* Highlight the age in primary color */
    font-size: 1.1em;
}
    </style>
</head>
<body>
    <header>
        <div class="logo">Ezra's DevLog</div>
        <div class="header-controls">
            <button id="theme-toggle">
                <i class="fas fa-sun"></i> / <i class="fas fa-moon"></i>
            </button>
            <button id="show-code-editor">Code Editor</button>
            <button id="show-music-player">Music Player</button>
            <button id="show-contribute">Contribute</button>
            <button id="show-live-visitors" class="hidden">Live Visitors</button>
            <button id="show-private-user"><i class="fas fa-user-secret"></i></button>
        </div>
    </header>

    <main class="main-content">
        <div class="main-content-wrapper">
            <div id="code-editor-panel" class="panel">
                <div class="panel-header">
                    <h3>Code Editor</h3>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>
                <textarea id="unified-editor" spellcheck="false" placeholder="Tulis HTML, CSS, dan JavaScript Anda di sini..."></textarea>
                <button id="run-code" class="primary-btn">Run Code</button>
                <h4>Preview:</h4>
                <iframe id="code-preview" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
            </div>

            <div id="music-player-panel" class="panel">
                <div class="panel-header">
                    <h3>Music Player</h3>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>
                <audio id="music-audio" controls></audio>
                <div class="audio-controls">
                    <button id="play-pause-btn"><i class="fas fa-play"></i></button>
                    <button id="prev-btn"><i class="fas fa-backward"></i></button>
                    <button id="next-btn"><i class="fas fa-forward"></i></button>
                    <button id="shuffle-btn"><i class="fas fa-random"></i></button>
                    <button id="repeat-btn"><i class="fas fa-redo"></i></button>
                </div>
                <h4>Playlist:</h4>
                <ul id="playlist-items">
                    </ul>
            </div>

            <div id="contribute-panel" class="panel">
                <div class="panel-header">
                    <h3>Kontribusi Pesan</h3>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>
                <form id="contribute-form">
                    <input type="text" id="contributor-name" placeholder="Nama Anda (opsional)">
                    <textarea id="contribute-text" placeholder="Tulis pesan Anda di sini..." required></textarea>
                    <button type="submit" class="primary-btn">Kirim Pesan</button>
                </form>
                <p id="contribute-message"></p>
            </div>

            <div id="live-visitors-panel" class="panel hidden">
                <div class="panel-header">
                    <h3>Live Visitors</h3>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                </div>
                <ul id="visitor-list">
                    <li>Loading visitors...</li>
                </ul>
                <div class="refresh-info">
                    <small>Last updated: <span id="last-updated-time">N/A</span></small>
                    <button id="refresh-visitors-btn">Refresh</button>
                </div>
                <p style="text-align: center; font-size: 0.8em; color: var(--text-secondary); margin-top: 10px;">
                    *Fitur ini hanya terlihat ketika Anda login sebagai Ezra.
                </p>
            </div>
        </div>
    </main>
    <div class="website-age-container">
    <p>Website Age:</p>
    <p id="website-age">loading</p>
    </div>

    <div class="fab-container">
        <button class="fab" id="fab-theme-toggle" aria-label="Toggle Theme"><i class="fas fa-adjust"></i></button>
        <button class="fab" id="fab-code-editor" aria-label="Open Code Editor"><i class="fas fa-code"></i></button>
        <button class="fab" id="fab-music-player" aria-label="Open Music Player"><i class="fas fa-music"></i></button>
        <button class="fab" id="fab-contribute" aria-label="Contribute Message"><i class="fas fa-comment-dots"></i></button>
        <button class="fab hidden" id="fab-live-visitors" aria-label="Live Visitors"><i class="fas fa-eye"></i></button>
        <button class="fab" id="fab-private-user" aria-label="Private User Access"><i class="fas fa-user-secret"></i></button>
    </div>

    <div class="social-links">
        <a href="https://wa.me/yourwhatsappnumber" target="_blank" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="https://instagram.com/yourinstagram" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://github.com/yourgithub" target="_blank" aria-label="GitHub"><i class="fab fa-github"></i></a>
        <a href="#" aria-label="Bible Link"><i class="fas fa-book-bible"></i></a>
    </div>

    <div id="private-user-panel" class="panel hidden">
        <div class="panel-header">
            <h3>Login</h3>
            <button class="close-btn" data-target="private-user-panel"><i class="fas fa-times"></i></button>
        </div>
        <input type="text" id="private-user-input" placeholder="Masukkan Username Pribadi">
        <button id="private-user-submit" class="primary-btn">Login</button>
        <p id="private-user-message" style="color: var(--danger); margin-top: 10px;"></p>
    </div>

    <div id="ezra-panel" class="panel hidden">
        <div class="panel-header">
            <h3>Ezra's Private Space</h3>
            <button class="logout-btn primary-btn" id="ezra-logout-btn">Logout</button>
        </div>

        <div id="ezra-gallery-container">
            <p id="ezra-gallery-status" style="color: var(--text-secondary); text-align: center;">Loading content...</p>
        </div>

        <form id="ezra-content-form">
            <h4>Tambah / Edit Konten</h4>
            <input type="hidden" id="edit-item-id">
            <div class="form-row">
                <input type="text" id="gallery-item-title" placeholder="Judul Konten" required>
                <input type="file" id="gallery-item-media" accept="image/*,video/*">
            </div>
            <textarea id="gallery-item-description" placeholder="Deskripsi Konten" rows="3" required></textarea>
            <button type="submit" id="submit-gallery-item" class="primary-btn">Tambah Konten Baru</button>
            <p id="ezra-form-status" class="message-status"></p>
        </form>
    </div>

    <script>
        // --- CONSTANTS ---
        const CLOUDFLARE_WORKER_URL = 'https://forever.universalezra.workers.dev'; // GANTI DENGAN URL CLOUDFLARE WORKER ANDA!

        // --- DOM ELEMENTS ---
        const body = document.body;
        const themeToggle = document.getElementById('theme-toggle');
        const fabThemeToggle = document.getElementById('fab-theme-toggle');

        // Panel toggles (header buttons)
        const showCodeEditorBtn = document.getElementById('show-code-editor');
        const showMusicPlayerBtn = document.getElementById('show-music-player');
        const showContributeBtn = document.getElementById('show-contribute');
        const showLiveVisitorsBtn = document.getElementById('show-live-visitors');
        const showPrivateUserBtn = document.getElementById('show-private-user');

        // Panel toggles (FABs)
        const fabCodeEditorBtn = document.getElementById('fab-code-editor');
        const fabMusicPlayerBtn = document.getElementById('fab-music-player');
        const fabContributeBtn = document.getElementById('fab-contribute');
        const fabLiveVisitorsBtn = document.getElementById('fab-live-visitors');
        const fabPrivateUserBtn = document.getElementById('fab-private-user');

        // Panels
        const codeEditorPanel = document.getElementById('code-editor-panel');
        const musicPlayerPanel = document.getElementById('music-player-panel');
        const contributePanel = document.getElementById('contribute-panel');
        const liveVisitorsPanel = document.getElementById('live-visitors-panel');
        const privateUserPanel = document.getElementById('private-user-panel');
        const ezraPanel = document.getElementById('ezra-panel');

        // Close buttons
        document.querySelectorAll('.panel .close-btn').forEach(button => {
            button.addEventListener('click', () => {
                const targetPanelId = button.dataset.target || button.closest('.panel').id;
                document.getElementById(targetPanelId).classList.add('hidden');
            });
        });

        // --- THEME TOGGLE ---
        function toggleTheme() {
            if (body.dataset.theme === 'dark') {
                body.dataset.theme = 'light';
            } else {
                body.dataset.theme = 'dark';
            }
        }
        themeToggle.addEventListener('click', toggleTheme);
        fabThemeToggle.addEventListener('click', toggleTheme);

        // --- PANEL MANAGEMENT (General) ---
        function showPanel(panel) {
            // Hide all other main panels if they are not Ezra panel
            [codeEditorPanel, musicPlayerPanel, contributePanel, liveVisitorsPanel, privateUserPanel].forEach(p => {
                if (p !== panel && p !== ezraPanel) {
                    p.classList.add('hidden');
                }
            });
            panel.classList.remove('hidden');
        }

        showCodeEditorBtn.addEventListener('click', () => showPanel(codeEditorPanel));
        fabCodeEditorBtn.addEventListener('click', () => showPanel(codeEditorPanel));

        showMusicPlayerBtn.addEventListener('click', () => showPanel(musicPlayerPanel));
        fabMusicPlayerBtn.addEventListener('click', () => showPanel(musicPlayerPanel));

        showContributeBtn.addEventListener('click', () => showPanel(contributePanel));
        fabContributeBtn.addEventListener('click', () => showPanel(contributePanel));

        // Logic for Live Visitors panel visibility based on Ezra login
        showLiveVisitorsBtn.addEventListener('click', () => {
            showPanel(liveVisitorsPanel);
            fetchLiveVisitors(); // Refresh visitors when panel is shown
        });
        fabLiveVisitorsBtn.addEventListener('click', () => {
            showPanel(liveVisitorsPanel);
            fetchLiveVisitors(); // Refresh visitors when panel is shown
        });

        showPrivateUserBtn.addEventListener('click', () => showPanel(privateUserPanel));
        fabPrivateUserBtn.addEventListener('click', () => showPanel(privateUserPanel));


        // --- CODE EDITOR LOGIC ---
        const unifiedEditor = document.getElementById('unified-editor');
        const runCodeBtn = document.getElementById('run-code');
        const codePreview = document.getElementById('code-preview');

        runCodeBtn.addEventListener('click', () => {
            const code = unifiedEditor.value;
            codePreview.srcdoc = code;
        });

        // --- MUSIC PLAYER LOGIC ---
        const musicAudio = document.getElementById('music-audio');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const playlistItems = document.getElementById('playlist-items');

        const playlist = [
            { title: "Music 1", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { title: "Music 2", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { title: "Music 3", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" }
        ];

        let currentTrackIndex = 0;
        let isShuffling = false;
        let isRepeating = false;

        function loadTrack(index) {
            if (index >= 0 && index < playlist.length) {
                currentTrackIndex = index;
                musicAudio.src = playlist[currentTrackIndex].src;
                musicAudio.play();
                updatePlaylistUI();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }

        function playPause() {
            if (musicAudio.paused) {
                musicAudio.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                musicAudio.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        function nextTrack() {
            if (isShuffling) {
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * playlist.length);
                } while (newIndex === currentTrackIndex && playlist.length > 1);
                loadTrack(newIndex);
            } else {
                currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                loadTrack(currentTrackIndex);
            }
        }

        function prevTrack() {
            currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            loadTrack(currentTrackIndex);
        }

        function toggleShuffle() {
            isShuffling = !isShuffling;
            shuffleBtn.classList.toggle('active', isShuffling);
            shuffleBtn.style.color = isShuffling ? 'var(--primary)' : 'var(--text-primary)'; // Use primary for active
        }

        function toggleRepeat() {
            isRepeating = !isRepeating;
            musicAudio.loop = isRepeating;
            repeatBtn.classList.toggle('active', isRepeating);
            repeatBtn.style.color = isRepeating ? 'var(--primary)' : 'var(--text-primary)'; // Use primary for active
        }

        function updatePlaylistUI() {
            playlistItems.innerHTML = '';
            playlist.forEach((song, index) => {
                const li = document.createElement('li');
                li.textContent = song.title;
                if (index === currentTrackIndex) {
                    li.classList.add('active');
                }
                li.addEventListener('click', () => loadTrack(index));
                playlistItems.appendChild(li);
            });
        }

        musicAudio.addEventListener('ended', () => {
            if (isRepeating) {
                musicAudio.play();
            } else {
                nextTrack();
            }
        });

        playPauseBtn.addEventListener('click', playPause);
        nextBtn.addEventListener('click', nextTrack);
        prevBtn.addEventListener('click', prevTrack);
        shuffleBtn.addEventListener('click', toggleShuffle);
        repeatBtn.addEventListener('click', toggleRepeat);

        // Initial load
        updatePlaylistUI();
        if (playlist.length > 0) {
            musicAudio.src = playlist[currentTrackIndex].src;
        }

        // --- CONTRIBUTION LOGIC (Text Only) ---
        const contributeForm = document.getElementById('contribute-form');
        const contributorNameInput = document.getElementById('contributor-name');
        const contributeTextInput = document.getElementById('contribute-text');
        const contributeMessage = document.getElementById('contribute-message');

        contributeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            contributeMessage.textContent = 'Mengirim pesan...';
            contributeMessage.style.color = 'var(--text-secondary)';

            const name = contributorNameInput.value.trim();
            const text = contributeTextInput.value.trim();

            if (!text) {
                contributeMessage.textContent = 'Pesan tidak boleh kosong!';
                contributeMessage.style.color = 'var(--danger)';
                return;
            }

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/contribute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, text }),
                });

                if (response.ok) {
                    contributeMessage.textContent = 'Pesan berhasil dikirim!';
                    contributeMessage.style.color = 'var(--success)';
                    contributorNameInput.value = '';
                    contributeTextInput.value = '';
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Gagal mengirim pesan.');
                }
            } catch (error) {
                console.error('Error sending contribution:', error);
                contributeMessage.textContent = `Gagal mengirim pesan: ${error.message}`;
                contributeMessage.style.color = 'var(--danger)';
            }
        });

        // --- LIVE VISITORS LOGIC - REINTEGRATED & EZRA-SPECIFIC ---
        const visitorList = document.getElementById('visitor-list');
        const refreshVisitorsBtn = document.getElementById('refresh-visitors-btn');
        const lastUpdatedTime = document.getElementById('last-updated-time');

        async function fetchLiveVisitors() {
            visitorList.innerHTML = '<li style="text-align: center; color: var(--text-secondary);">Memuat pengunjung...</li>';
            lastUpdatedTime.textContent = 'Memuat...';

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/get_visitors`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const visitors = await response.json();

                if (visitors && visitors.length > 0) {
                    visitorList.innerHTML = visitors.map(visitor => {
                        const timestamp = new Date(visitor.timestamp).toLocaleString('id-ID', {
                            hour: '2-digit', minute: '2-digit', second: '2-digit',
                            day: '2-digit', month: '2-digit', year: 'numeric'
                        });
                        return `
                            <li>
                                <strong>ID:</strong> <span>${visitor.browserId.substring(0, 10)}...</span><br>
                                <strong>IP:</strong> <span>${visitor.ip || 'N/A'}</span><br>
                                <strong>Waktu:</strong> <span>${timestamp}</span>
                            </li>
                        `;
                    }).join('');
                } else {
                    visitorList.innerHTML = '<li style="text-align: center; color: var(--text-secondary);">Tidak ada pengunjung online.</li>';
                }
                lastUpdatedTime.textContent = new Date().toLocaleTimeString('id-ID');

            } catch (error) {
                console.error('Error fetching live visitors:', error);
                visitorList.innerHTML = '<li style="text-align: center; color: var(--danger);">Gagal memuat pengunjung.</li>';
                lastUpdatedTime.textContent = 'Error';
            }
        }

        refreshVisitorsBtn.addEventListener('click', fetchLiveVisitors);

        // --- PRIVATE USER / EZRA PANEL LOGIC ---
        const privateUserInput = document.getElementById('private-user-input');
        const privateUserSubmitBtn = document.getElementById('private-user-submit');
        const privateUserMessage = document.getElementById('private-user-message');
        const ezraLogoutBtn = document.getElementById('ezra-logout-btn');

        const ezraGalleryContainer = document.getElementById('ezra-gallery-container');
        const ezraGalleryStatus = document.getElementById('ezra-gallery-status');
        const ezraContentForm = document.getElementById('ezra-content-form');
        const editItemIdInput = document.getElementById('edit-item-id');
        const galleryItemTitleInput = document.getElementById('gallery-item-title');
        const galleryItemDescriptionInput = document.getElementById('gallery-item-description');
        const galleryItemMediaInput = document.getElementById('gallery-item-media');
        const submitGalleryItemBtn = document.getElementById('submit-gallery-item');
        const ezraFormStatus = document.getElementById('ezra-form-status');

        privateUserSubmitBtn.addEventListener('click', () => {
            const username = privateUserInput.value.trim().toLowerCase();
            if (username === 'ezra') {
                privateUserPanel.classList.add('hidden');
                ezraPanel.classList.add('active'); // Show Ezra Panel
                showLiveVisitorsBtn.classList.remove('hidden'); // Show Live Visitors button in header
                fabLiveVisitorsBtn.classList.remove('hidden'); // Show Live Visitors FAB
                loadEzraContent(); // Load content when Ezra logs in
                privateUserMessage.textContent = ''; // Clear previous messages
            } else {
                privateUserMessage.textContent = 'Username tidak dikenal.';
            }
        });

        ezraLogoutBtn.addEventListener('click', () => {
            ezraPanel.classList.remove('active'); // Hide Ezra Panel
            liveVisitorsPanel.classList.add('hidden'); // Hide Live Visitors Panel if open
            showLiveVisitorsBtn.classList.add('hidden'); // Hide Live Visitors button in header
            fabLiveVisitorsBtn.classList.add('hidden'); // Hide Live Visitors FAB
            privateUserInput.value = ''; // Clear input
            resetEzraForm(); // Reset form
            ezraGalleryContainer.innerHTML = '<p id="ezra-gallery-status" style="color: var(--text-secondary); text-align: center;">Loading content...</p>'; // Clear gallery
        });

        async function loadEzraContent() {
            ezraGalleryStatus.textContent = 'Memuat konten...';
            ezraGalleryContainer.innerHTML = ''; // Clear existing content

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/ezra-content`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const content = await response.json();

                if (content && content.length > 0) {
                    content.sort((a, b) => new Date(b.date) - new Date(a.date)); // Sort by date, newest first
                    content.forEach(item => {
                        const galleryItem = document.createElement('div');
                        galleryItem.className = 'gallery-item';
                        galleryItem.dataset.id = item.id;

                        let mediaHtml = '';
                        if (item.type === 'image') {
                            mediaHtml = `<img src="${item.mediaUrl}" alt="${item.title}">`;
                        } else if (item.type === 'video') {
                            mediaHtml = `<video controls src="${item.mediaUrl}"></video>`;
                        }

                        galleryItem.innerHTML = `
                            ${mediaHtml}
                            <div class="gallery-item-info">
                                <h4 contenteditable="false">${item.title}</h4>
                                <p contenteditable="false">${item.description}</p>
                                <small>${new Date(item.date).toLocaleString('id-ID', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</small>
                            </div>
                            <div class="gallery-item-controls">
                                <button class="edit-item-btn" data-id="${item.id}"><i class="fas fa-edit"></i></button>
                                <button class="delete-item-btn" data-id="${item.id}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        `;
                        ezraGalleryContainer.appendChild(galleryItem);
                    });

                    // Add event listeners for edit/delete after elements are added
                    document.querySelectorAll('.edit-item-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => editEzraItem(e.currentTarget.dataset.id));
                    });
                    document.querySelectorAll('.delete-item-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => deleteEzraItem(e.currentTarget.dataset.id));
                    });
                    ezraGalleryStatus.textContent = ''; // Clear status if content loaded
                } else {
                    ezraGalleryStatus.textContent = 'Belum ada konten. Tambahkan yang pertama!';
                }
            } catch (error) {
                console.error('Error loading Ezra content:', error);
                ezraGalleryStatus.textContent = `Gagal memuat konten: ${error.message}`;
                ezraGalleryStatus.style.color = 'var(--danger)';
            }
        }

        function resetEzraForm() {
            editItemIdInput.value = '';
            galleryItemTitleInput.value = '';
            galleryItemDescriptionInput.value = '';
            galleryItemMediaInput.value = ''; // Clear file input
            submitGalleryItemBtn.textContent = 'Tambah Konten Baru';
            ezraFormStatus.textContent = '';
        }

        async function editEzraItem(id) {
            ezraFormStatus.textContent = '';
            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/ezra-content?id=${id}`);
                if (!response.ok) throw new Error('Failed to fetch item for editing');
                const itemToEdit = await response.json();

                editItemIdInput.value = itemToEdit.id;
                galleryItemTitleInput.value = itemToEdit.title;
                galleryItemDescriptionInput.value = itemToEdit.description;
                submitGalleryItemBtn.textContent = 'Update Konten';
                galleryItemMediaInput.value = '';
                ezraFormStatus.textContent = 'Mode Edit: Upload media baru jika ingin mengganti.';
                ezraFormStatus.style.color = 'var(--text-secondary)';

            } catch (error) {
                console.error('Error preparing edit:', error);
                ezraFormStatus.textContent = `Gagal menyiapkan edit: ${error.message}`;
                ezraFormStatus.style.color = 'var(--danger)';
            }
        }

        async function deleteEzraItem(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus konten ini?')) {
                return;
            }
            ezraFormStatus.textContent = 'Menghapus konten...';
            ezraFormStatus.style.color = 'var(--text-secondary)';

            try {
                const response = await fetch(`${CLOUDFLARE_WORKER_URL}/ezra-content?id=${id}`, {
                    method: 'DELETE',
                });
                if (response.ok) {
                    ezraFormStatus.textContent = 'Konten berhasil dihapus!';
                    ezraFormStatus.style.color = 'var(--success)';
                    loadEzraContent(); // Reload gallery
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Gagal menghapus konten.');
                }
            } catch (error) {
                console.error('Error deleting Ezra item:', error);
                ezraFormStatus.textContent = `Gagal menghapus: ${error.message}`;
                ezraFormStatus.style.color = 'var(--danger)';
            }
        }

        ezraContentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            ezraFormStatus.textContent = 'Mengirim konten...';
            ezraFormStatus.style.color = 'var(--text-secondary)';

            const id = editItemIdInput.value || `item-${Date.now()}`;
            const title = galleryItemTitleInput.value.trim();
            const description = galleryItemDescriptionInput.value.trim();
            const mediaFile = galleryItemMediaInput.files[0];
            const isEditing = !!editItemIdInput.value;

            if (!title || !description) {
                ezraFormStatus.textContent = 'Judul dan Deskripsi harus diisi!';
                ezraFormStatus.style.color = 'var(--danger)';
                return;
            }

            if (!mediaFile && !isEditing) {
                 ezraFormStatus.textContent = 'Pilih file media untuk konten baru!';
                 ezraFormStatus.style.color = 'var(--danger)';
                 return;
            }

            const formData = new FormData();
            formData.append('id', id);
            formData.append('title', title);
            formData.append('description', description);
            formData.append('date', new Date().toISOString());
            if (mediaFile) {
                formData.append('media', mediaFile);
                formData.append('type', mediaFile.type.startsWith('image/') ? 'image' : 'video');
            } else if (isEditing) {
                 formData.append('noMediaChange', 'true');
            }

            try {
                const method = isEditing ? 'PUT' : 'POST';
                const url = `${CLOUDFLARE_WORKER_URL}/ezra-content`;

                const response = await fetch(url, {
                    method: method,
                    body: formData,
                });

                if (response.ok) {
                    ezraFormStatus.textContent = `Konten berhasil ${isEditing ? 'diperbarui' : 'ditambahkan'}!`;
                    ezraFormStatus.style.color = 'var(--success)';
                    resetEzraForm();
                    loadEzraContent();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Gagal ${isEditing ? 'memperbarui' : 'menambahkan'} konten.`);
                }
            } catch (error) {
                console.error('Error adding/updating Ezra content:', error);
                ezraFormStatus.textContent = `Gagal ${isEditing ? 'memperbarui' : 'menambahkan'}: ${error.message}`;
                ezraFormStatus.style.color = 'var(--danger)';
            }
        });
        // --- WEBSITE AGE FEATURE ---
// Ganti dengan tanggal dan waktu peluncuran website Anda!
// Format: YYYY, MM-1, DD, HH, MM, SS
// Contoh: 1 Januari 2023, 10:00:00 -> new Date(2023, 0, 1, 10, 0, 0);
const launchDate = new Date(2025, 5, 25, 0, 0, 0); // Contoh: 1 Januari 2023, 00:00:00

const websiteAgeElement = document.getElementById('website-age');

function updateWebsiteAge() {
    const now = new Date();
    const diff = now.getTime() - launchDate.getTime(); // Selisih dalam milidetik

    if (diff < 0) {
        websiteAgeElement.textContent = "Website belum diluncurkan!";
        return;
    }

    const seconds = Math.floor(diff / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);

    const years = Math.floor(days / 365.25); // Perhitungkan tahun kabisat
    const remainingDaysAfterYears = days % 365.25;

    const months = Math.floor(remainingDaysAfterYears / 30.44); // Rata-rata hari per bulan
    const remainingDaysAfterMonths = Math.floor(remainingDaysAfterYears % 30.44);


    const displaySeconds = seconds % 60;
    const displayMinutes = minutes % 60;
    const displayHours = hours % 24;

    let ageString = "";
    if (years > 0) ageString += `${years} tahun `;
    if (months > 0) ageString += `${months} bulan `;
    if (remainingDaysAfterMonths > 0) ageString += `${remainingDaysAfterMonths} hari `;
    if (displayHours > 0 || (years === 0 && months === 0 && remainingDaysAfterMonths === 0)) ageString += `${displayHours} jam `; // Selalu tampilkan jam jika belum ada hari/bulan/tahun
    if (displayMinutes > 0 || (years === 0 && months === 0 && remainingDaysAfterMonths === 0 && displayHours === 0)) ageString += `${displayMinutes} menit `; // Selalu tampilkan menit jika belum ada jam/hari/bulan/tahun
    ageString += `${displaySeconds} detik`;

    websiteAgeElement.textContent = ageString.trim();
}

// Panggil fungsi sekali saat load
updateWebsiteAge();

// Perbarui setiap detik
setInterval(updateWebsiteAge, 1000);
    </script>
</body>
</html>
