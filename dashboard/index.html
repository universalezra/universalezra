<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>universalezra</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon1.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon-32x321.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon-16x161.png"
    />
    <link rel="manifest" href="/site.webmanifest" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      :root {
        --primary: #8e44ad;
        --accent: #00a8ff;
        --success: #2ecc71;
        --danger: #e74c3c;
        --light: #ecf0f1;
        --dark: #1a1a2e;
        --bg-main: #16213e;
        --bg-panel: rgba(26, 26, 46, 0.9);
        --text-primary: #e0fbfc;
        --text-secondary: #98ded9;
        --border-color: rgba(0, 168, 255, 0.3);
      }
      * {
        box-sizing: border-box;
      }
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: 'Courier New', Courier, monospace;
        background-color: var(--bg-main);
        color: #00ff00;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      body::before {
        content: "Ezra A";
        position: fixed;
        bottom: 10px;
        left: 10px;
        font-size: 1.5rem;
        color: rgba(255, 255, 255, 0.1);
        z-index: 999;
        pointer-events: none;
        opacity: 0.8;
      }
      #main-viewport {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }
      #grid-container {
        width: 500vw;
        height: 500vh;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr 1fr 1fr;
        transform: translate3d(-200vw, -200vh, 0);
        transition: transform 0.7s cubic-bezier(0.86, 0, 0.07, 1);
      }
      .grid-block {
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: auto;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 20px;
      }
      .grid-block-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        filter: blur(3px);
        -webkit-filter: blur(3px);
        z-index: 1;
      }
      .grid-block-content {
        position: relative;
        z-index: 2;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        padding: 20px;
      }
      .panel {
        position: fixed;
        background: rgba(26, 26, 46, 0.7);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        z-index: 1010;
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.6);
        transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        display: flex;
        flex-direction: column;
        color: #00ff00;
      }
      .panel.active {
        transform: translate(0, 0) !important;
      }
      #editor-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateX(-100%);
      }
      #music-panel {
        bottom: 0;
        left: 0;
        width: 100%;
        height: auto;
        max-height: 80vh;
        border-top: 1px solid var(--border-color);
        transform: translateY(100%);
        padding: 15px;
      }
      #contribution-panel {
        top: 0;
        right: 0;
        width: 400px;
        max-width: 90vw;
        height: 100%;
        transform: translateX(100%);
        padding: 20px;
      }
      #live-visitors-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateY(100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #moment-vault-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateY(100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #dashboard-panel {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateX(-100%);
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #visualizer-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99;
        display: none;
        background-color: transparent;
      }
      .visualizer-active #visualizer-canvas {
        display: block;
        pointer-events: none;
      }
      .panel-close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: #00ff00;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 5;
      }
      .fab-container {
        position: fixed;
        z-index: 1000;
      }
      .fab, .fab-container a {
        background: rgba(142, 68, 173, 0.7);
        color: #00ff00;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.4rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        text-decoration: none;
      }
      .fab:hover, .fab-container a:hover {
        background: var(--accent);
        transform: scale(1.1);
      }
      #fab-editor { top: 20px; left: 20px; }
      #fab-music { top: 50%; left: 20px; transform: translateY(-50%); }
      #fab-alkitab { top: 20px; right: 20px; }
      #fab-contribution { top: calc(50% + 70px); left: 20px; transform: translateY(-50%); }
      #fab-visualizer { bottom: 20px; left: 50%; transform: translateX(-120%); }
      #fab-moment-vault { bottom: 20px; left: 50%; transform: translateX(0%); }
      #fab-live-visitors { bottom: 90px; left: 50%; transform: translateX(-50%); display: none; }
      #fab-keyboard-toggle { bottom: 20px; right: 20px; }
      #fab-dashboard-toggle { bottom: 20px; left: 20px; }

      #live-visitors-panel .live-visitors-content,
      #moment-vault-panel .moment-vault-content,
      #dashboard-panel .dashboard-content-wrapper {
          width: 100%;
          height: 100%;
          max-width: 1200px;
          background: var(--bg-panel);
          border-radius: 15px;
          box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
          overflow: hidden;
          display: flex;
          flex-direction: column;
          padding: 20px;
      }
      #visitor-list ul { list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
      #visitor-history { flex-grow: 1; overflow-y: auto; padding: 0 10px; }
      #visitor-history table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
      #visitor-history th, #visitor-history td { border: 1px solid var(--border-color); padding: 8px; text-align: left; }
      #visitor-history th { background-color: rgba(0, 168, 255, 0.2); position: sticky; top: 0; }

      #moment-vault-gallery-container { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
      #moment-vault-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
      #moment-upload-form input, #moment-upload-form textarea, #moment-upload-form button { margin-top: 10px; }
      .gallery-item { background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color); border-radius: 10px; padding: 10px; display: flex; flex-direction: column; align-items: center; text-align: center; gap: 8px; position: relative; }
      .gallery-media { width: 100%; height: 120px; display: flex; justify-content: center; align-items: center; overflow: hidden; border-radius: 5px; background-color: #333; }
      .gallery-media img, .gallery-media video, .gallery-media audio { width: 100%; height: 100%; object-fit: cover; }
      .gallery-media .file-icon { font-size: 3em; color: var(--text-secondary); }

      #video-player-widget { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 999; width: 150px; height: 150px; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4); border: 2px solid var(--border-color); }
      #video-player-widget video { width: 100%; height: 100%; object-fit: cover; }
      .social-links { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 15px; z-index: 999; }
      #website-age-display { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.8em; color: #00ff00; z-index: 10; background: none; padding: 0; text-align: center; white-space: nowrap; }
      
      .editor-toolbar { padding: 10px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
      .editor-toolbar button, .editor-toolbar select { background: var(--accent); color: var(--text-primary); border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
      .editor-toolbar button:hover, .editor-toolbar select:hover { background: var(--primary); }
      .editor-main { display: flex; flex-grow: 1; gap: 10px; padding: 10px; }
      .editor-code-area, .editor-preview-area { flex: 1; border: 1px solid var(--border-color); border-radius: 5px; overflow: hidden; }
      #unified-code-editor { width: 100%; height: 100%; background: rgba(0,0,0,0.3); color: var(--text-primary); border: none; padding: 10px; resize: none; outline: none; }
      #editor-preview { width: 100%; height: 100%; border: none; background: var(--light); }

      #video-player-widget .video-controls { position: absolute; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-evenly; align-items: center; padding: 5px 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); transition: opacity 0.3s ease; opacity: 0; }
      #video-player-widget:hover .video-controls { opacity: 1; }
      #video-player-widget .video-controls button { background: none; border: none; color: white; font-size: 1rem; cursor: pointer; padding: 5px; }
      
      #moment-vault-panel h3 { padding: 10px 20px; border-radius: 10px; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
      #moment-upload-form { width: 100%; max-width: 600px; }
      #moment-upload-form input, #moment-upload-form textarea { display: block; width: 100%; margin-top: 15px; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 8px; }
      #moment-upload-form button { width: 100%; padding: 12px; background: var(--accent); border: none; color: white; font-size: 1em; cursor: pointer; border-radius: 8px; transition: background 0.3s ease; }
      #moment-upload-form button:hover { background: var(--primary); }
      
      .grid-block-background video { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: -1; }
      #block-4-3 .grid-block-background, #block-3-4 .grid-block-background { filter: none; -webkit-filter: none; }
      
      #center-video-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1100; width: 80vw; height: 80vh; max-width: 1200px; max-height: 800px; background: rgba(0,0,0,0.9); border: 2px solid var(--accent); border-radius: 10px; display: flex; justify-content: center; align-items: center; flex-direction: column; box-shadow: 0 0 50px rgba(0,0,0,0.8); display: none; }
      #center-video-container.active { display: flex; }
      #center-video-container video { width: 95%; height: 95%; object-fit: contain; }
      #center-video-close { position: absolute; top: 10px; right: 10px; font-size: 2rem; color: white; cursor: pointer; background: none; border: none; z-index: 10; }
      
      #sabda-widget-container { width: 100%; max-width: 500px; height: 100%; max-height: 400px; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); border-radius: 10px; padding: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
      #sabda-widget-container iframe { border-radius: 5px; }

      #dashboard-content { height: 100%; width: 100%; padding: 20px; text-align: left; color: var(--text-primary); overflow-y: auto; }
      .dashboard-card { background: rgba(0, 0, 0, 0.4); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); }
      .dashboard-card h4 { margin-top: 0; color: var(--accent); }
      .dashboard-card p { margin-bottom: 10px; font-size: 0.9em; }
      .progress-bar { width: 100%; background-color: rgba(0,0,0,0.5); border-radius: 5px; overflow: hidden; height: 15px; border: 1px solid var(--border-color); }
      .progress-bar-inner { height: 100%; background-color: var(--accent); border-radius: 5px; transition: width 0.5s ease-in-out; }
      .progress-status { font-size: 0.8em; color: var(--text-secondary); margin-top: 5px; }

      .screenshot-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 0, 0, 0.9); color: white; padding: 20px; border-radius: 10px; font-size: 1.2em; z-index: 9999; display: none; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
      
      #new-user-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; background: var(--bg-panel); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 10px; z-index: 10000; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); display: none; text-align: center; }
      #new-user-popup h3 { margin-top: 0; color: var(--accent); }
      #new-user-popup p { margin-bottom: 15px; }
      #new-user-popup a { color: var(--accent); }
      #popup-close-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px; transition: background 0.2s; }
      #popup-close-btn:hover { background: var(--accent); }

      #image-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1101; background: rgba(0,0,0,0.8); padding: 20px; border-radius: 50%; display: none; box-shadow: 0 0 30px var(--accent); }
      #image-popup img { width: 250px; height: 250px; object-fit: cover; border-radius: 50%; border: 3px solid var(--accent); }
      #image-popup.active { display: block; }
      
      .equalizer-container { padding: 10px; border-top: 1px solid var(--border-color); margin-top: 10px; }
      .equalizer-controls { display: flex; justify-content: space-around; align-items: flex-end; height: 100px; }
      .equalizer-band { display: flex; flex-direction: column; align-items: center; }
      .equalizer-band input[type=range] { -webkit-appearance: none; appearance: none; width: 15px; height: 80px; background: transparent; writing-mode: bt-lr; /* IE */ -webkit-appearance: slider-vertical; /* WebKit */ }
      .equalizer-band label { font-size: 0.7em; margin-top: 5px; }

      .grid-block iframe {
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        border: 1px solid var(--border-color);
      }
    </style>
  </head>
  <body>
    <div id="new-user-popup">
      <h3>Selamat Datang!</h3>
      <p>Untuk pengalaman terbaik, kami merekomendasikan:</p>
      <ul>
        <li style="text-align: left; margin-bottom: 10px;">
          Gunakan aplikasi kami untuk fitur penuh: 
          <a href="https://drive.google.com/file/d/11fQBWB9C1PjUQvb8b-IqHdNLS7YkFSFD/view?usp=drivesdk" target="_blank">Download di sini</a>
        </li>
        <li style="text-align: left; margin-bottom: 10px;">
          Putar layar Anda ke mode lanskap (landscape).
        </li>
      </ul>
      <p>
        Dengan melanjutkan, Anda setuju dengan 
        <a href="#privacy" onclick="alert('Kebijakan Privasi: Kami mengumpulkan data anonim seperti ID browser dan alamat IP untuk analisis statistik pengunjung. Data ini tidak akan dibagikan dengan pihak ketiga.');">Kebijakan Privasi</a> kami.
      </p>
      <button id="popup-close-btn">Mengerti</button>
    </div>

    <div class="screenshot-popup" id="screenshot-popup">
        Screenshot tidak diizinkan!
    </div>
    <div id="image-popup"><img id="popup-img" src="" alt="Popup Image"></div>
    <canvas id="visualizer-canvas"></canvas>
    <audio id="matrix-sound" src="https://www.myinstants.com/media/sounds/matrix-code.mp3" preload="auto"></audio>
    <div id="main-viewport">
      <div id="grid-container">   
        <div class="grid-block" id="block-1-1">
          <div class="grid-block-content">
            <h3 style="margin-bottom: 20px;">Radio Online</h3>
            <iframe src="https://zeno.fm/player/prambors-fm" width="350" height="450" frameborder="0"></iframe>
          </div>
        </div>
        <div class="grid-block" id="block-1-2">
            <div class="grid-block-content">
                <h3 style="margin-bottom: 20px;">Catur 3D</h3>
                <iframe src="https://www.crazygames.co.id/embed/3d-chess" width="80%" height="80%" frameborder="0" allowfullscreen></iframe>
            </div>
        </div>
        <div class="grid-block" id="block-1-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=3');"></div>
          <div class="grid-block-content"><h1>Block (1,3)</h1></div>
        </div>
        <div class="grid-block" id="block-1-4">
            <div class="grid-block-content">
                <h3 style="margin-bottom: 20px;">Game Dinosaurus</h3>
                <iframe src="https://chromedino.com/" width="80%" height="80%" frameborder="0"></iframe>
            </div>
        </div>
        <div class="grid-block" id="block-1-5">
            <div class="grid-block-content">
                <h3 style="margin-bottom: 20px;">Peta Dunia 3D</h3>
                <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d158858.03848739953!2d-0.1277583!3d51.5073509!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2suk!4v1628862276551!5m2!1sen!2suk" width="80%" height="80%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
        </div>
        <div class="grid-block" id="block-2-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=6');"></div>
          <div class="grid-block-content"><h1>Block (2,1)</h1></div>
        </div>
        <div class="grid-block" id="block-2-2">
            <div class="grid-block-content">
                <h3 style="margin-bottom: 20px;">Media Player</h3>
                <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" width="80%" height="60%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
        </div>
        <div class="grid-block" id="block-2-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=8');"></div>
          <div class="grid-block-content"><h1>Block (2,3)</h1></div>
        </div>
        <div class="grid-block" id="block-2-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=9');"></div>
          <div class="grid-block-content"><h1>Block (2,4)</h1></div>
        </div>
        <div class="grid-block" id="block-2-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=10');"></div>
          <div class="grid-block-content"><h1>Block (2,5)</h1></div>
        </div>    
        <div class="grid-block" id="block-3-1">
          <div class="grid-block-content">
              <h3 style="margin-bottom: 20px;">Peta Bintang</h3>
              <iframe src="https://stellarium-web.org/" width="80%" height="60%" frameborder="0"></iframe>
          </div>
        </div>
        <div class="grid-block" id="block-3-2">
          <div class="grid-block-content">
            <h3>Ayat Hari Ini</h3>
            <div id="sabda-widget-container">
              <iframe src="https://alkitab.sabda.org/daily/widget.php" width="100%" height="100%" frameborder="0"></iframe>
            </div>
          </div>
        </div>
        <div class="grid-block" id="block-center">
          <div class="grid-block-background" id="interactive-bg" style="background-image: url('wallpaper.png');"></div>
          <div class="grid-block-content">
              <div class="central-message">
                  <p>By <a href="secret.html" class="ezra-link">Ezra</a></p>
              </div>
          </div>
        </div>
        <div class="grid-block" id="block-3-4">
          <div class="grid-block-background" style="background-image: url('https://universalezra.netlify.app/moments/1751293320517-December 13, 2024 at 4.29 AM (1).jpg');"></div>
        </div>
        <div class="grid-block" id="block-3-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=15');"></div>
          <div class="grid-block-content"><h1>Block (3,5)</h1></div>
        </div>
        <div class="grid-block" id="block-4-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=16');"></div>
          <div class="grid-block-content"><h1>Block (4,1)</h1></div>
        </div>
        <div class="grid-block" id="block-4-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=17');"></div>
          <div class="grid-block-content"><h1>Block (4,2)</h1></div>
        </div>
        <div class="grid-block" id="block-4-3">
          <div class="grid-block-background">
              <video autoplay loop muted playsinline>
                  <source src="bg.mp4" type="video/mp4">
              </video>
          </div>
        </div>
        <div class="grid-block" id="block-4-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=19');"></div>
          <div class="grid-block-content"><h1>Block (4,4)</h1></div>
        </div>
        <div class="grid-block" id="block-4-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=20');"></div>
          <div class="grid-block-content"><h1>Block (4,5)</h1></div>
        </div>
        <div class="grid-block" id="block-5-1">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=21');"></div>
          <div class="grid-block-content"><h1>Block (5,1)</h1></div>
        </div>
        <div class="grid-block" id="block-5-2">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=22');"></div>
          <div class="grid-block-content"><h1>Block (5,2)</h1></div>
        </div>
        <div class="grid-block" id="block-5-3">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=23');"></div>
          <div class="grid-block-content"><h1>Block (5,3)</h1></div>
        </div>
        <div class="grid-block" id="block-5-4">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=24');"></div>
          <div class="grid-block-content"><h1>Block (5,4)</h1></div>
        </div>
        <div class="grid-block" id="block-5-5">
          <div class="grid-block-background" style="background-image: url('https://picsum.photos/1920/1080?random=25');"></div>
          <div class="grid-block-content"><h1>Block (5,5)</h1></div>
        </div>      
      </div>
    </div>  
    <div class="fab-container" id="fab-editor"><button class="fab" data-panel="editor-panel" title="Code Editor"><i class="fas fa-code"></i></button></div>
    <div class="fab-container" id="fab-music"><button class="fab" data-panel="music-panel" title="Music Player"><i class="fas fa-music"></i></button></div>
    <div class="fab-container" id="fab-contribution"><button class="fab" data-panel="contribution-panel" title="Leave a Message"><i class="fas fa-feather-alt"></i></button></div>
    <div class="fab-container" id="fab-alkitab"><a class="fab" href="https://alkitab.me/in-tb/Matius/5/13" target="_blank" title="Alkitab"><i class="fas fa-book"></i></a></div>
    <div class="fab-container" id="fab-visualizer"><button class="fab" data-panel="visualizer" title="Visualizer"><i class="fas fa-expand"></i></button></div>
    <div class="fab-container" id="fab-moment-vault"><button class="fab" data-panel="moment-vault-panel" title="Moment Vault"><i class="fas fa-archive"></i></button></div>
    <div class="fab-container" id="fab-live-visitors"><button class="fab" data-panel="live-visitors-panel" title="Live Visitors"><i class="fas fa-eye"></i></button></div>
    <div class="fab-container" id="fab-keyboard-toggle"><button class="fab" title="Password"><i class="fas fa-key"></i></button></div>
    <div class="fab-container" id="fab-dashboard-toggle"><button class="fab" data-panel="dashboard-panel" title="Target Dashboard"><i class="fas fa-bullseye"></i></button></div>
    <div id="video-player-widget">
        <video id="widget-video" loop src="video.mp4"></video>
        <div class="video-controls">
            <button id="video-play-pause"><i class="fas fa-play"></i></button>
            <button id="video-mute"><i class="fas fa-volume-up"></i></button>
        </div>
    </div>
    <div class="social-links">
        <a href="https://wa.me/6283844959380" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="https://instagram.com/zilifucek" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
    </div>
    <div id="website-age-display"></div>
    <div class="panel" id="editor-panel">
        <button class="panel-close-btn" data-panel="editor-panel"><i class="fas fa-times"></i></button>
        <div class="editor-toolbar">
            <button id="editor-run"><i class="fas fa-play"></i> Run</button>
            <button id="editor-save"><i class="fas fa-save"></i> Save</button>
            <button id="editor-load"><i class="fas fa-folder-open"></i> Load</button>
            <button id="editor-new"><i class="fas fa-file"></i> New</button>
            <button id="editor-undo"><i class="fas fa-undo"></i> Undo</button>
            <button id="editor-redo"><span><i class="fas fa-redo"></i> Redo</span></button>
             <select id="code-template-select">
                <option value="">Pilih Template</option>
                <option value="portfolio">Portfolio</option>
                <option value="loginForm">Login Form</option>
                <option value="gallery">Image Gallery</option>
            </select>
        </div>
        <div class="editor-main">
            <div class="editor-code-area"><textarea id="unified-code-editor" spellcheck="false"></textarea></div>
            <div class="editor-preview-area"><iframe id="editor-preview"></iframe></div>
        </div>
    </div>
    <div class="panel" id="music-panel">
        <button class="panel-close-btn" data-panel="music-panel"><i class="fas fa-times"></i></button>
        <h4>Now Playing</h4>
        <div id="music-player-content">
            <h5 id="song-title">Select a song</h5>
            <audio id="audio-player" controls loop style="width: 100%"></audio>
            <div id="playlist" style="max-height: 20vh; overflow-y: auto; margin-top: 10px"></div>
            <div class="equalizer-container">
                <h5>Equalizer</h5>
                <div class="equalizer-controls" id="equalizer-controls"></div>
                 <button id="toggle-visualizer-style" style="margin-top: 10px; width: 100%;">Ganti Visualizer</button>
            </div>
        </div>
    </div>
    <div class="panel" id="contribution-panel">
        <button class="panel-close-btn" data-panel="contribution-panel"><i class="fas fa-times"></i></button>
        <div id="contribution-content" style="display: flex; flex-direction: column; height: 100%">
            <h3 style="margin-top: 20px">Leave a Message</h3>
            <div id="contribution-display" style="flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-bottom: 15px"><p>Loading</p></div>
            <form id="contribution-form">
                <textarea id="contribution-text" placeholder="Your message" required style="width: 100%; min-height: 80px; background: rgba(0, 0, 0, 0.2); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 5px; padding: 10px;"></textarea>
                <div style="display: flex; justify-content: flex-end; align-items: center; margin-top: 10px;">
                    <button type="submit" class="fab" style="position: static; width: 45px; height: 45px; font-size: 1.1rem"><i class="fas fa-paper-plane"></i></button>
                </div>
                <p id="contribution-status" style="font-size: 0.9em; text-align: center; margin-top: 10px"></p>
            </form>
        </div>
    </div>
    <div class="panel" id="live-visitors-panel">
      <button class="panel-close-btn" data-panel="live-visitors-panel"><i class="fas fa-times"></i></button>
      <div class="live-visitors-content">
          <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Live Visitors</h3>
          <div id="mv-live-visitors-list-container" style="flex-grow: 1; overflow-y: auto; padding-right: 10px">
              <p style="text-align: center; color: var(--text-secondary)">visitor</p>
              <ul id="visitor-list" style="list-style: none; padding: 0; margin: 0"></ul>
          </div>
          <h4 style="margin-top: 20px; color: var(--primary); text-align: center;">Visitor History</h4>
          <div id="visitor-history"><p style="text-align: center; color: var(--text-secondary);">Loading history</p></div>
          <div style="margin-top: 15px; text-align: center; font-size: 0.85em; color: var(--text-secondary)">updated: <span id="last-updated-time">N/A</span></div>
      </div>
    </div>
    <div class="panel" id="moment-vault-panel">
        <button class="panel-close-btn" data-panel="moment-vault-panel"><i class="fas fa-times"></i></button>
        <div class="moment-vault-content" style="display: flex; flex-direction: column; height: 100%;">
            <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Share your moment here</h3>
            <div id="moment-vault-gallery-container" style="flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-bottom: 15px;">
                <p style="text-align: center; color: var(--text-secondary)">Memories</p>
                <div id="moment-vault-gallery"></div>
            </div>
            <form id="moment-upload-form">
                <input type="text" id="moment-title" placeholder="Title" required />
                <textarea id="moment-description" placeholder="Describe" rows="3"></textarea>
                <input type="file" id="moment-file" accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt" required/>
                <button type="submit">Upload</button>
                <p id="moment-upload-status" style="font-size: 0.9em; text-align: center; margin-top: 10px"></p>
            </form>
        </div>
    </div>
    <div class="panel" id="dashboard-panel">
      <button class="panel-close-btn" data-panel="dashboard-panel"><i class="fas fa-times"></i></button>
      <div class="dashboard-content-wrapper">
        <div id="dashboard-content">
          <h3 style="margin-bottom: 15px; color: var(--accent); text-align: center">Target Dashboard</h3>
          <p style="text-align: center; color: var(--text-secondary)">Ini adalah tampilan statis dari target-target masa depan.</p>
          <div class="dashboard-card">
            <h4>噫 Proyek "Atlas"</h4>
            <p>Menciptakan mesin pencari web 3.0 yang terdesentralisasi, aman, dan tanpa iklan.</p>
            <div class="progress-bar"><div class="progress-bar-inner" style="width: 35%;"></div></div>
            <div class="progress-status">35% Selesai</div>
          </div>
          <div class="dashboard-card">
            <h4>庁 Inisiatif "Project Athena"</h4>
            <p>Pengembangan sistem AI personal yang dapat mempersonalisasi konten.</p>
             <div class="progress-bar"><div class="progress-bar-inner" style="width: 60%;"></div></div>
            <div class="progress-status">60% Selesai</div>
          </div>
          <div class="dashboard-card">
            <h4>験 Misi "Gaia"</h4>
            <p>Membangun platform edukasi interaktif untuk anak-anak, berfokus pada STEM.</p>
             <div class="progress-bar"><div class="progress-bar-inner" style="width: 15%;"></div></div>
            <div class="progress-status">15% Selesai</div>
          </div>
          <div class="dashboard-card">
            <h4>迫 Integrasi "Omni-Connect"</h4>
            <p>Menghubungkan semua aplikasi web pribadi ke dalam satu ekosistem.</p>
             <div class="progress-bar"><div class="progress-bar-inner" style="width: 80%;"></div></div>
            <div class="progress-status">80% Selesai</div>
          </div>
        </div>
      </div>
    </div>
    <div id="center-video-container">
        <button id="center-video-close"><i class="fas fa-times"></i></button>
        <video id="center-video-player" loop muted playsinline></video>
    </div>
    <script>
      // URL Worker Utama - Ganti dengan URL Worker Anda setelah di-deploy
      const MAIN_WORKER_URL = 'https://universalezra-main-worker.YOUR_WORKER_SUBDOMAIN.workers.dev/';

      // Konfigurasi Lama (Tetap) untuk Moment Vault
      const MOMENT_VAULT_WORKER_URL = 'https://moment-vault-worker-url.universalezra.workers.dev';
      const GITHUB_REPO_OWNER = 'universalezra';
      const GITHUB_REPO_NAME = 'universalezra';
      const GITHUB_TOKEN_WORKER_URL = 'https://github-token-worker-url.universalezra.workers.dev';
      
      let liveVisitorRefreshInterval;
      let gridContainer, currentX = 2, currentY = 2;
      let isDragging = false, startX = 0, startY = 0;
      const SWIPE_THRESHOLD = 50;
      
      // Variabel Visualizer
      let isVisualizerActive = false;
      let visualizerCanvas, ctx, audioContext, analyser, source, gainNode;
      let particles = [];
      let bufferLength, frequencyData;
      let eqBands = [];
      const PARTICLE_COUNT = 150;
      const PARTICLE_SPEED_MULTIPLIER = 0.4;
      let bassThreshold = 240, bassCooldown = 0;
      let currentVisualizerStyle = 'circle';
      
      document.addEventListener('DOMContentLoaded', () => {
        gridContainer = document.getElementById('grid-container');
        initPanelControls();
        initVideoPlayer();
        initEditor();
        initMusicPlayer();
        initWebsiteAgeDisplay();
        trackVisitor();
        initVisualizer();
        initSwipeGestures();
        initSecurityFeatures();
        checkFirstVisit();
      });

      function initSwipeGestures() {
        const matrixSound = document.getElementById('matrix-sound');
        const moveGrid = (x, y) => {
            const oldX = currentX;
            const oldY = currentY;
            currentX = Math.min(4, Math.max(0, currentX + x));
            currentY = Math.min(4, Math.max(0, currentY + y));

            if (oldX !== currentX || oldY !== currentY) {
              gridContainer.style.transform = `translate3d(-${currentX * 100}vw, -${currentY * 100}vh, 0)`;
              matrixSound.currentTime = 0;
              matrixSound.play().catch(e => console.error("Audio play failed:", e));
            }
        };
        const handleStart = (e) => { isDragging = true; startX = e.clientX || e.touches[0].clientX; startY = e.clientY || e.touches[0].clientY; };
        const handleEnd = (e) => {
            if (!isDragging) return;
            const endX = e.clientX || e.changedTouches[0].clientX;
            const endY = e.clientY || e.changedTouches[0].clientY;
            const dx = endX - startX; const dy = endY - startY;
            isDragging = false;
            if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > SWIPE_THRESHOLD) { moveGrid(dx > 0 ? -1 : 1, 0); } 
            else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > SWIPE_THRESHOLD) { moveGrid(0, dy > 0 ? -1 : 1); }
        };
        document.addEventListener('mousedown', handleStart);
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchstart', handleStart);
        document.addEventListener('touchend', handleEnd);
      }

      function initPanelControls() {
        // Event listener untuk tombol password
        document.getElementById('fab-keyboard-toggle').addEventListener('click', handlePasswordPrompt);

        document.querySelectorAll('[data-panel]').forEach((button) => {
          button.addEventListener('click', (event) => {
            const panelId = button.getAttribute('data-panel');
            if (!panelId) return;

            if (panelId === 'live-visitors-panel') {
                // Penanganan panel ini sekarang via handlePasswordPrompt
                return;
            } else if (panelId === 'visualizer') {
              toggleVisualizerOverlay();
            } else {
              const panel = document.getElementById(panelId);
              panel.classList.toggle('active');
              if (panelId === 'contribution-panel' && panel.classList.contains('active')) fetchContributions();
              else if (panelId === 'moment-vault-panel' && panel.classList.contains('active')) fetchMomentVaultGallery();
            }
          });
        });
        document.querySelectorAll('.panel-close-btn').forEach((button) => {
          button.addEventListener('click', () => {
            const panelId = button.getAttribute('data-panel');
            const panel = document.getElementById(panelId);
            panel.classList.remove('active');
            if (panelId === 'live-visitors-panel') {
              clearInterval(liveVisitorRefreshInterval);
              document.getElementById('visitor-list').innerHTML = '';
              document.getElementById('visitor-history').innerHTML = '';
            }
          });
        });
      }

      async function handlePasswordPrompt() {
          const password = prompt('Masukkan password untuk membuka fitur:');
          if (!password) return;

          if (password.toLowerCase() === 'elvi') {
              const popup = document.getElementById('image-popup');
              const img = document.getElementById('popup-img');
              img.src = 'elvi.jpg'; // Pastikan file elvi.jpg ada di direktori yang sama
              popup.classList.add('active');
              setTimeout(() => popup.classList.remove('active'), 3000);
              return;
          }
          
          try {
              const response = await fetch(MAIN_WORKER_URL + 'auth', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ password: password })
              });
              const result = await response.json();

              if (result.success) {
                  const feature = result.feature;
                  if (feature === 'live_visitors') {
                      const panel = document.getElementById('live-visitors-panel');
                      panel.classList.add('active');
                      fetchLiveVisitors();
                      fetchVisitorHistory();
                      liveVisitorRefreshInterval = setInterval(fetchLiveVisitors, 5000);
                  } else if (feature === 'center_video') {
                      const container = document.getElementById('center-video-container');
                      const player = document.getElementById('center-video-player');
                      container.classList.add('active');
                      player.src = 'stiker.mp4';
                      player.play();
                  } else if (feature === 'show_button') {
                      document.getElementById('fab-live-visitors').style.display = 'flex';
                      alert('Tombol Live Visitor telah diaktifkan!');
                  }
              } else {
                  alert('Password salah!');
              }
          } catch(error) {
              console.error('Authentication error:', error);
              alert('Gagal memverifikasi password.');
          }
      }

      function initVideoPlayer() { /* ... (fungsi asli tidak berubah) ... */ }
      
      function initMusicPlayer() {
        const player = document.getElementById('audio-player');
        const playlistEl = document.getElementById('playlist');
        const songTitleEl = document.getElementById('song-title');
        const songs = [ { name: 'On And On', url: 'On-And-On.mp3' }, { name: 'Where We Are', url: 'Where-We-Are.mp3' }, { name: 'Sekuat Hatimu', url: 'Sekuat Hatimu.mp3' }, ];
        songs.forEach((song) => {
          const item = document.createElement('div');
          item.textContent = song.name; item.style.cursor = 'pointer'; item.style.padding = '8px';
          item.onclick = () => { player.src = song.url; songTitleEl.textContent = song.name; player.play(); };
          playlistEl.appendChild(item);
        });
        document.getElementById('toggle-visualizer-style').addEventListener('click', () => {
            currentVisualizerStyle = currentVisualizerStyle === 'circle' ? 'bars' : 'circle';
        });
      }

      function initEditor() {
         /* ... (fungsi asli tidak berubah, kecuali penambahan template) ... */
        const templateSelect = document.getElementById('code-template-select');
        const codeEditor = document.getElementById('unified-code-editor');
        templateSelect.addEventListener('change', () => {
            const template = templateSelect.value;
            if (template === 'portfolio') {
                codeEditor.value = `<!DOCTYPE html>
<html>
<head>
    <title>My Portfolio</title>
    <style>
        body { font-family: Arial, sans-serif; background: #222; color: #fff; text-align: center; }
        .container { padding: 50px; }
        h1 { color: #00a8ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to My Portfolio</h1>
        <p>This is a sample page.</p>
    </div>
</body>
</html>`;
            } else if (template === 'loginForm') {
                codeEditor.value = `<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #333; }
        .login-box { background: #444; padding: 20px; border-radius: 5px; color: white; }
        input { display: block; margin: 10px 0; padding: 8px; }
    </style>
</head>
<body>
    <div class="login-box">
        <h2>Login</h2>
        <input type="text" placeholder="Username">
        <input type="password" placeholder="Password">
        <button>Submit</button>
    </div>
</body>
</html>`;
            } else if (template === 'gallery') {
                codeEditor.value = `<!DOCTYPE html>
<html>
<head>
    <title>Image Gallery</title>
    <style>
        .gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .gallery img { width: 100%; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Image Gallery</h1>
    <div class="gallery">
        <img src="https://picsum.photos/300/200?random=1" alt="Image">
        <img src="https://picsum.photos/300/200?random=2" alt="Image">
        <img src="https://picsum.photos/300/200?random=3" alt="Image">
    </div>
</body>
</html>`;
            }
        });
      }

      async function fetchContributions() {
        const display = document.getElementById('contribution-display');
        display.innerHTML = `<p>Loading...</p>`;
        try {
          const response = await fetch(MAIN_WORKER_URL + 'contributions');
          const contributions = await response.json();
          if (contributions && contributions.length > 0) {
            display.innerHTML = contributions.reverse().map(c => `<div style="background:rgba(0,0,0,0.2);padding:10px;border-radius:5px;margin-bottom:10px;"><p style="margin:0;">${c.text}</p><small style="color:var(--text-secondary);">${new Date(c.timestamp).toLocaleString()}</small></div>`).join('');
          } else {
            display.innerHTML = `<p>Be the first to leave a message</p>`;
          }
        } catch (e) { display.innerHTML = `<p style="color:var(--danger);">Could not load contributions.</p>`; }
      }
      
      document.getElementById('contribution-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const statusEl = document.getElementById('contribution-status');
          statusEl.textContent = 'Uploading...';
          const text = document.getElementById('contribution-text').value;
          try {
            const response = await fetch(MAIN_WORKER_URL + 'contributions', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text: text }),
            });
            if (!response.ok) throw new Error('Upload failed');
            statusEl.textContent = 'Message sent. Thank you.';
            e.target.reset();
            fetchContributions();
          } catch (err) { statusEl.textContent = `Error: ${err.message}`; }
        });
      
      function initWebsiteAgeDisplay() { /* ... (fungsi asli tidak berubah) ... */ }
      
      async function fetchLiveVisitors() {
        const visitorList = document.getElementById('visitor-list');
        const lastUpdatedTime = document.getElementById('last-updated-time');
        try {
          const response = await fetch(MAIN_WORKER_URL + 'visitors');
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          const visitors = await response.json();
          if (visitors && visitors.length > 0) {
            visitorList.innerHTML = visitors.map(v => `<li><strong>ID:</strong> <span>${v.browserId.substring(0,10)}...</span><br><strong>IP:</strong> <span>${v.ip||'N/A'}</span><br><strong>Waktu:</strong> <span>${new Date(v.timestamp).toLocaleString('id-ID')}</span></li>`).join('');
          } else { visitorList.innerHTML = '<li style="text-align: center; color: var(--text-secondary);">No online visitors</li>'; }
          lastUpdatedTime.textContent = new Date().toLocaleTimeString('id-ID');
        } catch (error) { console.error('Error fetching live visitors:', error); visitorList.innerHTML = '<li style="text-align: center; color: var(--danger);">Failed to load</li>'; }
      }
      
      async function fetchVisitorHistory() {
        const historyContainer = document.getElementById('visitor-history');
        historyContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Loading history...</p>';
        try {
            const response = await fetch(MAIN_WORKER_URL + 'history');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            let history = await response.json();
            
            if (history && history.length > 0) {
                const tableHeader = `<table><thead><tr><th>Timestamp</th><th>Browser ID</th><th>IP</th><th>Referrer</th><th>Total Kunjungan</th></tr></thead><tbody>`;
                const tableRows = history.map(visitor => `
                    <tr>
                        <td>${new Date(visitor.timestamp).toLocaleString('id-ID')}</td>
                        <td>${visitor.browserId.substring(0, 10)}...</td>
                        <td>${visitor.ip || 'N/A'}</td>
                        <td>${visitor.referrer || 'Direct'}</td>
                        <td>${visitor.visitCount || 1}</td>
                    </tr>`).join('');
                historyContainer.innerHTML = tableHeader + tableRows + `</tbody></table>`;
            } else { historyContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No visitor history yet</p>'; }
        } catch (error) { console.error('Failed to load visitor history:', error); historyContainer.innerHTML = `<p style="text-align: center; color: var(--danger);">Sistem lagi crash.</p>`; }
      }

      function getBrowserId() {
        let browserId = localStorage.getItem('unique_browser_id');
        if (!browserId) { browserId = 'browser_' + Math.random().toString(36).substr(2, 9) + Date.now(); localStorage.setItem('unique_browser_id', browserId); }
        return browserId;
      }
      
      async function trackVisitor() {
        try {
          let ipAddress = 'unknown';
          try { const ipResponse = await fetch('https://api.ipify.org?format=json'); const ipData = await ipResponse.json(); ipAddress = ipData.ip; } catch (ipError) { console.warn('Could not fetch IP address.'); }
          const data = { browserId: getBrowserId(), ip: ipAddress, userAgent: navigator.userAgent, timestamp: new Date().toISOString(), referrer: document.referrer || 'direct' };
          fetch(MAIN_WORKER_URL + 'visitors', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }).catch((e) => console.error('Error tracking visitor:', e));
        } catch (e) { console.error('Error in trackVisitor:', e); }
      }

      // Moment Vault (fungsi-fungsi lama tidak berubah, karena menggunakan worker terpisah)
      async function fetchMomentVaultGallery() { /* ... */ }
      async function uploadMoment(e) { /* ... */ }
      async function editMoment(itemId, currentItems) { /* ... */ }
      async function deleteMoment(itemId) { /* ... */ }
      
      function initVisualizer() {
        visualizerCanvas = document.getElementById('visualizer-canvas');
        ctx = visualizerCanvas.getContext('2d');
        resizeVisualizer();
        window.addEventListener('resize', resizeVisualizer);
      }
      
      function resizeVisualizer() { visualizerCanvas.width = window.innerWidth; visualizerCanvas.height = window.innerHeight; }

      function setupAudioVisualizer() {
        const audioPlayer = document.getElementById('audio-player');
        if (!audioPlayer.src) { alert('Pilih lagu terlebih dahulu'); return false; }
        if (!audioContext) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          source = audioContext.createMediaElementSource(audioPlayer);
          analyser = audioContext.createAnalyser();
          analyser.fftSize = 2048;
          bufferLength = analyser.frequencyBinCount;
          frequencyData = new Uint8Array(bufferLength);
          
          // Setup Equalizer
          const eqContainer = document.getElementById('equalizer-controls');
          const frequencies = [60, 170, 310, 600, 1000, 3000, 6000, 12000, 14000, 16000];
          let lastNode = source;
          frequencies.forEach(freq => {
              const eq = audioContext.createBiquadFilter();
              eq.type = 'peaking';
              eq.frequency.value = freq;
              eq.Q.value = 1.41;
              eq.gain.value = 0;
              lastNode.connect(eq);
              lastNode = eq;
              eqBands.push(eq);

              const bandDiv = document.createElement('div');
              bandDiv.className = 'equalizer-band';
              const slider = document.createElement('input');
              slider.type = 'range';
              slider.min = -12; slider.max = 12; slider.step = 0.1; slider.value = 0;
              slider.oninput = () => eq.gain.value = slider.value;
              const label = document.createElement('label');
              label.textContent = freq < 1000 ? `${freq}Hz` : `${freq/1000}k`;
              bandDiv.appendChild(slider);
              bandDiv.appendChild(label);
              eqContainer.appendChild(bandDiv);
          });
          lastNode.connect(analyser);
          analyser.connect(audioContext.destination);
        }
        createParticles();
        return true;
      }
      
      function createParticles() {
        particles = [];
        for (let i = 0; i < PARTICLE_COUNT; i++) {
          particles.push({
            x: Math.random() * visualizerCanvas.width,
            y: Math.random() * visualizerCanvas.height,
            size: Math.random() * 2 + 1,
            speedX: (Math.random() - 0.5) * PARTICLE_SPEED_MULTIPLIER,
            speedY: (Math.random() - 0.5) * PARTICLE_SPEED_MULTIPLIER,
            color: `hsl(${Math.random() * 360}, 100%, 50%)`,
          });
        }
      }

      function drawVisualizer() {
        if (!isVisualizerActive) return;
        requestAnimationFrame(drawVisualizer);
        analyser.getByteFrequencyData(frequencyData);
        ctx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
        
        if(currentVisualizerStyle === 'circle') drawCircleVisualizer();
        else drawBarsVisualizer();

        // Bass detection
        let bassLevel = (frequencyData[0] + frequencyData[1] + frequencyData[2]) / 3;
        if (bassLevel > bassThreshold && bassCooldown === 0) {
            particles.forEach(p => { p.color = `hsl(${Math.random() * 360}, 100%, 50%)`; });
            bassCooldown = 10; // Cooldown for 10 frames
        }
        if (bassCooldown > 0) bassCooldown--;

        // Particle animation
        particles.forEach(p => {
            p.x += p.speedX; p.y += p.speedY;
            if (p.x > visualizerCanvas.width || p.x < 0) p.speedX *= -1;
            if (p.y > visualizerCanvas.height || p.y < 0) p.speedY *= -1;
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
        });
      }
      
      function drawCircleVisualizer() {
        const center_x = visualizerCanvas.width / 2;
        const center_y = visualizerCanvas.height / 2;
        const radius = Math.min(center_x, center_y) * 0.35;
        const barCount = bufferLength * 0.4;
        const slice = (2 * Math.PI) / barCount;
        ctx.beginPath();
        for (let i = 0; i < barCount; i++) {
            const v = frequencyData[i] / 255.0;
            const barHeight = v * 250;
            const angle = slice * i;
            const x = center_x + Math.cos(angle) * (radius + barHeight);
            const y = center_y + Math.sin(angle) * (radius + barHeight);
            if (i === 0) { ctx.moveTo(x, y); } else { ctx.lineTo(x, y); }
        }
        ctx.closePath();
        const gradient = ctx.createLinearGradient(0,0,visualizerCanvas.width,visualizerCanvas.height);
        gradient.addColorStop(0, 'rgba(142, 68, 173, 0.8)');
        gradient.addColorStop(1, 'rgba(0, 168, 255, 0.8)');
        ctx.strokeStyle = gradient;
        ctx.lineWidth = 3;
        ctx.stroke();
      }

      function drawBarsVisualizer() {
        const barWidth = (visualizerCanvas.width / (bufferLength * 0.5));
        let x = 0;
        for (let i = 0; i < bufferLength * 0.5; i++) {
            const barHeight = (frequencyData[i] / 255) * visualizerCanvas.height * 0.7;
            const hue = i / (bufferLength * 0.5) * 360;
            ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.fillRect(x, visualizerCanvas.height - barHeight, barWidth, barHeight);
            x += barWidth + 1;
        }
      }

      function toggleVisualizerOverlay() { /* ... (fungsi asli tidak berubah) ... */ }
      function toggleFullscreen() { /* ... (fungsi asli tidak berubah) ... */ }

      function initSecurityFeatures() {
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        document.addEventListener('copy', (e) => e.preventDefault());
        document.addEventListener('cut', (e) => e.preventDefault());
        window.addEventListener('keyup', (e) => {
            if (e.key === 'PrintScreen') {
                const popup = document.getElementById('screenshot-popup');
                popup.style.display = 'block';
                setTimeout(() => { popup.style.display = 'none'; }, 3000);
            }
        });
      }
      
      function checkFirstVisit() { /* ... (fungsi asli tidak berubah) ... */ }
    </script>
  </body>
</html>
